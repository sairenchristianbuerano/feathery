'use strict';

function _createForOfIteratorHelper(r, e) { var t = "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (!t) { if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e && r && "number" == typeof r.length) { t && (r = t); var _n = 0, F = function F() {}; return { s: F, n: function n() { return _n >= r.length ? { done: !0 } : { done: !1, value: r[_n++] }; }, e: function e(r) { throw r; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var o, a = !0, u = !1; return { s: function s() { t = t.call(r); }, n: function n() { var r = t.next(); return a = r.done, r; }, e: function e(r) { u = !0, o = r; }, f: function f() { try { a || null == t["return"] || t["return"](); } finally { if (u) throw o; } } }; }
function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function _toConsumableArray(r) { return _arrayWithoutHoles(r) || _iterableToArray(r) || _unsupportedIterableToArray(r) || _nonIterableSpread(); }
function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _iterableToArray(r) { if ("undefined" != typeof Symbol && null != r[Symbol.iterator] || null != r["@@iterator"]) return Array.from(r); }
function _arrayWithoutHoles(r) { if (Array.isArray(r)) return _arrayLikeToArray(r); }
function _slicedToArray(r, e) { return _arrayWithHoles(r) || _iterableToArrayLimit(r, e) || _unsupportedIterableToArray(r, e) || _nonIterableRest(); }
function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _unsupportedIterableToArray(r, a) { if (r) { if ("string" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }
function _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }
function _iterableToArrayLimit(r, l) { var t = null == r ? null : "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t["return"] && (u = t["return"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }
function _arrayWithHoles(r) { if (Array.isArray(r)) return r; }
function _regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ _regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = "function" == typeof Symbol ? Symbol : {}, a = i.iterator || "@@iterator", c = i.asyncIterator || "@@asyncIterator", u = i.toStringTag || "@@toStringTag"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, ""); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, "_invoke", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: "normal", arg: t.call(e, r) }; } catch (t) { return { type: "throw", arg: t }; } } e.wrap = wrap; var h = "suspendedStart", l = "suspendedYield", f = "executing", s = "completed", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { ["next", "throw", "return"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if ("throw" !== c.type) { var u = c.arg, h = u.value; return h && "object" == _typeof(h) && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) { invoke("next", t, i, a); }, function (t) { invoke("throw", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke("throw", t, i, a); }); } a(c.arg); } var r; o(this, "_invoke", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw Error("Generator is already running"); if (o === s) { if ("throw" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else "return" === n.method && n.abrupt("return", n.arg); o = f; var p = tryCatch(e, r, n); if ("normal" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, "throw" === n && e.iterator["return"] && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y; var i = tryCatch(o, e.iterator, r.arg); if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = "normal", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: "root" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || "" === e) { var r = e[a]; if (r) return r.call(e); if ("function" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(_typeof(e) + " is not iterable"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) { var e = "function" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () { return this; }), define(g, "toString", function () { return "[object Generator]"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if ("throw" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if ("root" === i.tryLoc) return handle("end"); if (i.tryLoc <= this.prev) { var c = n.call(i, "catchLoc"), u = n.call(i, "finallyLoc"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw Error("try statement without catch or finally"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) { var i = o; break; } } i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if ("throw" === t.type) throw t.arg; return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, "catch": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if ("throw" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw Error("illegal catch attempt"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, "next" === this.method && (this.arg = t), y; } }, e; }
function _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }
function _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
function _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function _callSuper(t, o, e) { return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e)); }
function _possibleConstructorReturn(t, e) { if (e && ("object" == _typeof(e) || "function" == typeof e)) return e; if (void 0 !== e) throw new TypeError("Derived constructors may only return object or undefined"); return _assertThisInitialized(t); }
function _assertThisInitialized(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e; }
function _inherits(t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), Object.defineProperty(t, "prototype", { writable: !1 }), e && _setPrototypeOf(t, e); }
function _wrapNativeSuper(t) { var r = "function" == typeof Map ? new Map() : void 0; return _wrapNativeSuper = function _wrapNativeSuper(t) { if (null === t || !_isNativeFunction(t)) return t; if ("function" != typeof t) throw new TypeError("Super expression must either be null or a function"); if (void 0 !== r) { if (r.has(t)) return r.get(t); r.set(t, Wrapper); } function Wrapper() { return _construct(t, arguments, _getPrototypeOf(this).constructor); } return Wrapper.prototype = Object.create(t.prototype, { constructor: { value: Wrapper, enumerable: !1, writable: !0, configurable: !0 } }), _setPrototypeOf(Wrapper, t); }, _wrapNativeSuper(t); }
function _construct(t, e, r) { if (_isNativeReflectConstruct()) return Reflect.construct.apply(null, arguments); var o = [null]; o.push.apply(o, e); var p = new (t.bind.apply(t, o))(); return r && _setPrototypeOf(p, r.prototype), p; }
function _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }
function _isNativeFunction(t) { try { return -1 !== Function.toString.call(t).indexOf("[native code]"); } catch (n) { return "function" == typeof t; } }
function _setPrototypeOf(t, e) { return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, _setPrototypeOf(t, e); }
function _getPrototypeOf(t) { return _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) { return t.__proto__ || Object.getPrototypeOf(t); }, _getPrototypeOf(t); }
Object.defineProperty(exports, '__esModule', {
  value: true
});
var ui = require('./ui-c46f1784.js');
var TEST_API_URL = 'https://test.stytch.com';
var LIVE_API_URL = 'https://api.stytch.com';
var CLIENTSIDE_SERVICES_IFRAME_URL = 'https://js.stytch.com/clientside-services/index.html';
var STYTCH_DFP_BACKEND_URL = "https://telemetry.stytch.com";
var STYTCH_DFP_CDN_URL = "https://elements.stytch.com";
var STYTCH_SESSION_COOKIE = 'stytch_session';
var STYTCH_SESSION_JWT_COOKIE = 'stytch_session_jwt';
var POWERED_BY_STYTCH_IMG_URL = 'https://public-assets.stytch.com/et_powered_by_stytch_logo.png';
var GOOGLE_ONE_TAP_HOST = 'https://accounts.google.com/gsi';
var GOOGLE_ONE_TAP_SCRIPT_URL = "".concat(GOOGLE_ONE_TAP_HOST, "/client");
var DEFAULT_SESSION_DURATION_MINUTES = 30;
var DEFAULT_OTP_EXPIRATION_MINUTES = 5;
var MULTIPLE_STYTCH_CLIENTS_DETECTED_WARNING = "It looks like you're creating multiple copies of the Stytch client." + ' This behavior is unsupported, and unintended side effects may occur. ' + "Make sure you are creating the Stytch client at the global level, and not inside a component's render function.";

/******************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function __rest(s, e) {
  var t = {};
  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];
  if (s != null && typeof Object.getOwnPropertySymbols === "function") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];
  }
  return t;
}
function __awaiter(thisArg, _arguments, P, generator) {
  function adopt(value) {
    return value instanceof P ? value : new P(function (resolve) {
      resolve(value);
    });
  }
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
}
typeof SuppressedError === "function" ? SuppressedError : function (error, suppressed, message) {
  var e = new Error(message);
  return e.name = "SuppressedError", e.error = error, e.suppressed = suppressed, e;
};
exports.RetriableErrorType = void 0;
(function (RetriableErrorType) {
  RetriableErrorType["RequiredCatcha"] = "Catcha Required";
})(exports.RetriableErrorType || (exports.RetriableErrorType = {}));
var RetriableError = /*#__PURE__*/function (_Error) {
  function RetriableError(type) {
    var _this;
    _classCallCheck(this, RetriableError);
    _this = _callSuper(this, RetriableError, [type]);
    _this.type = type;
    return _this;
  }
  _inherits(RetriableError, _Error);
  return _createClass(RetriableError);
}( /*#__PURE__*/_wrapNativeSuper(Error));
function retriableFetchSDK(_ref) {
  var method = _ref.method,
    finalURL = _ref.finalURL,
    basicAuthHeader = _ref.basicAuthHeader,
    xSDKClientHeader = _ref.xSDKClientHeader,
    xSDKParentHostHeader = _ref.xSDKParentHostHeader,
    body = _ref.body,
    retryCallback = _ref.retryCallback;
  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {
    var req;
    return _regeneratorRuntime().wrap(function _callee$(_context) {
      while (1) switch (_context.prev = _context.next) {
        case 0:
          req = {
            method: method,
            finalURL: finalURL,
            basicAuthHeader: basicAuthHeader,
            xSDKClientHeader: xSDKClientHeader,
            xSDKParentHostHeader: xSDKParentHostHeader,
            body: body
          };
          _context.prev = 1;
          _context.next = 4;
          return baseFetchSDK(req);
        case 4:
          return _context.abrupt("return", _context.sent);
        case 7:
          _context.prev = 7;
          _context.t0 = _context["catch"](1);
          if (!(_context.t0 instanceof RetriableError)) {
            _context.next = 16;
            break;
          }
          _context.next = 12;
          return retryCallback(_context.t0, req);
        case 12:
          req = _context.sent;
          _context.next = 15;
          return baseFetchSDK(req);
        case 15:
          return _context.abrupt("return", _context.sent);
        case 16:
          throw _context.t0;
        case 17:
        case "end":
          return _context.stop();
      }
    }, _callee, null, [[1, 7]]);
  }));
}
function baseFetchSDK(_ref2) {
  var method = _ref2.method,
    finalURL = _ref2.finalURL,
    basicAuthHeader = _ref2.basicAuthHeader,
    xSDKClientHeader = _ref2.xSDKClientHeader,
    xSDKParentHostHeader = _ref2.xSDKParentHostHeader,
    body = _ref2.body;
  var _a;
  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {
    var headers, fetchOpts, resp, _respData, respError, respData;
    return _regeneratorRuntime().wrap(function _callee2$(_context2) {
      while (1) switch (_context2.prev = _context2.next) {
        case 0:
          headers = {
            Authorization: basicAuthHeader,
            'Content-Type': 'application/json',
            'X-SDK-Client': xSDKClientHeader
          };
          if (xSDKParentHostHeader) {
            headers['X-SDK-Parent-Host'] = xSDKParentHostHeader;
          }
          fetchOpts = {
            method: method,
            headers: headers,
            body: body && JSON.stringify(body),
            credentials: 'include'
          };
          _context2.prev = 3;
          _context2.next = 6;
          return fetch(finalURL, fetchOpts);
        case 6:
          resp = _context2.sent;
          _context2.next = 14;
          break;
        case 9:
          _context2.prev = 9;
          _context2.t0 = _context2["catch"](3);
          if (!(_context2.t0.message === 'Failed to fetch')) {
            _context2.next = 13;
            break;
          }
          throw new ui.StytchAPIUnreachableError('Unable to contact our servers.');
        case 13:
          throw _context2.t0;
        case 14:
          if (!(resp.status <= 299)) {
            _context2.next = 25;
            break;
          }
          _context2.prev = 15;
          _context2.next = 18;
          return resp.json();
        case 18:
          _respData = _context2.sent;
          return _context2.abrupt("return", _respData.data);
        case 22:
          _context2.prev = 22;
          _context2.t1 = _context2["catch"](15);
          throw new ui.StytchAPIUnreachableError('Invalid JSON response from our servers.');
        case 25:
          if (!(resp.status !== 200 && ((_a = resp.headers.get('content-type')) === null || _a === void 0 ? void 0 : _a.includes('application/json')))) {
            _context2.next = 38;
            break;
          }
          _context2.prev = 26;
          _context2.next = 29;
          return resp.json();
        case 29:
          respError = _context2.sent;
          _context2.next = 35;
          break;
        case 32:
          _context2.prev = 32;
          _context2.t2 = _context2["catch"](26);
          throw new ui.StytchAPIUnreachableError('Invalid or no response from server');
        case 35:
          if (!('body' in respError || 'params' in respError || 'query' in respError)) {
            _context2.next = 37;
            break;
          }
          throw new ui.StytchAPISchemaError(respError);
        case 37:
          throw new ui.StytchAPIError(respError);
        case 38:
          _context2.prev = 38;
          _context2.next = 41;
          return resp.text();
        case 41:
          respData = _context2.sent;
          _context2.next = 47;
          break;
        case 44:
          _context2.prev = 44;
          _context2.t3 = _context2["catch"](38);
          throw new ui.StytchAPIUnreachableError('Invalid response from our servers.');
        case 47:
          if (!respData.includes('Captcha required')) {
            _context2.next = 49;
            break;
          }
          throw new RetriableError(exports.RetriableErrorType.RequiredCatcha);
        case 49:
          throw new ui.StytchAPIUnreachableError('Invalid response from our servers.');
        case 50:
        case "end":
          return _context2.stop();
      }
    }, _callee2, null, [[3, 9], [15, 22], [26, 32], [38, 44]]);
  }));
}
function baseSubmitFormSDK(_ref3) {
  var method = _ref3.method,
    finalURL = _ref3.finalURL,
    basicAuthHeader = _ref3.basicAuthHeader,
    xSDKClientHeader = _ref3.xSDKClientHeader,
    xSDKParentHostHeader = _ref3.xSDKParentHostHeader,
    body = _ref3.body;
  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {
    var bodyParams, finalBody, children, form;
    return _regeneratorRuntime().wrap(function _callee3$(_context3) {
      while (1) switch (_context3.prev = _context3.next) {
        case 0:
          bodyParams = body || {};
          finalBody = Object.assign(Object.assign({}, bodyParams), {
            __Authorization: basicAuthHeader,
            '__X-SDK-Client': xSDKClientHeader
          });
          if (xSDKParentHostHeader) {
            finalBody['__X-SDK-Parent-Host'] = xSDKParentHostHeader;
          }
          children = Object.entries(finalBody).map(function (_ref4) {
            var _ref5 = _slicedToArray(_ref4, 2),
              key = _ref5[0],
              value = _ref5[1];
            var input = document.createElement('input');
            input.type = 'hidden';
            input.name = key;
            input.value = value;
            return input;
          });
          form = document.createElement('form');
          form.method = method;
          form.action = finalURL;
          form.append.apply(form, _toConsumableArray(children));
          document.body.appendChild(form);
          form.submit();
        case 10:
        case "end":
          return _context3.stop();
      }
    }, _callee3);
  }));
}

// Unique ID creation requires a high quality random # generator. In the browser we therefore
// require the crypto API and do not support built-in fallback to lower quality random number
// generators (like Math.random()).
var getRandomValues;
var rnds8 = new Uint8Array(16);
function rng() {
  // lazy load so that environments that need to polyfill have a chance to do so
  if (!getRandomValues) {
    // getRandomValues needs to be invoked in a context where "this" is a Crypto implementation. Also,
    // find the complete implementation of crypto (msCrypto) on IE11.
    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto !== 'undefined' && typeof msCrypto.getRandomValues === 'function' && msCrypto.getRandomValues.bind(msCrypto);
    if (!getRandomValues) {
      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');
    }
  }
  return getRandomValues(rnds8);
}
var REGEX = /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;
function validate$1(uuid) {
  return typeof uuid === 'string' && REGEX.test(uuid);
}

/**
 * Convert array of 16 byte values to UUID string format of the form:
 * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX
 */
var byteToHex = [];
for (var i = 0; i < 256; ++i) {
  byteToHex.push((i + 0x100).toString(16).substr(1));
}
function stringify(arr) {
  var offset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
  // Note: Be careful editing this code!  It's been tuned for performance
  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434
  var uuid = (byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]]).toLowerCase(); // Consistency check for valid UUID.  If this throws, it's likely due to one
  // of the following:
  // - One or more input array values don't map to a hex octet (leading to
  // "undefined" in the uuid)
  // - Invalid input values for the RFC `version` or `variant` fields
  if (!validate$1(uuid)) {
    throw TypeError('Stringified UUID is invalid');
  }
  return uuid;
}
function v4(options, buf, offset) {
  options = options || {};
  var rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`
  rnds[6] = rnds[6] & 0x0f | 0x40;
  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided
  if (buf) {
    offset = offset || 0;
    for (var i = 0; i < 16; ++i) {
      buf[offset + i] = rnds[i];
    }
    return buf;
  }
  return stringify(rnds);
}
var ModulePromiseCache = {};
function loadESModule(url, moduleFromGlobalScope) {
  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {
    return _regeneratorRuntime().wrap(function _callee4$(_context4) {
      while (1) switch (_context4.prev = _context4.next) {
        case 0:
          if (!(ModulePromiseCache[url] !== undefined)) {
            _context4.next = 2;
            break;
          }
          return _context4.abrupt("return", ModulePromiseCache[url]);
        case 2:
          ModulePromiseCache[url] = loadESModuleFromNetwork(url, moduleFromGlobalScope);
          return _context4.abrupt("return", ModulePromiseCache[url]);
        case 4:
        case "end":
          return _context4.stop();
      }
    }, _callee4);
  }));
}
function loadESModuleFromNetwork(url, moduleFromGlobalScope) {
  return new Promise(function (resolve, reject) {
    var maybeScript = findScript(url);
    if (maybeScript && maybeScript.dataset.loaded === 'true') {
      try {
        resolve(moduleFromGlobalScope());
      } catch (err) {
        return reject(new Error("".concat(url, " already loaded, but module was not found in global scope: ").concat(err)));
      }
    }
    var script = createScript(url);
    script.addEventListener('load', function () {
      script.dataset.loaded = 'true';
      try {
        resolve(moduleFromGlobalScope());
      } catch (err) {
        reject(new Error("".concat(url, " was loaded, but module was not found in global scope: ").concat(err)));
      }
    });
    script.addEventListener('error', function (err) {
      reject(new Error("".concat(url, " could not be loaded: ").concat(err)));
    });
  });
}
var findScriptsInDom = function findScriptsInDom(url) {
  return document.querySelectorAll("script[src=\"".concat(url, "\"]"));
};
function findScript(url) {
  var scripts = findScriptsInDom(url);
  if (scripts[0]) {
    return scripts[0];
  }
}
function createScript(url) {
  var script = document.createElement('script');
  script.setAttribute('src', url);
  script.setAttribute('async', 'true');
  script.setAttribute('defer', 'true');
  document.head.appendChild(script);
  return script;
}
var getHttpsUrl = function getHttpsUrl(urlOrDomain) {
  // If it's already a valid URL, extract the domain
  try {
    var url = new URL(urlOrDomain);
    return "https://".concat(url.hostname);
  } catch (_a) {
    // invalid URLs are OK
  }
  // Prepend a scheme and verify it's a valid URL
  try {
    var _url = new URL("https://".concat(urlOrDomain));
    return "https://".concat(_url.hostname);
  } catch (_b) {}
  // Input was neither a valid URL nor a valid domain
  return undefined;
};

/**
 * A set of tokens to stylize the console.log output
 * First token is the raw text. %c is a placeholder for string formatting
 * Second token starts our stylizing - adding custom color and background
 * Third token resets stylizing to baseline before showing the rest of the content.
 */
var STYTCH_BADGE = process.env.NODE_ENV === 'production' ? ['[Stytch]'] : ['%c[Stytch]%c', 'background: #19303d; color: #13E5C0; padding: 2px;border-radius: 4px', ''];
// Turn this to true to enable debug logs
// TODO: Make this an env var
var DEBUG = false;
/* eslint-disable no-console */
/* eslint-disable @typescript-eslint/no-explicit-any */
/**
 * An ultralightweight wrapper around console.log.
 * In the future, the logger might be passed in from the customer,
 * or the level might be configurable.
 */
var logger = {
  debug: function debug() {
    return DEBUG;
  },
  log: function log() {
    var _console;
    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }
    return (_console = console).log.apply(_console, STYTCH_BADGE.concat(args));
  },
  warn: function warn() {
    var _console2;
    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
      args[_key2] = arguments[_key2];
    }
    return (_console2 = console).warn.apply(_console2, STYTCH_BADGE.concat(args));
  },
  error: function error() {
    var _console3;
    for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {
      args[_key3] = arguments[_key3];
    }
    return (_console3 = console).error.apply(_console3, STYTCH_BADGE.concat(args));
  }
};
/* eslint-enable @typescript-eslint/no-explicit-any */
/* eslint-enable no-console */

var getLiveApiURL = function getLiveApiURL(opts) {
  var _a, _b, _c;
  if ((_a = opts === null || opts === void 0 ? void 0 : opts.endpointOptions) === null || _a === void 0 ? void 0 : _a.apiDomain) {
    var httpsUrl = getHttpsUrl(opts.endpointOptions.apiDomain);
    if (httpsUrl) {
      return httpsUrl;
    } else {
      logger.warn("Unable to use custom API domain `".concat(opts.endpointOptions.apiDomain, "`. apiDomain should be a valid domain."));
    }
  }
  return (_c = (_b = opts === null || opts === void 0 ? void 0 : opts.endpoints) === null || _b === void 0 ? void 0 : _b.liveAPIURL) !== null && _c !== void 0 ? _c : LIVE_API_URL;
};
var getTestApiURL = function getTestApiURL(opts) {
  var _a, _b, _c;
  if ((_a = opts === null || opts === void 0 ? void 0 : opts.endpointOptions) === null || _a === void 0 ? void 0 : _a.testApiDomain) {
    var httpsUrl = getHttpsUrl(opts.endpointOptions.testApiDomain);
    if (httpsUrl) {
      return httpsUrl;
    } else {
      logger.warn("Unable to use custom API domain `".concat(opts.endpointOptions.testApiDomain, "`. testApiDomain should be a valid domain."));
    }
  }
  return (_c = (_b = opts === null || opts === void 0 ? void 0 : opts.endpoints) === null || _b === void 0 ? void 0 : _b.testAPIURL) !== null && _c !== void 0 ? _c : TEST_API_URL;
};
var trailer = "\nYou can find your public token at https://stytch.com/dashboard/api-keys.";
var checkPublicToken = function checkPublicToken(publicToken) {
  if (typeof publicToken !== 'string') {
    logger.warn("Public token is malformed. Expected a string, got ".concat(_typeof(publicToken), ".").concat(trailer));
  } else if (publicToken === '') {
    logger.warn("Public token is malformed. Expected \"public-token-...\", got an empty string.".concat(trailer));
  } else if (!publicToken.startsWith('public-token-')) {
    logger.warn("Public token is malformed. Expected \"public-token-...\", got ".concat(publicToken, ".").concat(trailer));
  }
};
var checkNotSSR = function checkNotSSR(clientName) {
  var factoryFunctionName = clientName === 'StytchUIClient' ? 'createStytchUIClient' : 'createStytchHeadlessClient';
  if (typeof window === 'undefined') {
    throw new Error("`new ".concat(clientName, "()` is not supported in server environments. If using @stytch/react or @stytch/nextjs, use `").concat(factoryFunctionName, "()` instead."));
  }
};
var checkB2BNotSSR = function checkB2BNotSSR(clientName) {
  var factoryFunctionName = clientName === 'StytchB2BUIClient' ? 'createStytchB2BUIClient' : 'createStytchB2BHeadlessClient';
  if (typeof window === 'undefined') {
    throw new Error("`new ".concat(clientName, "()` is not supported in server environments. If using @stytch/react or @stytch/nextjs, use `").concat(factoryFunctionName, "()` instead."));
  }
};

// List of Alpha-2 country codes to display in the drop down for phone number entry in our pre-built UI components.
//
// This list contains all allowed country codes, in alphabetical order, with the exception of the US, which is placed first as it is
// the default and our most common user country.
//
// This list was built by pulling all countries from https://www.iban.com/country-codes and then removing countries that are not on our
// unsupported countries (https://app.launchdarkly.com/default/production/features/default-banned-countries-for-phone-validation/targeting).
//
// Other useful links are the IBAN Alpha-2 code list (https://www.iban.com/country-codes) and Twilio's per-country notes
// (https://www.twilio.com/en-us/guidelines/ag/sms). Just substitute the country code in that URL!
//
// This list is served to any customer, regardless of whether they are on the default country allowlist (only US and Canada) or they allow
// all countries. This means that users may be able to choose a country that is not allowed for a customer and receive an error. This should
// be improved in the future: ODEVX-34.
var COUNTRIES_LIST = {
  US: '1',
  // United States of America
  AX: '358',
  // Aland Islands
  AS: '1684',
  // American Samoa
  AG: '1268',
  // Antigua and Barbuda
  AI: '1264',
  // Anguilla
  AR: '54',
  // Argentina
  AT: '43',
  // Austria
  AU: '61',
  // Australia
  BE: '32',
  // Belgium
  BJ: '229',
  // Benin
  BO: '591',
  // Bolivia
  BR: '55',
  // Brazil
  IO: '246',
  // British Indian Ocean Territory (the)
  BN: '673',
  // Brunei Darussalam
  BG: '359',
  // Bulgaria
  BF: '226',
  // Burkina Faso
  CM: '237',
  // Cameroon
  CA: '1',
  // Canada
  BQ: '599',
  // Caribbean Netherlands
  CF: '236',
  // Central African Republic (the)
  CL: '56',
  // Chile
  CX: '61',
  // Christmas Island
  CC: '61',
  // Cocos (Keeling) Islands (the)
  CO: '57',
  // Colombia
  CD: '243',
  // Congo (the Democratic Republic of the)
  CK: '682',
  // Cook Islands (the)
  CR: '506',
  // Costa Rica
  HR: '385',
  // Croatia
  CZ: '420',
  // Czechia
  DK: '45',
  // Denmark
  DO: '1829',
  // Dominican Republic (the)
  EC: '593',
  // Ecuador
  SV: '503',
  // El Salvador
  EE: '372',
  // Estonia
  SZ: '268',
  // Eswatini
  FK: '500',
  // Falkland Islands (the) [Malvinas]
  FI: '358',
  // Finland
  FR: '33',
  // France
  GF: '594',
  // French Guiana
  DE: '49',
  // Germany
  GH: '233',
  // Ghana
  GR: '30',
  // Greece
  GD: '1473',
  // Grenada
  GT: '502',
  // Guatemala
  GG: '44',
  // Guernsey
  GW: '245',
  // Guinea-Bissau
  GY: '592',
  // Guyana
  HU: '36',
  // Hungary
  IS: '354',
  // Iceland
  IN: '91',
  // India
  IE: '353',
  // Ireland
  IM: '44',
  // Isle of Man
  IT: '39',
  // Italy
  JM: '1876',
  // Jamaica
  JP: '81',
  // Japan
  KZ: '7',
  // Kazakhstan
  KE: '254',
  // Kenya
  KI: '686',
  // Kiribati
  KR: '82',
  // Korea (the Republic of)
  LV: '371',
  // Latvia
  LT: '370',
  // Lithuania
  LU: '352',
  // Luxembourg
  MO: '853',
  // Macao
  MT: '356',
  // Malta
  MH: '692',
  // Marshall Islands (the)
  MR: '222',
  // Mauritania
  MU: '230',
  // Mauritius
  YT: '262',
  // Mayotte
  MX: '52',
  // Mexico
  MC: '377',
  // Monaco
  ME: '382',
  // Montenegro
  NR: '674',
  // Nauru
  NL: '31',
  // Netherlands (the)
  NZ: '64',
  // New Zealand
  NI: '505',
  // Nicaragua
  NF: '672',
  // Norfolk Island
  NO: '47',
  // Norway
  PA: '507',
  // Panama
  PY: '595',
  // Paraguay
  PE: '51',
  // Peru
  PN: '870',
  // Pitcairn
  PL: '48',
  // Poland
  PT: '351',
  // Portugal
  PR: '1',
  // Puerto Rico
  RO: '40',
  // Romania
  BL: '590',
  // Saint BarthÃ©lemy
  SH: '290',
  // Saint Helena, Ascension and Tristan da Cunha
  KN: '1869',
  // Saint Kitts and Nevis
  LC: '1758',
  // Saint Lucia
  MF: '590',
  // Saint Martin (French part)
  PM: '508',
  // Saint Pierre and Miquelon
  SM: '378',
  // San Marino
  ST: '239',
  // Sao Tome and Principe
  SC: '248',
  // Seychelles
  SX: '599',
  // Sint Maarten (Dutch part)
  SK: '421',
  // Slovakia
  SI: '386',
  // Slovenia
  ZA: '27',
  // South Africa
  SS: '211',
  // South Sudan
  ES: '34',
  // Spain
  SR: '597',
  // Suriname
  SJ: '47',
  // Svalbard and Jan Mayen
  SE: '46',
  // Sweden
  CH: '41',
  // Switzerland
  TW: '886',
  // Taiwan
  TZ: '255',
  // Tanzania, United Republic of
  TK: '690',
  // Tokelau
  TO: '676',
  // Tonga
  TT: '1868',
  // Trinidad and Tobago
  TR: '90',
  // Turkey
  UA: '380',
  // Ukraine
  GB: '44',
  // United Kingdom of Great Britain and Northern Ireland (the)
  UM: '1',
  // United States Minor Outlying Islands (the)
  UY: '598',
  // Uruguay
  VA: '379',
  // Vatican
  EH: '212' // Western Sahara
};
var getDFPBackendURL = function getDFPBackendURL(opts) {
  var _a, _b, _c;
  if ((_a = opts === null || opts === void 0 ? void 0 : opts.endpointOptions) === null || _a === void 0 ? void 0 : _a.dfppaDomain) {
    var httpsUrl = getHttpsUrl(opts.endpointOptions.dfppaDomain);
    if (httpsUrl) {
      return httpsUrl;
    } else {
      logger.warn("Unable to use custom DFPPA domain `".concat(opts.endpointOptions.dfppaDomain, "`. dfppaDomain should be a valid domain."));
    }
  }
  return (_c = (_b = opts === null || opts === void 0 ? void 0 : opts.endpoints) === null || _b === void 0 ? void 0 : _b.dfpBackendURL) !== null && _c !== void 0 ? _c : STYTCH_DFP_BACKEND_URL;
};
var getDFPCdnURL = function getDFPCdnURL(opts) {
  var _a;
  if ((_a = opts === null || opts === void 0 ? void 0 : opts.endpointOptions) === null || _a === void 0 ? void 0 : _a.dfpCdnDomain) {
    var httpsUrl = getHttpsUrl(opts.endpointOptions.dfpCdnDomain);
    if (httpsUrl) {
      return httpsUrl;
    } else {
      logger.warn("Unable to use custom DFP CDN domain `".concat(opts.endpointOptions.dfpCdnDomain, "`. dfpCdnDomain should be a valid domain."));
    }
  }
  return STYTCH_DFP_CDN_URL;
};
var isTestPublicToken = function isTestPublicToken(token) {
  return token.includes('public-token-test');
};
/**
 * Normalizes an es5 promise with a .then(onSuccess, onFailure) signature to
 * the es6 .then().catch() signature
 */
var normalizePromiseLike = function normalizePromiseLike(prom) {
  return new Promise(function (resolve, reject) {
    prom.then(resolve, reject);
  });
};
var createEventId = function createEventId() {
  return "event-id-".concat(v4());
};
var createAppSessionId = function createAppSessionId() {
  return "app-session-id-".concat(v4());
};
var createPersistentId = function createPersistentId() {
  return "persistent-id-".concat(v4());
};
var validate = function validate(methodName) {
  var validator = {
    isObject: function isObject(fieldName, value) {
      var isObject = _typeof(value) === 'object' && !Array.isArray(value) && value !== null;
      if (!isObject) {
        throw new ui.StytchSDKUsageError(methodName, fieldName + ' must be an object.');
      }
      return validator;
    },
    isOptionalObject: function isOptionalObject(fieldName, value) {
      if (typeof value === 'undefined') {
        return validator;
      }
      return validator.isObject(fieldName, value);
    },
    isString: function isString(fieldName, value) {
      if (typeof value !== 'string') {
        throw new ui.StytchSDKUsageError(methodName, fieldName + ' must be a string.');
      }
      return validator;
    },
    isOptionalString: function isOptionalString(fieldName, value) {
      if (typeof value === 'undefined') {
        return validator;
      }
      return validator.isString(fieldName, value);
    },
    isStringArray: function isStringArray(fieldName, value) {
      if (!Array.isArray(value)) {
        throw new ui.StytchSDKUsageError(methodName, fieldName + ' must be an array of strings.');
      }
      var _iterator = _createForOfIteratorHelper(value),
        _step;
      try {
        for (_iterator.s(); !(_step = _iterator.n()).done;) {
          var str = _step.value;
          if (typeof str !== 'string') {
            throw new ui.StytchSDKUsageError(methodName, fieldName + ' must be an array of strings.');
          }
        }
      } catch (err) {
        _iterator.e(err);
      } finally {
        _iterator.f();
      }
      return validator;
    },
    isOptionalStringArray: function isOptionalStringArray(fieldName, value) {
      if (typeof value === 'undefined') {
        return validator;
      }
      return validator.isStringArray(fieldName, value);
    },
    isNumber: function isNumber(fieldName, value) {
      if (typeof value !== 'number') {
        throw new ui.StytchSDKUsageError(methodName, fieldName + ' must be a number.');
      }
      return validator;
    },
    isOptionalNumber: function isOptionalNumber(fieldName, value) {
      if (typeof value === 'undefined') {
        return validator;
      }
      return validator.isNumber(fieldName, value);
    },
    isBoolean: function isBoolean(fieldName, value) {
      if (typeof value !== 'boolean') {
        throw new ui.StytchSDKUsageError(methodName, fieldName + ' must be a boolean.');
      }
      return validator;
    },
    isOptionalBoolean: function isOptionalBoolean(fieldName, value) {
      if (typeof value === 'undefined') {
        return validator;
      }
      return validator.isBoolean(fieldName, value);
    }
  };
  return validator;
};
var isPhoneMethod = function isPhoneMethod(selectionMethod) {
  return selectionMethod === ui.OTPMethods.SMS || selectionMethod === ui.OTPMethods.WhatsApp;
};
var isEmailMethod = function isEmailMethod(selectionMethod) {
  return selectionMethod === ui.OTPMethods.Email;
};
var removeResponseCommon = function removeResponseCommon(_a) {
  var rest = __rest(_a, ["request_id", "status_code"]);
  return rest;
};
var omitUser = function omitUser(resp) {
  // eslint-disable-next-line @typescript-eslint/no-unused-vars
  var rest = __rest(resp, ["__user"]);
  return rest;
};
var loadTelemetryJS = function loadTelemetryJS(domain) {
  return loadESModule("".concat(domain, "/telemetry.js"), function () {
    return window.GetTelemetryID;
  });
};
var DFPProtectedAuthProvider = /*#__PURE__*/_createClass(function DFPProtectedAuthProvider(publicToken, dfpBackendURL, dfpCdnDomain, bootstrapPromise) {
  var _this2 = this;
  var executeRecaptcha = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : function () {
    return Promise.resolve(undefined);
  };
  _classCallCheck(this, DFPProtectedAuthProvider);
  this.bootstrapPromise = bootstrapPromise;
  this.isEnabled = function () {
    return __awaiter(_this2, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee5() {
      return _regeneratorRuntime().wrap(function _callee5$(_context5) {
        while (1) switch (_context5.prev = _context5.next) {
          case 0:
            return _context5.abrupt("return", this.state.then(function (state) {
              return state.enabled;
            }));
          case 1:
          case "end":
            return _context5.stop();
        }
      }, _callee5, this);
    }));
  };
  this.getTelemetryID = function () {
    return __awaiter(_this2, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee6() {
      var _yield$this$state, publicToken, enabled, dfpBackendURL;
      return _regeneratorRuntime().wrap(function _callee6$(_context6) {
        while (1) switch (_context6.prev = _context6.next) {
          case 0:
            _context6.next = 2;
            return this.state;
          case 2:
            _yield$this$state = _context6.sent;
            publicToken = _yield$this$state.publicToken;
            enabled = _yield$this$state.enabled;
            dfpBackendURL = _yield$this$state.dfpBackendURL;
            if (enabled) {
              _context6.next = 8;
              break;
            }
            return _context6.abrupt("return", undefined);
          case 8:
            _context6.next = 10;
            return window.GetTelemetryID(publicToken, "".concat(dfpBackendURL, "/submit"));
          case 10:
            return _context6.abrupt("return", _context6.sent);
          case 11:
          case "end":
            return _context6.stop();
        }
      }, _callee6, this);
    }));
  };
  this.getDFPTelemetryIDAndCaptcha = function () {
    return __awaiter(_this2, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee7() {
      var _yield$this$state2, enabled, executeRecaptcha, mode, dfp_telemetry_id, captcha_token;
      return _regeneratorRuntime().wrap(function _callee7$(_context7) {
        while (1) switch (_context7.prev = _context7.next) {
          case 0:
            _context7.next = 2;
            return this.state;
          case 2:
            _yield$this$state2 = _context7.sent;
            enabled = _yield$this$state2.enabled;
            executeRecaptcha = _yield$this$state2.executeRecaptcha;
            mode = _yield$this$state2.mode;
            dfp_telemetry_id = undefined;
            captcha_token = undefined;
            if (enabled) {
              _context7.next = 12;
              break;
            }
            _context7.next = 11;
            return executeRecaptcha();
          case 11:
            captcha_token = _context7.sent;
          case 12:
            if (!(mode === 'DECISIONING')) {
              _context7.next = 18;
              break;
            }
            _context7.next = 15;
            return this.getTelemetryID();
          case 15:
            dfp_telemetry_id = _context7.sent;
            _context7.next = 25;
            break;
          case 18:
            if (!(mode === 'OBSERVATION')) {
              _context7.next = 25;
              break;
            }
            _context7.next = 21;
            return this.getTelemetryID();
          case 21:
            dfp_telemetry_id = _context7.sent;
            _context7.next = 24;
            return executeRecaptcha();
          case 24:
            captcha_token = _context7.sent;
          case 25:
            return _context7.abrupt("return", {
              dfp_telemetry_id: dfp_telemetry_id,
              captcha_token: captcha_token
            });
          case 26:
          case "end":
            return _context7.stop();
        }
      }, _callee7, this);
    }));
  };
  this.retryWithCaptchaAndDFP = function (e, req) {
    return __awaiter(_this2, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee8() {
      var _yield$this$state3, enabled, executeRecaptcha;
      return _regeneratorRuntime().wrap(function _callee8$(_context8) {
        while (1) switch (_context8.prev = _context8.next) {
          case 0:
            _context8.next = 2;
            return this.state;
          case 2:
            _yield$this$state3 = _context8.sent;
            enabled = _yield$this$state3.enabled;
            executeRecaptcha = _yield$this$state3.executeRecaptcha;
            if (!(e.type === exports.RetriableErrorType.RequiredCatcha && enabled)) {
              _context8.next = 14;
              break;
            }
            if (!req.body) {
              _context8.next = 13;
              break;
            }
            _context8.next = 9;
            return this.getTelemetryID();
          case 9:
            req.body.dfp_telemetry_id = _context8.sent;
            _context8.next = 12;
            return executeRecaptcha();
          case 12:
            req.body.captcha_token = _context8.sent;
          case 13:
            return _context8.abrupt("return", req);
          case 14:
            throw new Error('Unable to query captcha and/or dfp telemetry ID');
          case 15:
          case "end":
            return _context8.stop();
        }
      }, _callee8, this);
    }));
  };
  this.state = bootstrapPromise.then(function (bootstrapData) {
    return __awaiter(_this2, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee9() {
      return _regeneratorRuntime().wrap(function _callee9$(_context9) {
        while (1) switch (_context9.prev = _context9.next) {
          case 0:
            if (bootstrapData.runDFPProtectedAuth) {
              _context9.next = 2;
              break;
            }
            return _context9.abrupt("return", {
              publicToken: publicToken,
              dfpBackendURL: dfpBackendURL,
              enabled: false,
              loaded: false,
              executeRecaptcha: executeRecaptcha
            });
          case 2:
            _context9.next = 4;
            return loadTelemetryJS(dfpCdnDomain);
          case 4:
            return _context9.abrupt("return", {
              publicToken: publicToken,
              dfpBackendURL: dfpBackendURL,
              enabled: true,
              mode: bootstrapData.dfpProtectedAuthMode || 'OBSERVATION',
              loaded: true,
              executeRecaptcha: executeRecaptcha
            });
          case 5:
          case "end":
            return _context9.stop();
        }
      }, _callee9);
    }));
  });
});
var DisabledDFPProtectedAuthProvider = function DisabledDFPProtectedAuthProvider() {
  return {
    isEnabled: function isEnabled() {
      return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee10() {
        return _regeneratorRuntime().wrap(function _callee10$(_context10) {
          while (1) switch (_context10.prev = _context10.next) {
            case 0:
              return _context10.abrupt("return", false);
            case 1:
            case "end":
              return _context10.stop();
          }
        }, _callee10);
      }));
    },
    getTelemetryID: function getTelemetryID() {
      return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee11() {
        return _regeneratorRuntime().wrap(function _callee11$(_context11) {
          while (1) switch (_context11.prev = _context11.next) {
            case 0:
              return _context11.abrupt("return", undefined);
            case 1:
            case "end":
              return _context11.stop();
          }
        }, _callee11);
      }));
    },
    getDFPTelemetryIDAndCaptcha: function getDFPTelemetryIDAndCaptcha() {
      return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee12() {
        return _regeneratorRuntime().wrap(function _callee12$(_context12) {
          while (1) switch (_context12.prev = _context12.next) {
            case 0:
              return _context12.abrupt("return", {
                dfp_telemetry_id: undefined,
                captcha_token: undefined
              });
            case 1:
            case "end":
              return _context12.stop();
          }
        }, _callee12);
      }));
    },
    retryWithCaptchaAndDFP: function retryWithCaptchaAndDFP() {
      return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee13() {
        return _regeneratorRuntime().wrap(function _callee13$(_context13) {
          while (1) switch (_context13.prev = _context13.next) {
            case 0:
              throw new Error('DFP protected auth is disabled');
            case 1:
            case "end":
              return _context13.stop();
          }
        }, _callee13);
      }));
    }
  };
};

/**
 * Some errors are thrown from inside an iframe, but we can't serialize them
 * to the parent in Webkit. This class handles restoring marshalled errors
 * to their original form.
 * It preserves the error instance/class constructor by inspecting err.name
 * and calling `new` on the matching constructor.
 */
var ErrorMarshaller = /*#__PURE__*/function () {
  function ErrorMarshaller() {
    _classCallCheck(this, ErrorMarshaller);
  }
  return _createClass(ErrorMarshaller, null, [{
    key: "inflate",
    value: function inflate(ErrorClass, ErrorData) {
      // !!HACK!!
      // We make the assumption that if the error takes in a required property
      // (StytchAPIError takes in an APIDetials obj...)
      // that we can just pass in the error body itself to satisfy the constructor...
      // And if the types don't work out, Object.assign(...) copies everything over anyway
      // This is a brittle and weak assumption.
      // eslint-disable-next-line @typescript-eslint/ban-ts-comment
      // @ts-ignore
      var err = new ErrorClass(ErrorData);
      Object.assign(err, ErrorData);
      Object.setPrototypeOf(err, ErrorClass.prototype);
      return err;
    }
  }, {
    key: "unmarshall",
    value: function unmarshall(error) {
      if ('name' in error) {
        switch (error.name) {
          case 'SDKAPIUnreachableError':
            return ErrorMarshaller.inflate(ui.SDKAPIUnreachableError, error);
          case 'StytchSDKSchemaError':
            return ErrorMarshaller.inflate(ui.StytchSDKSchemaError, error);
          case 'StytchAPIUnreachableError':
            return ErrorMarshaller.inflate(ui.StytchAPIUnreachableError, error);
          case 'StytchAPISchemaError':
            return ErrorMarshaller.inflate(ui.StytchAPISchemaError, error);
          case 'StytchSDKAPIError':
            return ErrorMarshaller.inflate(ui.StytchSDKAPIError, error);
          case 'StytchAPIError':
            return ErrorMarshaller.inflate(ui.StytchAPIError, error);
          case 'TypeError':
            return ErrorMarshaller.inflate(TypeError, error);
          case 'SyntaxError':
            return ErrorMarshaller.inflate(SyntaxError, error);
          case 'ReferenceError':
            return ErrorMarshaller.inflate(ReferenceError, error);
          case 'RangeError':
            return ErrorMarshaller.inflate(RangeError, error);
          case 'EvalError':
            return ErrorMarshaller.inflate(EvalError, error);
          case 'URIError':
            return ErrorMarshaller.inflate(URIError, error);
        }
      }
      return ErrorMarshaller.inflate(Error, error);
    }
  }]);
}();
var DEFAULT_MAX_BATCH_SIZE = 15;
var DEFAULT_INTERVAL_DURATION_MS = 800;
var EventLogger = /*#__PURE__*/function () {
  function EventLogger(args) {
    _classCallCheck(this, EventLogger);
    this.maxBatchSize = args.maxBatchSize;
    this.logEventURL = args.logEventURL;
    // TODO: If we create more than one of these, we'll want a mechanism to clean up the intervals
    setInterval(this.flush.bind(this), args.intervalDurationMs);
    this.batch = [];
  }
  return _createClass(EventLogger, [{
    key: "logEvent",
    value: function logEvent(telemetry, event) {
      this.batch.push({
        telemetry: telemetry,
        event: event
      });
      if (this.batch.length >= this.maxBatchSize) {
        this.flush();
      }
    }
  }, {
    key: "flush",
    value: function flush() {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee14() {
        var batchToSubmit;
        return _regeneratorRuntime().wrap(function _callee14$(_context14) {
          while (1) switch (_context14.prev = _context14.next) {
            case 0:
              if (this.batch.length) {
                _context14.next = 2;
                break;
              }
              return _context14.abrupt("return");
            case 2:
              batchToSubmit = this.batch;
              this.batch = [];
              _context14.prev = 4;
              _context14.next = 7;
              return fetch(this.logEventURL, {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify(batchToSubmit)
              });
            case 7:
              _context14.next = 11;
              break;
            case 9:
              _context14.prev = 9;
              _context14.t0 = _context14["catch"](4);
            case 11:
            case "end":
              return _context14.stop();
          }
        }, _callee14, this, [[4, 9]]);
      }));
    }
  }]);
}();
exports.EmailSentType = void 0;
(function (EmailSentType) {
  EmailSentType["LoginOrCreateEML"] = "login_or_create_eml";
  EmailSentType["LoginOrCreateOTP"] = "login_or_create_otp";
  EmailSentType["ResetPassword"] = "reset_password";
})(exports.EmailSentType || (exports.EmailSentType = {}));
var HeadlessUserClient = /*#__PURE__*/_createClass(function HeadlessUserClient(_networkClient, _subscriptionService) {
  var _this3 = this;
  _classCallCheck(this, HeadlessUserClient);
  this._networkClient = _networkClient;
  this._subscriptionService = _subscriptionService;
  this.get = function () {
    return __awaiter(_this3, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee15() {
      var resp, user;
      return _regeneratorRuntime().wrap(function _callee15$(_context15) {
        while (1) switch (_context15.prev = _context15.next) {
          case 0:
            _context15.next = 2;
            return this._networkClient.fetchSDK({
              url: '/users/me',
              method: 'GET'
            });
          case 2:
            resp = _context15.sent;
            user = removeResponseCommon(resp);
            this._subscriptionService.updateUser(user);
            return _context15.abrupt("return", user);
          case 6:
          case "end":
            return _context15.stop();
        }
      }, _callee15, this);
    }));
  };
  this.getSync = function () {
    return _this3._subscriptionService.getUser();
  };
  this.getInfo = function () {
    return {
      user: _this3.getSync(),
      fromCache: _this3._subscriptionService.getFromCache()
    };
  };
  this.update = function (options) {
    return __awaiter(_this3, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee16() {
      var resp, user;
      return _regeneratorRuntime().wrap(function _callee16$(_context16) {
        while (1) switch (_context16.prev = _context16.next) {
          case 0:
            validate('stytch.user.update').isOptionalObject('untrusted_metadata', options.untrusted_metadata);
            _context16.next = 3;
            return this._networkClient.fetchSDK({
              url: '/users/me',
              body: options,
              method: 'PUT'
            });
          case 3:
            resp = _context16.sent;
            user = removeResponseCommon(resp.__user);
            this._subscriptionService.updateUser(user);
            return _context16.abrupt("return", omitUser(resp));
          case 7:
          case "end":
            return _context16.stop();
        }
      }, _callee16, this);
    }));
  };
  this.deleteEmail = function (emailId) {
    return __awaiter(_this3, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee17() {
      var resp, user;
      return _regeneratorRuntime().wrap(function _callee17$(_context17) {
        while (1) switch (_context17.prev = _context17.next) {
          case 0:
            _context17.next = 2;
            return this._networkClient.fetchSDK({
              url: "/users/emails/".concat(emailId),
              method: 'DELETE'
            });
          case 2:
            resp = _context17.sent;
            user = removeResponseCommon(resp.__user);
            this._subscriptionService.updateUser(user);
            return _context17.abrupt("return", omitUser(resp));
          case 6:
          case "end":
            return _context17.stop();
        }
      }, _callee17, this);
    }));
  };
  this.deletePhoneNumber = function (phoneId) {
    return __awaiter(_this3, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee18() {
      var resp, user;
      return _regeneratorRuntime().wrap(function _callee18$(_context18) {
        while (1) switch (_context18.prev = _context18.next) {
          case 0:
            _context18.next = 2;
            return this._networkClient.fetchSDK({
              url: "/users/phone_numbers/".concat(phoneId),
              method: 'DELETE'
            });
          case 2:
            resp = _context18.sent;
            user = removeResponseCommon(resp.__user);
            this._subscriptionService.updateUser(user);
            return _context18.abrupt("return", omitUser(resp));
          case 6:
          case "end":
            return _context18.stop();
        }
      }, _callee18, this);
    }));
  };
  this.deleteTOTP = function (totpId) {
    return __awaiter(_this3, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee19() {
      var resp, user;
      return _regeneratorRuntime().wrap(function _callee19$(_context19) {
        while (1) switch (_context19.prev = _context19.next) {
          case 0:
            _context19.next = 2;
            return this._networkClient.fetchSDK({
              url: "/users/totps/".concat(totpId),
              method: 'DELETE'
            });
          case 2:
            resp = _context19.sent;
            user = removeResponseCommon(resp.__user);
            this._subscriptionService.updateUser(user);
            return _context19.abrupt("return", omitUser(resp));
          case 6:
          case "end":
            return _context19.stop();
        }
      }, _callee19, this);
    }));
  };
  this.deleteCryptoWallet = function (cryptoWalletId) {
    return __awaiter(_this3, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee20() {
      var resp, user;
      return _regeneratorRuntime().wrap(function _callee20$(_context20) {
        while (1) switch (_context20.prev = _context20.next) {
          case 0:
            _context20.next = 2;
            return this._networkClient.fetchSDK({
              url: "/users/crypto_wallets/".concat(cryptoWalletId),
              method: 'DELETE'
            });
          case 2:
            resp = _context20.sent;
            user = removeResponseCommon(resp.__user);
            this._subscriptionService.updateUser(user);
            return _context20.abrupt("return", omitUser(resp));
          case 6:
          case "end":
            return _context20.stop();
        }
      }, _callee20, this);
    }));
  };
  this.deleteOAuthRegistration = function (oauthUserRegistrationId) {
    return __awaiter(_this3, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee21() {
      var resp, user;
      return _regeneratorRuntime().wrap(function _callee21$(_context21) {
        while (1) switch (_context21.prev = _context21.next) {
          case 0:
            _context21.next = 2;
            return this._networkClient.fetchSDK({
              url: "/users/oauth/".concat(oauthUserRegistrationId),
              method: 'DELETE'
            });
          case 2:
            resp = _context21.sent;
            user = removeResponseCommon(resp.__user);
            this._subscriptionService.updateUser(user);
            return _context21.abrupt("return", omitUser(resp));
          case 6:
          case "end":
            return _context21.stop();
        }
      }, _callee21, this);
    }));
  };
  this.deleteWebauthnRegistration = function (webAuthnId) {
    return __awaiter(_this3, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee22() {
      var resp, user;
      return _regeneratorRuntime().wrap(function _callee22$(_context22) {
        while (1) switch (_context22.prev = _context22.next) {
          case 0:
            _context22.next = 2;
            return this._networkClient.fetchSDK({
              url: "/users/webauthn_registrations/".concat(webAuthnId),
              method: 'DELETE'
            });
          case 2:
            resp = _context22.sent;
            user = removeResponseCommon(resp.__user);
            this._subscriptionService.updateUser(user);
            return _context22.abrupt("return", omitUser(resp));
          case 6:
          case "end":
            return _context22.stop();
        }
      }, _callee22, this);
    }));
  };
  this.deleteBiometricRegistration = function (biometricRegistrationId) {
    return __awaiter(_this3, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee23() {
      var resp, user;
      return _regeneratorRuntime().wrap(function _callee23$(_context23) {
        while (1) switch (_context23.prev = _context23.next) {
          case 0:
            _context23.next = 2;
            return this._networkClient.fetchSDK({
              url: "/users/biometric_registrations/".concat(biometricRegistrationId),
              method: 'DELETE'
            });
          case 2:
            resp = _context23.sent;
            user = removeResponseCommon(resp.__user);
            this._subscriptionService.updateUser(user);
            return _context23.abrupt("return", omitUser(resp));
          case 6:
          case "end":
            return _context23.stop();
        }
      }, _callee23, this);
    }));
  };
  this.onChange = function (callback) {
    var lastVal = _this3._subscriptionService.getUser();
    var listener = function listener(state) {
      var _a;
      if ((state === null || state === void 0 ? void 0 : state.user) !== lastVal) {
        lastVal = (_a = state === null || state === void 0 ? void 0 : state.user) !== null && _a !== void 0 ? _a : null;
        callback(lastVal);
      }
    };
    return _this3._subscriptionService.subscribeToState(listener);
  };
});
var HeadlessSessionClient = /*#__PURE__*/function () {
  function HeadlessSessionClient(_networkClient, _subscriptionService) {
    var _this4 = this;
    _classCallCheck(this, HeadlessSessionClient);
    this._networkClient = _networkClient;
    this._subscriptionService = _subscriptionService;
    this.getSync = function () {
      return _this4._subscriptionService.getSession();
    };
    this.getInfo = function () {
      var session = _this4.getSync();
      var fromCache = _this4._subscriptionService.getFromCache();
      return {
        session: session,
        fromCache: fromCache
      };
    };
    this.onChange = function (callback) {
      var lastVal = _this4._subscriptionService.getSession();
      var listener = function listener(state) {
        var _a;
        if ((state === null || state === void 0 ? void 0 : state.session) !== lastVal) {
          lastVal = (_a = state === null || state === void 0 ? void 0 : state.session) !== null && _a !== void 0 ? _a : null;
          callback(lastVal);
        }
      };
      return _this4._subscriptionService.subscribeToState(listener);
    };
    this.revoke = function (options) {
      return __awaiter(_this4, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee24() {
        var resp;
        return _regeneratorRuntime().wrap(function _callee24$(_context24) {
          while (1) switch (_context24.prev = _context24.next) {
            case 0:
              _context24.prev = 0;
              _context24.next = 3;
              return this._networkClient.fetchSDK({
                url: "/sessions/revoke",
                method: 'POST'
              });
            case 3:
              resp = _context24.sent;
              this._subscriptionService.destroyState();
              return _context24.abrupt("return", resp);
            case 8:
              _context24.prev = 8;
              _context24.t0 = _context24["catch"](0);
              if (!!(options === null || options === void 0 ? void 0 : options.forceClear)) {
                this._subscriptionService.destroyState();
              } else if (ui.UNRECOVERABLE_ERROR_TYPES.includes(_context24.t0.error_type)) {
                this._subscriptionService.destroyState();
              }
              throw _context24.t0;
            case 12:
            case "end":
              return _context24.stop();
          }
        }, _callee24, this, [[0, 8]]);
      }));
    };
    this.authenticate = function (options) {
      return __awaiter(_this4, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee25() {
        var _this5 = this;
        var initialSession, isSessionStale, requestBody, resp;
        return _regeneratorRuntime().wrap(function _callee25$(_context25) {
          while (1) switch (_context25.prev = _context25.next) {
            case 0:
              initialSession = this._subscriptionService.getSession();
              isSessionStale = function isSessionStale() {
                var _a;
                return (initialSession === null || initialSession === void 0 ? void 0 : initialSession.session_id) !== ((_a = _this5._subscriptionService.getSession()) === null || _a === void 0 ? void 0 : _a.session_id);
              };
              _context25.prev = 2;
              requestBody = {
                session_duration_minutes: options === null || options === void 0 ? void 0 : options.session_duration_minutes
              };
              _context25.next = 6;
              return this._networkClient.fetchSDK({
                url: '/sessions/authenticate',
                body: requestBody,
                method: 'POST'
              });
            case 6:
              resp = _context25.sent;
              if (!isSessionStale()) {
                _context25.next = 9;
                break;
              }
              return _context25.abrupt("return", this.authenticate(options));
            case 9:
              this._subscriptionService.updateSession(resp);
              return _context25.abrupt("return", omitUser(resp));
            case 13:
              _context25.prev = 13;
              _context25.t0 = _context25["catch"](2);
              if (!isSessionStale()) {
                _context25.next = 17;
                break;
              }
              return _context25.abrupt("return", this.authenticate(options));
            case 17:
              if (ui.UNRECOVERABLE_ERROR_TYPES.includes(_context25.t0.error_type)) {
                this._subscriptionService.destroySession();
              }
              throw _context25.t0;
            case 19:
            case "end":
              return _context25.stop();
          }
        }, _callee25, this, [[2, 13]]);
      }));
    };
  }
  return _createClass(HeadlessSessionClient, [{
    key: "getTokens",
    value: function getTokens() {
      return this._subscriptionService.getTokens();
    }
  }, {
    key: "updateSession",
    value: function updateSession(tokens) {
      var _a;
      validate('stytch.session.updateSession').isString('session_token', tokens.session_token).isOptionalString('session_jwt', (_a = tokens.session_jwt) !== null && _a !== void 0 ? _a : undefined);
      this._subscriptionService.updateTokens(tokens);
    }
  }]);
}();
var DefaultDynamicConfig$4 = Promise.resolve({
  pkceRequiredForEmailMagicLinks: false
});
var HeadlessMagicLinksClient = /*#__PURE__*/function () {
  function HeadlessMagicLinksClient(_networkClient, _subscriptionService, _pkceManager, _passwordResetPKCEManager) {
    var _this6 = this;
    var _config = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : DefaultDynamicConfig$4;
    var dfpProtectedAuth = arguments.length > 5 ? arguments[5] : undefined;
    _classCallCheck(this, HeadlessMagicLinksClient);
    this._networkClient = _networkClient;
    this._subscriptionService = _subscriptionService;
    this._pkceManager = _pkceManager;
    this._passwordResetPKCEManager = _passwordResetPKCEManager;
    this._config = _config;
    this.dfpProtectedAuth = dfpProtectedAuth;
    this.email = {
      loginOrCreate: function loginOrCreate(email) {
        var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
        return __awaiter(_this6, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee26() {
          var _yield$this$_config, pkceRequiredForEmailMagicLinks, code_challenge, _yield$this$dfpProtec, dfp_telemetry_id, captcha_token, requestBody;
          return _regeneratorRuntime().wrap(function _callee26$(_context26) {
            while (1) switch (_context26.prev = _context26.next) {
              case 0:
                _context26.next = 2;
                return this._config;
              case 2:
                _yield$this$_config = _context26.sent;
                pkceRequiredForEmailMagicLinks = _yield$this$_config.pkceRequiredForEmailMagicLinks;
                code_challenge = undefined;
                if (!pkceRequiredForEmailMagicLinks) {
                  _context26.next = 9;
                  break;
                }
                _context26.next = 8;
                return this.getCodeChallenge();
              case 8:
                code_challenge = _context26.sent;
              case 9:
                _context26.next = 11;
                return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
              case 11:
                _yield$this$dfpProtec = _context26.sent;
                dfp_telemetry_id = _yield$this$dfpProtec.dfp_telemetry_id;
                captcha_token = _yield$this$dfpProtec.captcha_token;
                requestBody = Object.assign(Object.assign({}, options), {
                  email: email,
                  code_challenge: code_challenge,
                  captcha_token: captcha_token,
                  dfp_telemetry_id: dfp_telemetry_id
                });
                return _context26.abrupt("return", this._networkClient.retriableFetchSDK({
                  url: '/magic_links/email/login_or_create',
                  body: requestBody,
                  method: 'POST',
                  retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
                }));
              case 16:
              case "end":
                return _context26.stop();
            }
          }, _callee26, this);
        }));
      },
      send: function send(email) {
        var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
        return __awaiter(_this6, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee27() {
          var _yield$this$_config2, pkceRequiredForEmailMagicLinks, code_challenge, _yield$this$dfpProtec2, dfp_telemetry_id, captcha_token, requestBody, isLoggedIn, endpoint;
          return _regeneratorRuntime().wrap(function _callee27$(_context27) {
            while (1) switch (_context27.prev = _context27.next) {
              case 0:
                _context27.next = 2;
                return this._config;
              case 2:
                _yield$this$_config2 = _context27.sent;
                pkceRequiredForEmailMagicLinks = _yield$this$_config2.pkceRequiredForEmailMagicLinks;
                code_challenge = undefined;
                if (!pkceRequiredForEmailMagicLinks) {
                  _context27.next = 9;
                  break;
                }
                _context27.next = 8;
                return this.getCodeChallenge();
              case 8:
                code_challenge = _context27.sent;
              case 9:
                _context27.next = 11;
                return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
              case 11:
                _yield$this$dfpProtec2 = _context27.sent;
                dfp_telemetry_id = _yield$this$dfpProtec2.dfp_telemetry_id;
                captcha_token = _yield$this$dfpProtec2.captcha_token;
                requestBody = Object.assign(Object.assign({}, options), {
                  email: email,
                  code_challenge: code_challenge,
                  captcha_token: captcha_token,
                  dfp_telemetry_id: dfp_telemetry_id
                });
                isLoggedIn = !!this._subscriptionService.getSession();
                endpoint = isLoggedIn ? '/magic_links/email/send/secondary' : '/magic_links/email/send/primary';
                return _context27.abrupt("return", this._networkClient.retriableFetchSDK({
                  url: endpoint,
                  body: requestBody,
                  method: 'POST',
                  retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
                }));
              case 18:
              case "end":
                return _context27.stop();
            }
          }, _callee27, this);
        }));
      }
    };
    this.authenticate = function (token, options) {
      return __awaiter(_this6, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee28() {
        var passwordResetPKPair, resp;
        return _regeneratorRuntime().wrap(function _callee28$(_context28) {
          while (1) switch (_context28.prev = _context28.next) {
            case 0:
              validate('stytch.magicLinks.authenticate').isString('Token', token).isNumber('session_duration_minutes', options.session_duration_minutes);
              // When a user resets their password with PKCE turned on, they create a pkPair in the 'passwords' namespace.
              // However, when the user gets the reset password email, they have the option to log in without a password.
              // This redirects them to the magic link authenticate flow, which automatically looks for the pkce code_verifier
              // in the 'magic_links' namespace, breaking the flow. Unfortunately we won't know for sure in the eml authenticate call
              // whether or not the user is coming from a password reset flow. To handle this, we have to try to authenticate with
              // both the 'passwords' and 'magic_links' code_verifiers.
              _context28.next = 3;
              return this._passwordResetPKCEManager.getPKPair();
            case 3:
              passwordResetPKPair = _context28.sent;
              resp = null;
              if (!(passwordResetPKPair === null || passwordResetPKPair === void 0 ? void 0 : passwordResetPKPair.code_verifier)) {
                _context28.next = 19;
                break;
              }
              _context28.prev = 6;
              _context28.next = 9;
              return this.handlePKCEForAuthenticate(this._passwordResetPKCEManager, Object.assign(Object.assign({}, options), {
                token: token
              }));
            case 9:
              resp = _context28.sent;
              _context28.next = 19;
              break;
            case 12:
              _context28.prev = 12;
              _context28.t0 = _context28["catch"](6);
              if (!_context28.t0.message.includes('pkce')) {
                _context28.next = 18;
                break;
              }
              // If pkce-related error, fall back to magic links code_verifier
              // eslint-disable-next-line no-console
              console.log('Authenticate with passwords pkce namespace failed. Falling back to authenticate with magic_links namespace.');
              _context28.next = 19;
              break;
            case 18:
              throw _context28.t0;
            case 19:
              if (resp) {
                _context28.next = 23;
                break;
              }
              _context28.next = 22;
              return this.handlePKCEForAuthenticate(this._pkceManager, Object.assign(Object.assign({}, options), {
                token: token
              }));
            case 22:
              resp = _context28.sent;
            case 23:
              this._subscriptionService.updateSession(resp);
              return _context28.abrupt("return", omitUser(resp));
            case 25:
            case "end":
              return _context28.stop();
          }
        }, _callee28, this, [[6, 12]]);
      }));
    };
  }
  return _createClass(HeadlessMagicLinksClient, [{
    key: "getCodeChallenge",
    value: function getCodeChallenge() {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee29() {
        var keyPair;
        return _regeneratorRuntime().wrap(function _callee29$(_context29) {
          while (1) switch (_context29.prev = _context29.next) {
            case 0:
              _context29.next = 2;
              return this._pkceManager.getPKPair();
            case 2:
              keyPair = _context29.sent;
              if (!keyPair) {
                _context29.next = 5;
                break;
              }
              return _context29.abrupt("return", keyPair.code_challenge);
            case 5:
              _context29.next = 7;
              return this._pkceManager.startPKCETransaction();
            case 7:
              keyPair = _context29.sent;
              return _context29.abrupt("return", keyPair.code_challenge);
            case 9:
            case "end":
              return _context29.stop();
          }
        }, _callee29, this);
      }));
    }
  }, {
    key: "handlePKCEForAuthenticate",
    value: function handlePKCEForAuthenticate(pkceManager, data) {
      var _a, _b;
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee30() {
        var pkPair, _yield$this$_config3, pkceRequiredForEmailMagicLinks, requestBody, resp;
        return _regeneratorRuntime().wrap(function _callee30$(_context30) {
          while (1) switch (_context30.prev = _context30.next) {
            case 0:
              _context30.next = 2;
              return pkceManager.getPKPair();
            case 2:
              pkPair = _context30.sent;
              _context30.next = 5;
              return this._config;
            case 5:
              _yield$this$_config3 = _context30.sent;
              pkceRequiredForEmailMagicLinks = _yield$this$_config3.pkceRequiredForEmailMagicLinks;
              if (!(pkceRequiredForEmailMagicLinks && (!pkPair || !(pkPair === null || pkPair === void 0 ? void 0 : pkPair.code_verifier) || ((_b = (_a = pkPair === null || pkPair === void 0 ? void 0 : pkPair.code_verifier) === null || _a === void 0 ? void 0 : _a.trim()) === null || _b === void 0 ? void 0 : _b.length) === 0))) {
                _context30.next = 9;
                break;
              }
              throw new ui.MissingPKCEError();
            case 9:
              requestBody = Object.assign({
                code_verifier: pkPair === null || pkPair === void 0 ? void 0 : pkPair.code_verifier
              }, data);
              _context30.next = 12;
              return this._networkClient.fetchSDK({
                url: '/magic_links/authenticate',
                body: requestBody,
                method: 'POST'
              });
            case 12:
              resp = _context30.sent;
              pkceManager.clearPKPair();
              return _context30.abrupt("return", resp);
            case 15:
            case "end":
              return _context30.stop();
          }
        }, _callee30, this);
      }));
    }
  }]);
}();
var HeadlessOTPClient = /*#__PURE__*/_createClass(function HeadlessOTPClient(_networkClient, _subscriptionService) {
  var _this7 = this;
  var executeRecaptcha = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function () {
    return Promise.resolve(undefined);
  };
  var dfpProtectedAuth = arguments.length > 3 ? arguments[3] : undefined;
  _classCallCheck(this, HeadlessOTPClient);
  this._networkClient = _networkClient;
  this._subscriptionService = _subscriptionService;
  this.executeRecaptcha = executeRecaptcha;
  this.dfpProtectedAuth = dfpProtectedAuth;
  this.sms = {
    loginOrCreate: function loginOrCreate(phone_number, options) {
      return __awaiter(_this7, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee31() {
        var _yield$this$dfpProtec3, dfp_telemetry_id, captcha_token, requestBody;
        return _regeneratorRuntime().wrap(function _callee31$(_context31) {
          while (1) switch (_context31.prev = _context31.next) {
            case 0:
              _context31.next = 2;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 2:
              _yield$this$dfpProtec3 = _context31.sent;
              dfp_telemetry_id = _yield$this$dfpProtec3.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec3.captcha_token;
              requestBody = Object.assign(Object.assign({}, options), {
                phone_number: phone_number,
                captcha_token: captcha_token,
                dfp_telemetry_id: dfp_telemetry_id
              });
              return _context31.abrupt("return", this._networkClient.retriableFetchSDK({
                url: '/otps/sms/login_or_create',
                body: requestBody,
                method: 'POST',
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              }));
            case 7:
            case "end":
              return _context31.stop();
          }
        }, _callee31, this);
      }));
    },
    send: function send(phone_number, options) {
      return __awaiter(_this7, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee32() {
        var _yield$this$dfpProtec4, dfp_telemetry_id, captcha_token, requestBody, isLoggedIn, endpoint;
        return _regeneratorRuntime().wrap(function _callee32$(_context32) {
          while (1) switch (_context32.prev = _context32.next) {
            case 0:
              _context32.next = 2;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 2:
              _yield$this$dfpProtec4 = _context32.sent;
              dfp_telemetry_id = _yield$this$dfpProtec4.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec4.captcha_token;
              requestBody = Object.assign(Object.assign({}, options), {
                phone_number: phone_number,
                captcha_token: captcha_token,
                dfp_telemetry_id: dfp_telemetry_id
              });
              isLoggedIn = !!this._subscriptionService.getSession();
              endpoint = isLoggedIn ? '/otps/sms/send/secondary' : '/otps/sms/send/primary';
              return _context32.abrupt("return", this._networkClient.retriableFetchSDK({
                url: endpoint,
                body: requestBody,
                method: 'POST',
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              }));
            case 9:
            case "end":
              return _context32.stop();
          }
        }, _callee32, this);
      }));
    }
  };
  this.whatsapp = {
    loginOrCreate: function loginOrCreate(phone_number, options) {
      return __awaiter(_this7, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee33() {
        var _yield$this$dfpProtec5, dfp_telemetry_id, captcha_token, requestBody;
        return _regeneratorRuntime().wrap(function _callee33$(_context33) {
          while (1) switch (_context33.prev = _context33.next) {
            case 0:
              _context33.next = 2;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 2:
              _yield$this$dfpProtec5 = _context33.sent;
              dfp_telemetry_id = _yield$this$dfpProtec5.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec5.captcha_token;
              requestBody = Object.assign(Object.assign({}, options), {
                phone_number: phone_number,
                dfp_telemetry_id: dfp_telemetry_id,
                captcha_token: captcha_token
              });
              return _context33.abrupt("return", this._networkClient.retriableFetchSDK({
                url: '/otps/whatsapp/login_or_create',
                body: requestBody,
                method: 'POST',
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              }));
            case 7:
            case "end":
              return _context33.stop();
          }
        }, _callee33, this);
      }));
    },
    send: function send(phone_number, options) {
      return __awaiter(_this7, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee34() {
        var _yield$this$dfpProtec6, dfp_telemetry_id, captcha_token, requestBody, isLoggedIn, endpoint;
        return _regeneratorRuntime().wrap(function _callee34$(_context34) {
          while (1) switch (_context34.prev = _context34.next) {
            case 0:
              _context34.next = 2;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 2:
              _yield$this$dfpProtec6 = _context34.sent;
              dfp_telemetry_id = _yield$this$dfpProtec6.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec6.captcha_token;
              requestBody = Object.assign(Object.assign({}, options), {
                phone_number: phone_number,
                captcha_token: captcha_token,
                dfp_telemetry_id: dfp_telemetry_id
              });
              isLoggedIn = !!this._subscriptionService.getSession();
              endpoint = isLoggedIn ? '/otps/whatsapp/send/secondary' : '/otps/whatsapp/send/primary';
              return _context34.abrupt("return", this._networkClient.retriableFetchSDK({
                url: endpoint,
                body: requestBody,
                method: 'POST',
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              }));
            case 9:
            case "end":
              return _context34.stop();
          }
        }, _callee34, this);
      }));
    }
  };
  this.email = {
    loginOrCreate: function loginOrCreate(email, options) {
      return __awaiter(_this7, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee35() {
        var _yield$this$dfpProtec7, dfp_telemetry_id, captcha_token, requestBody;
        return _regeneratorRuntime().wrap(function _callee35$(_context35) {
          while (1) switch (_context35.prev = _context35.next) {
            case 0:
              _context35.next = 2;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 2:
              _yield$this$dfpProtec7 = _context35.sent;
              dfp_telemetry_id = _yield$this$dfpProtec7.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec7.captcha_token;
              requestBody = Object.assign(Object.assign({}, options), {
                email: email,
                captcha_token: captcha_token,
                dfp_telemetry_id: dfp_telemetry_id
              });
              return _context35.abrupt("return", this._networkClient.retriableFetchSDK({
                url: '/otps/email/login_or_create',
                body: requestBody,
                method: 'POST',
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              }));
            case 7:
            case "end":
              return _context35.stop();
          }
        }, _callee35, this);
      }));
    },
    send: function send(email, options) {
      return __awaiter(_this7, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee36() {
        var captcha_token, requestBody, isLoggedIn, endpoint;
        return _regeneratorRuntime().wrap(function _callee36$(_context36) {
          while (1) switch (_context36.prev = _context36.next) {
            case 0:
              _context36.next = 2;
              return this.executeRecaptcha();
            case 2:
              captcha_token = _context36.sent;
              requestBody = Object.assign(Object.assign({}, options), {
                email: email,
                captcha_token: captcha_token
              });
              isLoggedIn = !!this._subscriptionService.getSession();
              endpoint = isLoggedIn ? '/otps/email/send/secondary' : '/otps/email/send/primary';
              return _context36.abrupt("return", this._networkClient.fetchSDK({
                url: endpoint,
                body: requestBody,
                method: 'POST'
              }));
            case 7:
            case "end":
              return _context36.stop();
          }
        }, _callee36, this);
      }));
    }
  };
  this.authenticate = function (code, method_id, options) {
    return __awaiter(_this7, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee37() {
      var _yield$this$dfpProtec8, dfp_telemetry_id, captcha_token, requestBody, resp;
      return _regeneratorRuntime().wrap(function _callee37$(_context37) {
        while (1) switch (_context37.prev = _context37.next) {
          case 0:
            validate('stytch.otps.authenticate').isString('Code', code).isNumber('session_duration_minutes', options.session_duration_minutes);
            _context37.next = 3;
            return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
          case 3:
            _yield$this$dfpProtec8 = _context37.sent;
            dfp_telemetry_id = _yield$this$dfpProtec8.dfp_telemetry_id;
            captcha_token = _yield$this$dfpProtec8.captcha_token;
            requestBody = Object.assign({
              token: code,
              method_id: method_id,
              dfp_telemetry_id: dfp_telemetry_id,
              captcha_token: captcha_token
            }, options);
            _context37.next = 9;
            return this._networkClient.retriableFetchSDK({
              url: '/otps/authenticate',
              body: requestBody,
              method: 'POST',
              retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
            });
          case 9:
            resp = _context37.sent;
            this._subscriptionService.updateSession(resp);
            return _context37.abrupt("return", omitUser(resp));
          case 12:
          case "end":
            return _context37.stop();
        }
      }, _callee37, this);
    }));
  };
});
var HeadlessOAuthClient = /*#__PURE__*/function () {
  function HeadlessOAuthClient(_networkClient, _subscriptionService, _pkceManager, _dynamicConfig, _config) {
    _classCallCheck(this, HeadlessOAuthClient);
    this._networkClient = _networkClient;
    this._subscriptionService = _subscriptionService;
    this._pkceManager = _pkceManager;
    this._dynamicConfig = _dynamicConfig;
    this._config = _config;
    this.google = {
      start: this.startOAuthFlow(ui.OAuthProviders.Google)
    };
    this.apple = {
      start: this.startOAuthFlow(ui.OAuthProviders.Apple)
    };
    this.microsoft = {
      start: this.startOAuthFlow(ui.OAuthProviders.Microsoft)
    };
    this.github = {
      start: this.startOAuthFlow(ui.OAuthProviders.Github)
    };
    this.gitlab = {
      start: this.startOAuthFlow(ui.OAuthProviders.GitLab)
    };
    this.facebook = {
      start: this.startOAuthFlow(ui.OAuthProviders.Facebook)
    };
    this.discord = {
      start: this.startOAuthFlow(ui.OAuthProviders.Discord)
    };
    this.salesforce = {
      start: this.startOAuthFlow(ui.OAuthProviders.Salesforce)
    };
    this.slack = {
      start: this.startOAuthFlow(ui.OAuthProviders.Slack)
    };
    this.amazon = {
      start: this.startOAuthFlow(ui.OAuthProviders.Amazon)
    };
    this.bitbucket = {
      start: this.startOAuthFlow(ui.OAuthProviders.Bitbucket)
    };
    this.linkedin = {
      start: this.startOAuthFlow(ui.OAuthProviders.LinkedIn)
    };
    this.coinbase = {
      start: this.startOAuthFlow(ui.OAuthProviders.Coinbase)
    };
    this.twitch = {
      start: this.startOAuthFlow(ui.OAuthProviders.Twitch)
    };
    this.twitter = {
      start: this.startOAuthFlow(ui.OAuthProviders.Twitter)
    };
    this.tiktok = {
      start: this.startOAuthFlow(ui.OAuthProviders.TikTok)
    };
    this.snapchat = {
      start: this.startOAuthFlow(ui.OAuthProviders.Snapchat)
    };
    this.figma = {
      start: this.startOAuthFlow(ui.OAuthProviders.Figma)
    };
    this.yahoo = {
      start: this.startOAuthFlow(ui.OAuthProviders.Yahoo)
    };
  }
  return _createClass(HeadlessOAuthClient, [{
    key: "authenticate",
    value: function authenticate(token, options) {
      var _a, _b;
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee38() {
        var keyPair, _yield$this$_dynamicC, pkceRequiredForOAuth, resp;
        return _regeneratorRuntime().wrap(function _callee38$(_context38) {
          while (1) switch (_context38.prev = _context38.next) {
            case 0:
              validate('stytch.oauth.authenticate').isString('Token', token).isNumber('session_duration_minutes', options.session_duration_minutes);
              _context38.next = 3;
              return this._pkceManager.getPKPair();
            case 3:
              keyPair = _context38.sent;
              _context38.next = 6;
              return this._dynamicConfig;
            case 6:
              _yield$this$_dynamicC = _context38.sent;
              pkceRequiredForOAuth = _yield$this$_dynamicC.pkceRequiredForOAuth;
              if (!(pkceRequiredForOAuth && (!keyPair || !(keyPair === null || keyPair === void 0 ? void 0 : keyPair.code_verifier) || ((_b = (_a = keyPair === null || keyPair === void 0 ? void 0 : keyPair.code_verifier) === null || _a === void 0 ? void 0 : _a.trim()) === null || _b === void 0 ? void 0 : _b.length) === 0))) {
                _context38.next = 10;
                break;
              }
              throw new ui.MissingPKCEError();
            case 10:
              if (!keyPair) {
                logger.warn('No code verifier found in local storage for OAuth flow.\n' + 'Consider using stytch.oauth.$provider.start() to add PKCE to your OAuth flows for added security.\n' + 'See https://stytch.com/docs/oauth#guides_pkce for more information.');
              }
              _context38.next = 13;
              return this._networkClient.fetchSDK({
                url: '/oauth/authenticate',
                method: 'POST',
                body: Object.assign({
                  token: token,
                  code_verifier: keyPair === null || keyPair === void 0 ? void 0 : keyPair.code_verifier
                }, options)
              });
            case 13:
              resp = _context38.sent;
              this._pkceManager.clearPKPair();
              this._subscriptionService.updateSession(resp);
              return _context38.abrupt("return", omitUser(resp));
            case 17:
            case "end":
              return _context38.stop();
          }
        }, _callee38, this);
      }));
    }
  }, {
    key: "getBaseApiUrl",
    value: function getBaseApiUrl() {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee39() {
        var _yield$this$_dynamicC2, cnameDomain;
        return _regeneratorRuntime().wrap(function _callee39$(_context39) {
          while (1) switch (_context39.prev = _context39.next) {
            case 0:
              _context39.next = 2;
              return this._dynamicConfig;
            case 2:
              _yield$this$_dynamicC2 = _context39.sent;
              cnameDomain = _yield$this$_dynamicC2.cnameDomain;
              if (!cnameDomain) {
                _context39.next = 6;
                break;
              }
              return _context39.abrupt("return", "https://".concat(cnameDomain));
            case 6:
              if (!isTestPublicToken(this._config.publicToken)) {
                _context39.next = 8;
                break;
              }
              return _context39.abrupt("return", this._config.testAPIURL);
            case 8:
              return _context39.abrupt("return", this._config.liveAPIURL);
            case 9:
            case "end":
              return _context39.stop();
          }
        }, _callee39, this);
      }));
    }
  }, {
    key: "startOAuthFlow",
    value: function startOAuthFlow(providerType) {
      var _this8 = this;
      return function () {
        var _ref6 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
          login_redirect_url = _ref6.login_redirect_url,
          signup_redirect_url = _ref6.signup_redirect_url,
          custom_scopes = _ref6.custom_scopes,
          provider_params = _ref6.provider_params;
        return __awaiter(_this8, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee40() {
          var _yield$this$_dynamicC3, cnameDomain, pkceRequiredForOAuth, baseURL, oauthUrl, keyPair, key;
          return _regeneratorRuntime().wrap(function _callee40$(_context40) {
            while (1) switch (_context40.prev = _context40.next) {
              case 0:
                _context40.next = 2;
                return this._dynamicConfig;
              case 2:
                _yield$this$_dynamicC3 = _context40.sent;
                cnameDomain = _yield$this$_dynamicC3.cnameDomain;
                pkceRequiredForOAuth = _yield$this$_dynamicC3.pkceRequiredForOAuth;
                _context40.next = 7;
                return this.getBaseApiUrl();
              case 7:
                baseURL = _context40.sent;
                this._networkClient.logEvent({
                  name: 'start_oauth_flow',
                  details: {
                    provider_type: providerType,
                    custom_scopes: custom_scopes,
                    cname_domain: cnameDomain,
                    pkce: pkceRequiredForOAuth,
                    provider_params: provider_params
                  }
                });
                oauthUrl = new URL("".concat(baseURL, "/v1/public/oauth/").concat(providerType, "/start"));
                oauthUrl.searchParams.set('public_token', this._config.publicToken);
                if (!pkceRequiredForOAuth) {
                  _context40.next = 18;
                  break;
                }
                _context40.next = 14;
                return this._pkceManager.startPKCETransaction();
              case 14:
                keyPair = _context40.sent;
                oauthUrl.searchParams.set('code_challenge', keyPair.code_challenge);
                _context40.next = 19;
                break;
              case 18:
                this._pkceManager.clearPKPair();
              case 19:
                if (custom_scopes) {
                  validate('startOAuthFlow').isStringArray('custom_scopes', custom_scopes);
                  oauthUrl.searchParams.set('custom_scopes', custom_scopes.join(' '));
                }
                if (provider_params) {
                  validate('startOAuthFlow').isOptionalObject('provider_params', provider_params);
                  for (key in provider_params) {
                    oauthUrl.searchParams.set('provider_' + key, provider_params[key]);
                  }
                }
                login_redirect_url && oauthUrl.searchParams.set('login_redirect_url', login_redirect_url);
                signup_redirect_url && oauthUrl.searchParams.set('signup_redirect_url', signup_redirect_url);
                window.location.href = oauthUrl.toString();
              case 24:
              case "end":
                return _context40.stop();
            }
          }, _callee40, this);
        }));
      };
    }
  }]);
}();
var DefaultDynamicConfig$3 = Promise.resolve({
  siweRequiredForCryptoWallets: false
});
var HeadlessCryptoWalletClient = /*#__PURE__*/function () {
  function HeadlessCryptoWalletClient(_networkClient, _apiNetworkClient, _subscriptionService) {
    var executeRecaptcha = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : function () {
      return Promise.resolve(undefined);
    };
    var dfpProtectedAuth = arguments.length > 4 ? arguments[4] : undefined;
    var _config = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : DefaultDynamicConfig$3;
    _classCallCheck(this, HeadlessCryptoWalletClient);
    this._networkClient = _networkClient;
    this._apiNetworkClient = _apiNetworkClient;
    this._subscriptionService = _subscriptionService;
    this.executeRecaptcha = executeRecaptcha;
    this.dfpProtectedAuth = dfpProtectedAuth;
    this._config = _config;
  }
  return _createClass(HeadlessCryptoWalletClient, [{
    key: "authenticateStart",
    value: function authenticateStart(options) {
      var _a;
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee41() {
        var isLoggedIn, captcha_token, _yield$this$_config4, siweRequiredForCryptoWallets, body, endpoint, requestBody;
        return _regeneratorRuntime().wrap(function _callee41$(_context41) {
          while (1) switch (_context41.prev = _context41.next) {
            case 0:
              validate('stytch.cryptoWallets.authenticateStart').isString('crypto_wallet_address', options.crypto_wallet_address).isString('crypto_wallet_type', options.crypto_wallet_type);
              if (options.siwe_params) {
                validate('stytch.cryptoWallets.authenticateStart').isOptionalString('uri', options.siwe_params.uri).isOptionalString('chain_id', options.siwe_params.chain_id).isOptionalString('issued_at', options.siwe_params.issued_at).isOptionalString('statement', options.siwe_params.statement).isOptionalString('not_before', options.siwe_params.not_before).isOptionalString('message_request_id', options.siwe_params.message_request_id).isOptionalStringArray('resources', options.siwe_params.resources);
              }
              isLoggedIn = !!this._subscriptionService.getSession();
              _context41.next = 5;
              return this.executeRecaptcha();
            case 5:
              captcha_token = _context41.sent;
              _context41.next = 8;
              return this._config;
            case 8:
              _yield$this$_config4 = _context41.sent;
              siweRequiredForCryptoWallets = _yield$this$_config4.siweRequiredForCryptoWallets;
              body = {
                crypto_wallet_address: options.crypto_wallet_address,
                crypto_wallet_type: options.crypto_wallet_type
              };
              if (siweRequiredForCryptoWallets && options.crypto_wallet_type == 'ethereum') {
                body.siwe_params = Object.assign(Object.assign({}, options.siwe_params), {
                  uri: ((_a = options.siwe_params) === null || _a === void 0 ? void 0 : _a.uri) || window.location.origin
                });
              }
              endpoint = isLoggedIn ? '/crypto_wallets/authenticate/start/secondary' : '/crypto_wallets/authenticate/start/primary';
              requestBody = Object.assign(Object.assign({}, body), {
                captcha_token: captcha_token
              });
              return _context41.abrupt("return", this._apiNetworkClient.fetchSDK({
                url: endpoint,
                method: 'POST',
                body: requestBody
              }));
            case 15:
            case "end":
              return _context41.stop();
          }
        }, _callee41, this);
      }));
    }
  }, {
    key: "authenticate",
    value: function authenticate(options) {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee42() {
        var _yield$this$dfpProtec9, dfp_telemetry_id, captcha_token, resp;
        return _regeneratorRuntime().wrap(function _callee42$(_context42) {
          while (1) switch (_context42.prev = _context42.next) {
            case 0:
              validate('stytch.cryptoWallets.authenticate').isString('signature', options.signature).isString('crypto_wallet_address', options.crypto_wallet_address).isString('crypto_wallet_type', options.crypto_wallet_type).isNumber('session_duration_minutes', options.session_duration_minutes);
              _context42.next = 3;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 3:
              _yield$this$dfpProtec9 = _context42.sent;
              dfp_telemetry_id = _yield$this$dfpProtec9.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec9.captcha_token;
              _context42.next = 8;
              return this._apiNetworkClient.retriableFetchSDK({
                url: '/crypto_wallets/authenticate',
                method: 'POST',
                body: {
                  session_duration_minutes: options.session_duration_minutes,
                  crypto_wallet_address: options.crypto_wallet_address,
                  crypto_wallet_type: options.crypto_wallet_type,
                  signature: options.signature,
                  captcha_token: captcha_token,
                  dfp_telemetry_id: dfp_telemetry_id
                },
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              });
            case 8:
              resp = _context42.sent;
              this._subscriptionService.updateSession(resp);
              return _context42.abrupt("return", omitUser(resp));
            case 11:
            case "end":
              return _context42.stop();
          }
        }, _callee42, this);
      }));
    }
  }]);
}();
var HeadlessTOTPClient = /*#__PURE__*/function () {
  function HeadlessTOTPClient(_networkClient, _subscriptionService, dfpProtectedAuth) {
    _classCallCheck(this, HeadlessTOTPClient);
    this._networkClient = _networkClient;
    this._subscriptionService = _subscriptionService;
    this.dfpProtectedAuth = dfpProtectedAuth;
  }
  return _createClass(HeadlessTOTPClient, [{
    key: "create",
    value: function create(options) {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee43() {
        var resp;
        return _regeneratorRuntime().wrap(function _callee43$(_context43) {
          while (1) switch (_context43.prev = _context43.next) {
            case 0:
              validate('stytch.totps.create').isNumber('expiration_minutes', options.expiration_minutes);
              _context43.next = 3;
              return this._networkClient.fetchSDK({
                url: '/totps',
                method: 'POST',
                body: {
                  expiration_minutes: options.expiration_minutes
                }
              });
            case 3:
              resp = _context43.sent;
              this._subscriptionService.updateUser(resp.__user);
              return _context43.abrupt("return", omitUser(resp));
            case 6:
            case "end":
              return _context43.stop();
          }
        }, _callee43, this);
      }));
    }
  }, {
    key: "authenticate",
    value: function authenticate(options) {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee44() {
        var _yield$this$dfpProtec10, dfp_telemetry_id, captcha_token, resp;
        return _regeneratorRuntime().wrap(function _callee44$(_context44) {
          while (1) switch (_context44.prev = _context44.next) {
            case 0:
              validate('stytch.totps.authenticate').isNumber('session_duration_minutes', options.session_duration_minutes).isString('totp_code', options.totp_code);
              _context44.next = 3;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 3:
              _yield$this$dfpProtec10 = _context44.sent;
              dfp_telemetry_id = _yield$this$dfpProtec10.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec10.captcha_token;
              _context44.next = 8;
              return this._networkClient.retriableFetchSDK({
                url: '/totps/authenticate',
                method: 'POST',
                body: {
                  session_duration_minutes: options.session_duration_minutes,
                  totp_code: options.totp_code,
                  captcha_token: captcha_token,
                  dfp_telemetry_id: dfp_telemetry_id
                },
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              });
            case 8:
              resp = _context44.sent;
              this._subscriptionService.updateSession(resp);
              return _context44.abrupt("return", omitUser(resp));
            case 11:
            case "end":
              return _context44.stop();
          }
        }, _callee44, this);
      }));
    }
  }, {
    key: "recoveryCodes",
    value: function recoveryCodes() {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee45() {
        return _regeneratorRuntime().wrap(function _callee45$(_context45) {
          while (1) switch (_context45.prev = _context45.next) {
            case 0:
              return _context45.abrupt("return", this._networkClient.fetchSDK({
                url: '/totps/recovery_codes',
                method: 'POST'
              }));
            case 1:
            case "end":
              return _context45.stop();
          }
        }, _callee45, this);
      }));
    }
  }, {
    key: "recover",
    value: function recover(options) {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee46() {
        var _yield$this$dfpProtec11, dfp_telemetry_id, captcha_token, resp;
        return _regeneratorRuntime().wrap(function _callee46$(_context46) {
          while (1) switch (_context46.prev = _context46.next) {
            case 0:
              validate('stytch.totps.recover').isNumber('session_duration_minutes', options.session_duration_minutes).isString('recovery_code', options.recovery_code);
              _context46.next = 3;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 3:
              _yield$this$dfpProtec11 = _context46.sent;
              dfp_telemetry_id = _yield$this$dfpProtec11.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec11.captcha_token;
              _context46.next = 8;
              return this._networkClient.retriableFetchSDK({
                url: '/totps/recover',
                method: 'POST',
                body: {
                  session_duration_minutes: options.session_duration_minutes,
                  recovery_code: options.recovery_code,
                  captcha_token: captcha_token,
                  dfp_telemetry_id: dfp_telemetry_id
                },
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              });
            case 8:
              resp = _context46.sent;
              this._subscriptionService.updateSession(resp);
              return _context46.abrupt("return", omitUser(resp));
            case 11:
            case "end":
              return _context46.stop();
          }
        }, _callee46, this);
      }));
    }
  }]);
}(); // src/webauthn-json/base64url.ts
function base64urlToBuffer(baseurl64String) {
  var padding = "==".slice(0, (4 - baseurl64String.length % 4) % 4);
  var base64String = baseurl64String.replace(/-/g, "+").replace(/_/g, "/") + padding;
  var str = atob(base64String);
  var buffer = new ArrayBuffer(str.length);
  var byteView = new Uint8Array(buffer);
  for (var _i = 0; _i < str.length; _i++) {
    byteView[_i] = str.charCodeAt(_i);
  }
  return buffer;
}
function bufferToBase64url(buffer) {
  var byteView = new Uint8Array(buffer);
  var str = "";
  var _iterator2 = _createForOfIteratorHelper(byteView),
    _step2;
  try {
    for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {
      var charCode = _step2.value;
      str += String.fromCharCode(charCode);
    }
  } catch (err) {
    _iterator2.e(err);
  } finally {
    _iterator2.f();
  }
  var base64String = btoa(str);
  var base64urlString = base64String.replace(/\+/g, "-").replace(/\//g, "_").replace(/=/g, "");
  return base64urlString;
}
// src/webauthn-json/convert.ts
var copyValue = "copy";
var convertValue = "convert";
function convert(conversionFn, schema2, input) {
  if (schema2 === copyValue) {
    return input;
  }
  if (schema2 === convertValue) {
    return conversionFn(input);
  }
  if (schema2 instanceof Array) {
    return input.map(function (v) {
      return convert(conversionFn, schema2[0], v);
    });
  }
  if (schema2 instanceof Object) {
    var output = {};
    for (var _i2 = 0, _Object$entries = Object.entries(schema2); _i2 < _Object$entries.length; _i2++) {
      var _Object$entries$_i = _slicedToArray(_Object$entries[_i2], 2),
        key = _Object$entries$_i[0],
        schemaField = _Object$entries$_i[1];
      if (schemaField.derive) {
        var v = schemaField.derive(input);
        if (v !== void 0) {
          input[key] = v;
        }
      }
      if (!(key in input)) {
        if (schemaField.required) {
          throw new Error("Missing key: ".concat(key));
        }
        continue;
      }
      if (input[key] == null) {
        output[key] = null;
        continue;
      }
      output[key] = convert(conversionFn, schemaField.schema, input[key]);
    }
    return output;
  }
}
function derived(schema2, derive) {
  return {
    required: true,
    schema: schema2,
    derive: derive
  };
}
function required(schema2) {
  return {
    required: true,
    schema: schema2
  };
}
function optional(schema2) {
  return {
    required: false,
    schema: schema2
  };
}
// src/webauthn-json/basic/schema.ts
var publicKeyCredentialDescriptorSchema = {
  type: required(copyValue),
  id: required(convertValue),
  transports: optional(copyValue)
};
var simplifiedExtensionsSchema = {
  appid: optional(copyValue),
  appidExclude: optional(copyValue),
  credProps: optional(copyValue)
};
var simplifiedClientExtensionResultsSchema = {
  appid: optional(copyValue),
  appidExclude: optional(copyValue),
  credProps: optional(copyValue)
};
var credentialCreationOptions = {
  publicKey: required({
    rp: required(copyValue),
    user: required({
      id: required(convertValue),
      name: required(copyValue),
      displayName: required(copyValue)
    }),
    challenge: required(convertValue),
    pubKeyCredParams: required(copyValue),
    timeout: optional(copyValue),
    excludeCredentials: optional([publicKeyCredentialDescriptorSchema]),
    authenticatorSelection: optional(copyValue),
    attestation: optional(copyValue),
    extensions: optional(simplifiedExtensionsSchema)
  }),
  signal: optional(copyValue)
};
var publicKeyCredentialWithAttestation = {
  type: required(copyValue),
  id: required(copyValue),
  rawId: required(convertValue),
  authenticatorAttachment: optional(copyValue),
  response: required({
    clientDataJSON: required(convertValue),
    attestationObject: required(convertValue),
    transports: derived(copyValue, function (response) {
      var _a;
      return ((_a = response.getTransports) == null ? void 0 : _a.call(response)) || [];
    })
  }),
  clientExtensionResults: derived(simplifiedClientExtensionResultsSchema, function (pkc) {
    return pkc.getClientExtensionResults();
  })
};
var credentialRequestOptions = {
  mediation: optional(copyValue),
  publicKey: required({
    challenge: required(convertValue),
    timeout: optional(copyValue),
    rpId: optional(copyValue),
    allowCredentials: optional([publicKeyCredentialDescriptorSchema]),
    userVerification: optional(copyValue),
    extensions: optional(simplifiedExtensionsSchema)
  }),
  signal: optional(copyValue)
};
var publicKeyCredentialWithAssertion = {
  type: required(copyValue),
  id: required(copyValue),
  rawId: required(convertValue),
  authenticatorAttachment: optional(copyValue),
  response: required({
    clientDataJSON: required(convertValue),
    authenticatorData: required(convertValue),
    signature: required(convertValue),
    userHandle: required(convertValue)
  }),
  clientExtensionResults: derived(simplifiedClientExtensionResultsSchema, function (pkc) {
    return pkc.getClientExtensionResults();
  })
};
// src/webauthn-json/basic/api.ts
function createRequestFromJSON(requestJSON) {
  return convert(base64urlToBuffer, credentialCreationOptions, requestJSON);
}
function createResponseToJSON(credential) {
  return convert(bufferToBase64url, publicKeyCredentialWithAttestation, credential);
}
function create(requestJSON) {
  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee47() {
    var credential;
    return _regeneratorRuntime().wrap(function _callee47$(_context47) {
      while (1) switch (_context47.prev = _context47.next) {
        case 0:
          _context47.next = 2;
          return navigator.credentials.create(createRequestFromJSON(requestJSON));
        case 2:
          credential = _context47.sent;
          return _context47.abrupt("return", createResponseToJSON(credential));
        case 4:
        case "end":
          return _context47.stop();
      }
    }, _callee47);
  }));
}
function getRequestFromJSON(requestJSON) {
  return convert(base64urlToBuffer, credentialRequestOptions, requestJSON);
}
function getResponseToJSON(credential) {
  return convert(bufferToBase64url, publicKeyCredentialWithAssertion, credential);
}
function get(requestJSON) {
  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee48() {
    var credential;
    return _regeneratorRuntime().wrap(function _callee48$(_context48) {
      while (1) switch (_context48.prev = _context48.next) {
        case 0:
          _context48.next = 2;
          return navigator.credentials.get(getRequestFromJSON(requestJSON));
        case 2:
          credential = _context48.sent;
          return _context48.abrupt("return", getResponseToJSON(credential));
        case 4:
        case "end":
          return _context48.stop();
      }
    }, _callee48);
  }));
}
var HeadlessWebAuthnClient = /*#__PURE__*/function () {
  function HeadlessWebAuthnClient(_networkClient, _subscriptionService, dfpProtectedAuth) {
    _classCallCheck(this, HeadlessWebAuthnClient);
    this._networkClient = _networkClient;
    this._subscriptionService = _subscriptionService;
    this.dfpProtectedAuth = dfpProtectedAuth;
    this.checkEligibleInputs = function () {
      // Check for an <input> with "webauthn" in its `autocomplete` attribute
      var eligibleInputs = document.querySelectorAll("input[autocomplete*='webauthn']");
      // WebAuthn autofill requires at least one valid input
      if (eligibleInputs.length < 1) {
        // eslint-disable-next-line no-console
        console.error('No <input> with `"webauthn"` in its `autocomplete` attribute was detected');
        return false;
      }
      return true;
    };
  }
  return _createClass(HeadlessWebAuthnClient, [{
    key: "register",
    value: function register(options) {
      var _a, _b;
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee49() {
        var startResp, publicKeyCredentialCreationOptions, publicKey, credential, resp;
        return _regeneratorRuntime().wrap(function _callee49$(_context49) {
          while (1) switch (_context49.prev = _context49.next) {
            case 0:
              validate('stytch.webauthn.register').isOptionalString('domain', options === null || options === void 0 ? void 0 : options.domain).isOptionalString('authenticator_type', options === null || options === void 0 ? void 0 : options.authenticator_type).isOptionalBoolean('is_passkey', options === null || options === void 0 ? void 0 : options.is_passkey).isOptionalNumber('session_duration_minutes', options === null || options === void 0 ? void 0 : options.session_duration_minutes).isOptionalString('override_id', options === null || options === void 0 ? void 0 : options.override_id).isOptionalString('override_name', options === null || options === void 0 ? void 0 : options.override_name).isOptionalString('override_display_name', options === null || options === void 0 ? void 0 : options.override_display_name);
              _context49.next = 3;
              return this._networkClient.fetchSDK({
                url: '/webauthn/register/start',
                method: 'POST',
                body: {
                  domain: (_a = options === null || options === void 0 ? void 0 : options.domain) !== null && _a !== void 0 ? _a : window.location.hostname,
                  authenticator_type: (_b = options === null || options === void 0 ? void 0 : options.authenticator_type) !== null && _b !== void 0 ? _b : undefined,
                  return_passkey_credential_options: options === null || options === void 0 ? void 0 : options.is_passkey,
                  override_id: options === null || options === void 0 ? void 0 : options.override_id,
                  override_name: options === null || options === void 0 ? void 0 : options.override_name,
                  override_display_name: options === null || options === void 0 ? void 0 : options.override_display_name,
                  user_agent: navigator.userAgent
                }
              });
            case 3:
              startResp = _context49.sent;
              publicKeyCredentialCreationOptions = startResp.public_key_credential_creation_options;
              publicKey = JSON.parse(publicKeyCredentialCreationOptions);
              _context49.next = 8;
              return create({
                publicKey: publicKey
              });
            case 8:
              credential = _context49.sent;
              _context49.next = 11;
              return this._networkClient.fetchSDK({
                url: '/webauthn/register',
                method: 'POST',
                body: {
                  public_key_credential: JSON.stringify(credential),
                  session_duration_minutes: options === null || options === void 0 ? void 0 : options.session_duration_minutes
                }
              });
            case 11:
              resp = _context49.sent;
              this._subscriptionService.updateSession(resp);
              return _context49.abrupt("return", omitUser(resp));
            case 14:
            case "end":
              return _context49.stop();
          }
        }, _callee49, this);
      }));
    }
  }, {
    key: "authenticate",
    value: function authenticate(options) {
      var _a, _b;
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee50() {
        var _yield$this$dfpProtec12, dfp_telemetry_id, captcha_token, isLoggedIn, endpoint, startResp, publicKeyCredentialRequestOptions, abortController, credReqOptions, conditionalMediationCredReqOption, credential, authenticationData;
        return _regeneratorRuntime().wrap(function _callee50$(_context50) {
          while (1) switch (_context50.prev = _context50.next) {
            case 0:
              validate('stytch.webauthn.authenticate').isOptionalString('domain', options.domain).isNumber('session_duration_minutes', options.session_duration_minutes).isOptionalBoolean('is_passkey', options.is_passkey).isOptionalObject('signal', options.signal);
              _context50.next = 3;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 3:
              _yield$this$dfpProtec12 = _context50.sent;
              dfp_telemetry_id = _yield$this$dfpProtec12.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec12.captcha_token;
              if (!options.conditional_mediation) {
                _context50.next = 14;
                break;
              }
              _context50.next = 9;
              return this.browserSupportsAutofill();
            case 9:
              if (_context50.sent) {
                _context50.next = 12;
                break;
              }
              // eslint-disable-next-line no-console
              console.error('Browser does not support WebAuthn autofill');
              return _context50.abrupt("return", null);
            case 12:
              if (this.checkEligibleInputs()) {
                _context50.next = 14;
                break;
              }
              return _context50.abrupt("return", null);
            case 14:
              isLoggedIn = !!this._subscriptionService.getSession();
              endpoint = isLoggedIn ? '/webauthn/authenticate/start/secondary' : '/webauthn/authenticate/start/primary';
              _context50.next = 18;
              return this._networkClient.fetchSDK({
                url: endpoint,
                method: 'POST',
                body: {
                  domain: (_a = options.domain) !== null && _a !== void 0 ? _a : window.location.hostname,
                  return_passkey_credential_options: options === null || options === void 0 ? void 0 : options.is_passkey
                }
              });
            case 18:
              startResp = _context50.sent;
              publicKeyCredentialRequestOptions = startResp.public_key_credential_request_options;
              abortController = new AbortController();
              credReqOptions = {
                publicKey: JSON.parse(publicKeyCredentialRequestOptions),
                signal: (_b = options.signal) !== null && _b !== void 0 ? _b : abortController.signal
              };
              conditionalMediationCredReqOption = Object.assign(Object.assign({}, credReqOptions), {
                mediation: 'conditional'
              });
              _context50.next = 25;
              return get(options.conditional_mediation ? conditionalMediationCredReqOption : credReqOptions);
            case 25:
              credential = _context50.sent;
              _context50.next = 28;
              return this._networkClient.retriableFetchSDK({
                url: '/webauthn/authenticate',
                method: 'POST',
                body: {
                  public_key_credential: JSON.stringify(credential),
                  session_duration_minutes: options.session_duration_minutes,
                  dfp_telemetry_id: dfp_telemetry_id,
                  captcha_token: captcha_token
                },
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              });
            case 28:
              authenticationData = _context50.sent;
              this._subscriptionService.updateSession(authenticationData);
              return _context50.abrupt("return", omitUser(authenticationData));
            case 31:
            case "end":
              return _context50.stop();
          }
        }, _callee50, this);
      }));
    }
  }, {
    key: "update",
    value: function update(options) {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee51() {
        var url;
        return _regeneratorRuntime().wrap(function _callee51$(_context51) {
          while (1) switch (_context51.prev = _context51.next) {
            case 0:
              url = '/webauthn/update/' + options.webauthn_registration_id;
              _context51.next = 3;
              return this._networkClient.fetchSDK({
                url: url,
                method: 'PUT',
                body: {
                  name: options.name
                }
              });
            case 3:
              return _context51.abrupt("return", _context51.sent);
            case 4:
            case "end":
              return _context51.stop();
          }
        }, _callee51, this);
      }));
    }
  }, {
    key: "browserSupportsAutofill",
    value: function browserSupportsAutofill() {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee52() {
        return _regeneratorRuntime().wrap(function _callee52$(_context52) {
          while (1) switch (_context52.prev = _context52.next) {
            case 0:
              if (!(window.PublicKeyCredential && window.PublicKeyCredential.isConditionalMediationAvailable)) {
                _context52.next = 4;
                break;
              }
              _context52.next = 3;
              return window.PublicKeyCredential.isConditionalMediationAvailable();
            case 3:
              return _context52.abrupt("return", _context52.sent);
            case 4:
              return _context52.abrupt("return", false);
            case 5:
            case "end":
              return _context52.stop();
          }
        }, _callee52);
      }));
    }
  }]);
}();
var DefaultDynamicConfig$2 = Promise.resolve({
  pkceRequiredForPasswordResets: false
});
var HeadlessPasswordClient = /*#__PURE__*/function () {
  function HeadlessPasswordClient(_networkClient, _subscriptionService, _pkceManager) {
    var _config = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : DefaultDynamicConfig$2;
    var dfpProtectedAuth = arguments.length > 4 ? arguments[4] : undefined;
    _classCallCheck(this, HeadlessPasswordClient);
    this._networkClient = _networkClient;
    this._subscriptionService = _subscriptionService;
    this._pkceManager = _pkceManager;
    this._config = _config;
    this.dfpProtectedAuth = dfpProtectedAuth;
  }
  return _createClass(HeadlessPasswordClient, [{
    key: "getCodeChallenge",
    value: function getCodeChallenge() {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee53() {
        var _yield$this$_config5, pkceRequiredForPasswordResets, keyPair;
        return _regeneratorRuntime().wrap(function _callee53$(_context53) {
          while (1) switch (_context53.prev = _context53.next) {
            case 0:
              _context53.next = 2;
              return this._config;
            case 2:
              _yield$this$_config5 = _context53.sent;
              pkceRequiredForPasswordResets = _yield$this$_config5.pkceRequiredForPasswordResets;
              if (pkceRequiredForPasswordResets) {
                _context53.next = 6;
                break;
              }
              return _context53.abrupt("return", undefined);
            case 6:
              _context53.next = 8;
              return this._pkceManager.getPKPair();
            case 8:
              keyPair = _context53.sent;
              if (!keyPair) {
                _context53.next = 11;
                break;
              }
              return _context53.abrupt("return", keyPair.code_challenge);
            case 11:
              _context53.next = 13;
              return this._pkceManager.startPKCETransaction();
            case 13:
              keyPair = _context53.sent;
              return _context53.abrupt("return", keyPair.code_challenge);
            case 15:
            case "end":
              return _context53.stop();
          }
        }, _callee53, this);
      }));
    }
  }, {
    key: "create",
    value: function create(options) {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee54() {
        var _yield$this$dfpProtec13, dfp_telemetry_id, captcha_token, resp;
        return _regeneratorRuntime().wrap(function _callee54$(_context54) {
          while (1) switch (_context54.prev = _context54.next) {
            case 0:
              validate('stytch.passwords.create').isString('password', options.password).isString('email', options.email).isNumber('session_duration_minutes', options.session_duration_minutes);
              _context54.next = 3;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 3:
              _yield$this$dfpProtec13 = _context54.sent;
              dfp_telemetry_id = _yield$this$dfpProtec13.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec13.captcha_token;
              _context54.next = 8;
              return this._networkClient.retriableFetchSDK({
                url: '/passwords',
                method: 'POST',
                body: {
                  email: options.email,
                  password: options.password,
                  session_duration_minutes: options.session_duration_minutes,
                  captcha_token: captcha_token,
                  dfp_telemetry_id: dfp_telemetry_id
                },
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              });
            case 8:
              resp = _context54.sent;
              this._subscriptionService.updateSession(resp);
              return _context54.abrupt("return", omitUser(resp));
            case 11:
            case "end":
              return _context54.stop();
          }
        }, _callee54, this);
      }));
    }
  }, {
    key: "authenticate",
    value: function authenticate(options) {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee55() {
        var _yield$this$dfpProtec14, dfp_telemetry_id, captcha_token, resp;
        return _regeneratorRuntime().wrap(function _callee55$(_context55) {
          while (1) switch (_context55.prev = _context55.next) {
            case 0:
              validate('stytch.passwords.authenticate').isString('password', options.password).isString('email', options.email).isNumber('session_duration_minutes', options.session_duration_minutes);
              _context55.next = 3;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 3:
              _yield$this$dfpProtec14 = _context55.sent;
              dfp_telemetry_id = _yield$this$dfpProtec14.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec14.captcha_token;
              _context55.next = 8;
              return this._networkClient.retriableFetchSDK({
                url: '/passwords/authenticate',
                method: 'POST',
                body: {
                  email: options.email,
                  password: options.password,
                  session_duration_minutes: options.session_duration_minutes,
                  captcha_token: captcha_token,
                  dfp_telemetry_id: dfp_telemetry_id
                },
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              });
            case 8:
              resp = _context55.sent;
              this._subscriptionService.updateSession(resp);
              return _context55.abrupt("return", omitUser(resp));
            case 11:
            case "end":
              return _context55.stop();
          }
        }, _callee55, this);
      }));
    }
  }, {
    key: "resetByEmailStart",
    value: function resetByEmailStart(options) {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee56() {
        var code_challenge, _yield$this$dfpProtec15, dfp_telemetry_id, captcha_token;
        return _regeneratorRuntime().wrap(function _callee56$(_context56) {
          while (1) switch (_context56.prev = _context56.next) {
            case 0:
              validate('stytch.passwords.resetByEmailStart').isString('email', options.email).isOptionalString('login_redirect_url', options.login_redirect_url).isOptionalString('reset_password_redirect_url', options.reset_password_redirect_url).isOptionalString('reset_password_template_id', options.reset_password_template_id).isOptionalNumber('reset_password_expiration_minutes', options.reset_password_expiration_minutes);
              _context56.next = 3;
              return this.getCodeChallenge();
            case 3:
              code_challenge = _context56.sent;
              _context56.next = 6;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 6:
              _yield$this$dfpProtec15 = _context56.sent;
              dfp_telemetry_id = _yield$this$dfpProtec15.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec15.captcha_token;
              return _context56.abrupt("return", this._networkClient.retriableFetchSDK({
                url: '/passwords/email/reset/start',
                method: 'POST',
                body: {
                  email: options.email,
                  login_redirect_url: options.login_redirect_url,
                  reset_password_redirect_url: options.reset_password_redirect_url,
                  reset_password_expiration_minutes: options.reset_password_expiration_minutes,
                  reset_password_template_id: options.reset_password_template_id,
                  code_challenge: code_challenge,
                  captcha_token: captcha_token,
                  dfp_telemetry_id: dfp_telemetry_id
                },
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              }));
            case 10:
            case "end":
              return _context56.stop();
          }
        }, _callee56, this);
      }));
    }
  }, {
    key: "resetByEmail",
    value: function resetByEmail(options) {
      var _a, _b;
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee57() {
        var _yield$this$dfpProtec16, dfp_telemetry_id, captcha_token, pkPair, _yield$this$_config6, pkceRequiredForPasswordResets, code_verifier, resp;
        return _regeneratorRuntime().wrap(function _callee57$(_context57) {
          while (1) switch (_context57.prev = _context57.next) {
            case 0:
              validate('stytch.passwords.resetByEmail').isString('token', options.token).isString('password', options.password).isNumber('session_duration_minutes', options.session_duration_minutes);
              _context57.next = 3;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 3:
              _yield$this$dfpProtec16 = _context57.sent;
              dfp_telemetry_id = _yield$this$dfpProtec16.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec16.captcha_token;
              _context57.next = 8;
              return this._pkceManager.getPKPair();
            case 8:
              pkPair = _context57.sent;
              _context57.next = 11;
              return this._config;
            case 11:
              _yield$this$_config6 = _context57.sent;
              pkceRequiredForPasswordResets = _yield$this$_config6.pkceRequiredForPasswordResets;
              if (!(pkceRequiredForPasswordResets && (!pkPair || !(pkPair === null || pkPair === void 0 ? void 0 : pkPair.code_verifier) || ((_b = (_a = pkPair === null || pkPair === void 0 ? void 0 : pkPair.code_verifier) === null || _a === void 0 ? void 0 : _a.trim()) === null || _b === void 0 ? void 0 : _b.length) === 0))) {
                _context57.next = 15;
                break;
              }
              throw new ui.MissingPKCEError();
            case 15:
              code_verifier = pkPair === null || pkPair === void 0 ? void 0 : pkPair.code_verifier;
              _context57.next = 18;
              return this._networkClient.retriableFetchSDK({
                url: '/passwords/email/reset',
                method: 'POST',
                body: {
                  token: options.token,
                  password: options.password,
                  session_duration_minutes: options.session_duration_minutes,
                  captcha_token: captcha_token,
                  code_verifier: code_verifier,
                  dfp_telemetry_id: dfp_telemetry_id
                },
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              });
            case 18:
              resp = _context57.sent;
              this._pkceManager.clearPKPair();
              this._subscriptionService.updateSession(resp);
              return _context57.abrupt("return", omitUser(resp));
            case 22:
            case "end":
              return _context57.stop();
          }
        }, _callee57, this);
      }));
    }
  }, {
    key: "resetByExistingPassword",
    value: function resetByExistingPassword(options) {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee58() {
        var _yield$this$dfpProtec17, dfp_telemetry_id, captcha_token, resp;
        return _regeneratorRuntime().wrap(function _callee58$(_context58) {
          while (1) switch (_context58.prev = _context58.next) {
            case 0:
              validate('stytch.passwords.resetByExistingPassword').isString('email', options.email).isString('existing_password', options.existing_password).isString('new_password', options.new_password).isNumber('session_duration_minutes', options.session_duration_minutes);
              _context58.next = 3;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 3:
              _yield$this$dfpProtec17 = _context58.sent;
              dfp_telemetry_id = _yield$this$dfpProtec17.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec17.captcha_token;
              _context58.next = 8;
              return this._networkClient.retriableFetchSDK({
                url: '/passwords/existing_password/reset',
                method: 'POST',
                body: {
                  email: options.email,
                  existing_password: options.existing_password,
                  new_password: options.new_password,
                  session_duration_minutes: options.session_duration_minutes,
                  dfp_telemetry_id: dfp_telemetry_id,
                  captcha_token: captcha_token
                },
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              });
            case 8:
              resp = _context58.sent;
              this._subscriptionService.updateSession(resp);
              return _context58.abrupt("return", omitUser(resp));
            case 11:
            case "end":
              return _context58.stop();
          }
        }, _callee58, this);
      }));
    }
  }, {
    key: "resetBySession",
    value: function resetBySession(options) {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee59() {
        var _yield$this$dfpProtec18, dfp_telemetry_id, captcha_token, resp;
        return _regeneratorRuntime().wrap(function _callee59$(_context59) {
          while (1) switch (_context59.prev = _context59.next) {
            case 0:
              validate('stytch.passwords.resetBySession').isString('password', options.password);
              _context59.next = 3;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 3:
              _yield$this$dfpProtec18 = _context59.sent;
              dfp_telemetry_id = _yield$this$dfpProtec18.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec18.captcha_token;
              _context59.next = 8;
              return this._networkClient.retriableFetchSDK({
                url: '/passwords/session/reset',
                method: 'POST',
                body: {
                  password: options.password,
                  session_duration_minutes: options.session_duration_minutes,
                  dfp_telemetry_id: dfp_telemetry_id,
                  captcha_token: captcha_token
                },
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              });
            case 8:
              resp = _context59.sent;
              this._subscriptionService.updateSession(resp);
              return _context59.abrupt("return", resp);
            case 11:
            case "end":
              return _context59.stop();
          }
        }, _callee59, this);
      }));
    }
  }, {
    key: "strengthCheck",
    value: function strengthCheck(options) {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee60() {
        return _regeneratorRuntime().wrap(function _callee60$(_context60) {
          while (1) switch (_context60.prev = _context60.next) {
            case 0:
              validate('stytch.passwords.strengthCheck').isOptionalString('email', options.email).isString('password', options.password);
              return _context60.abrupt("return", this._networkClient.fetchSDK({
                url: '/passwords/strength_check',
                method: 'POST',
                body: {
                  email: options.email,
                  password: options.password
                }
              }));
            case 2:
            case "end":
              return _context60.stop();
          }
        }, _callee60, this);
      }));
    }
  }]);
}();
var HeadlessImpersonationClient = /*#__PURE__*/_createClass(function HeadlessImpersonationClient(_networkClient, _subscriptionService, dfpProtectedAuth) {
  var _this9 = this;
  _classCallCheck(this, HeadlessImpersonationClient);
  this._networkClient = _networkClient;
  this._subscriptionService = _subscriptionService;
  this.dfpProtectedAuth = dfpProtectedAuth;
  this.authenticate = function (data) {
    return __awaiter(_this9, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee61() {
      var _yield$this$dfpProtec19, dfp_telemetry_id, captcha_token, resp;
      return _regeneratorRuntime().wrap(function _callee61$(_context61) {
        while (1) switch (_context61.prev = _context61.next) {
          case 0:
            validate('stytch.impersonation.authenticate').isString('impersonation_token', data.impersonation_token);
            _context61.next = 3;
            return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
          case 3:
            _yield$this$dfpProtec19 = _context61.sent;
            dfp_telemetry_id = _yield$this$dfpProtec19.dfp_telemetry_id;
            captcha_token = _yield$this$dfpProtec19.captcha_token;
            _context61.next = 8;
            return this._networkClient.retriableFetchSDK({
              url: '/impersonation/authenticate',
              body: Object.assign(Object.assign({}, data), {
                dfp_telemetry_id: dfp_telemetry_id,
                captcha_token: captcha_token
              }),
              method: 'POST',
              retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
            });
          case 8:
            resp = _context61.sent;
            this._subscriptionService.updateSession(resp);
            return _context61.abrupt("return", resp);
          case 11:
          case "end":
            return _context61.stop();
        }
      }, _callee61, this);
    }));
  };
});
var DefaultDynamicConfig$1 = Promise.resolve({
  pkceRequiredForEmailMagicLinks: false
});
var HeadlessB2BMagicLinksClient = /*#__PURE__*/function () {
  function HeadlessB2BMagicLinksClient(_networkClient, _subscriptionService, _pkceManager, _passwordResetPKCEManager) {
    var _this10 = this;
    var _config = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : DefaultDynamicConfig$1;
    var dfpProtectedAuth = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : DisabledDFPProtectedAuthProvider();
    _classCallCheck(this, HeadlessB2BMagicLinksClient);
    this._networkClient = _networkClient;
    this._subscriptionService = _subscriptionService;
    this._pkceManager = _pkceManager;
    this._passwordResetPKCEManager = _passwordResetPKCEManager;
    this._config = _config;
    this.dfpProtectedAuth = dfpProtectedAuth;
    this.email = {
      invite: function invite(data) {
        return __awaiter(_this10, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee62() {
          return _regeneratorRuntime().wrap(function _callee62$(_context62) {
            while (1) switch (_context62.prev = _context62.next) {
              case 0:
                validate('stytch.magicLinks.email.invite').isString('email_address', data.email_address).isOptionalString('invite_redirect_url', data.invite_redirect_url).isOptionalString('invite_template_id', data.invite_template_id).isOptionalString('name', data.name).isOptionalString('locale', data.locale).isOptionalStringArray('roles', data.roles).isOptionalNumber('invite_expiration_minutes', data.invite_expiration_minutes);
                return _context62.abrupt("return", this._networkClient.fetchSDK({
                  url: '/b2b/magic_links/email/invite',
                  body: data,
                  method: 'POST'
                }));
              case 2:
              case "end":
                return _context62.stop();
            }
          }, _callee62, this);
        }));
      },
      loginOrSignup: function loginOrSignup(data) {
        return __awaiter(_this10, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee63() {
          var pkce_code_challenge, requestBody;
          return _regeneratorRuntime().wrap(function _callee63$(_context63) {
            while (1) switch (_context63.prev = _context63.next) {
              case 0:
                validate('stytch.magicLinks.email.loginOrSignup').isString('email_address', data.email_address).isString('organization_id', data.organization_id).isOptionalString('login_redirect_url', data.login_redirect_url).isOptionalString('login_template_id', data.login_template_id).isOptionalString('signup_redirect_url', data.signup_redirect_url).isOptionalString('signup_template_id', data.signup_template_id).isOptionalString('locale', data.locale).isOptionalNumber('login_expiration_minutes', data.login_expiration_minutes).isOptionalNumber('signup_expiration_minutes', data.signup_expiration_minutes);
                _context63.next = 3;
                return this.getCodeChallenge();
              case 3:
                pkce_code_challenge = _context63.sent;
                requestBody = Object.assign(Object.assign({}, data), {
                  pkce_code_challenge: pkce_code_challenge
                });
                return _context63.abrupt("return", this._networkClient.fetchSDK({
                  url: '/b2b/magic_links/email/login_or_signup',
                  body: requestBody,
                  method: 'POST'
                }));
              case 6:
              case "end":
                return _context63.stop();
            }
          }, _callee63, this);
        }));
      },
      discovery: {
        send: function send(data) {
          return __awaiter(_this10, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee64() {
            var _yield$this$dfpProtec20, dfp_telemetry_id, captcha_token, pkce_code_challenge, requestBody;
            return _regeneratorRuntime().wrap(function _callee64$(_context64) {
              while (1) switch (_context64.prev = _context64.next) {
                case 0:
                  validate('stytch.magicLinks.email.discovery.send').isString('email_address', data.email_address).isOptionalString('discovery_redirect_url', data.discovery_redirect_url).isOptionalString('login_template_id', data.login_template_id).isOptionalString('locale', data.locale).isOptionalNumber('discovery_expiration_minutes', data.discovery_expiration_minutes);
                  _context64.next = 3;
                  return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
                case 3:
                  _yield$this$dfpProtec20 = _context64.sent;
                  dfp_telemetry_id = _yield$this$dfpProtec20.dfp_telemetry_id;
                  captcha_token = _yield$this$dfpProtec20.captcha_token;
                  _context64.next = 8;
                  return this.getCodeChallenge();
                case 8:
                  pkce_code_challenge = _context64.sent;
                  requestBody = Object.assign(Object.assign({}, data), {
                    pkce_code_challenge: pkce_code_challenge,
                    dfp_telemetry_id: dfp_telemetry_id,
                    captcha_token: captcha_token
                  });
                  return _context64.abrupt("return", this._networkClient.retriableFetchSDK({
                    url: '/b2b/magic_links/email/discovery/send',
                    body: requestBody,
                    method: 'POST',
                    retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
                  }));
                case 11:
                case "end":
                  return _context64.stop();
              }
            }, _callee64, this);
          }));
        }
      }
    };
    this.authenticate = function (data) {
      return __awaiter(_this10, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee65() {
        var passwordResetPKPair, resp;
        return _regeneratorRuntime().wrap(function _callee65$(_context65) {
          while (1) switch (_context65.prev = _context65.next) {
            case 0:
              validate('stytch.magicLinks.authenticate').isString('magic_links_token', data.magic_links_token).isNumber('session_duration_minutes', data.session_duration_minutes).isOptionalString('locale', data.locale);
              // When a user resets their password with PKCE turned on, they create a pkPair in the 'passwords' namespace.
              // However, when the user gets the reset password email, they have the option to log in without a password.
              // This redirects them to the magic link authenticate flow, which automatically looks for the pkce code_verifier
              // in the 'magic_links' namespace, breaking the flow. Unfortunately we won't know for sure in the eml authenticate call
              // whether or not the user is coming from a password reset flow. To handle this, we have to try to authenticate with
              // both the 'passwords' and 'magic_links' code_verifiers.
              _context65.next = 3;
              return this._passwordResetPKCEManager.getPKPair();
            case 3:
              passwordResetPKPair = _context65.sent;
              resp = null;
              if (!(passwordResetPKPair === null || passwordResetPKPair === void 0 ? void 0 : passwordResetPKPair.code_verifier)) {
                _context65.next = 19;
                break;
              }
              _context65.prev = 6;
              _context65.next = 9;
              return this.handlePKCEForAuthenticate(this._passwordResetPKCEManager, data);
            case 9:
              resp = _context65.sent;
              _context65.next = 19;
              break;
            case 12:
              _context65.prev = 12;
              _context65.t0 = _context65["catch"](6);
              if (!_context65.t0.message.includes('pkce')) {
                _context65.next = 18;
                break;
              }
              // If pkce-related error, fall back to magic links code_verifier
              // eslint-disable-next-line no-console
              console.log('Authenticate with passwords pkce namespace failed. Falling back to authenticate with magic_links namespace.');
              _context65.next = 19;
              break;
            case 18:
              throw _context65.t0;
            case 19:
              if (resp) {
                _context65.next = 23;
                break;
              }
              _context65.next = 22;
              return this.handlePKCEForAuthenticate(this._pkceManager, data);
            case 22:
              resp = _context65.sent;
            case 23:
              this._subscriptionService.updateSession(resp);
              return _context65.abrupt("return", resp);
            case 25:
            case "end":
              return _context65.stop();
          }
        }, _callee65, this, [[6, 12]]);
      }));
    };
    this.discovery = {
      authenticate: function authenticate(data) {
        return __awaiter(_this10, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee66() {
          var pkPair, _yield$this$dfpProtec21, dfp_telemetry_id, captcha_token, requestBody, resp;
          return _regeneratorRuntime().wrap(function _callee66$(_context66) {
            while (1) switch (_context66.prev = _context66.next) {
              case 0:
                validate('stytch.magicLinks.discovery.authenticate').isString('discovery_magic_links_token', data.discovery_magic_links_token);
                _context66.next = 3;
                return this._pkceManager.getPKPair();
              case 3:
                pkPair = _context66.sent;
                _context66.next = 6;
                return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
              case 6:
                _yield$this$dfpProtec21 = _context66.sent;
                dfp_telemetry_id = _yield$this$dfpProtec21.dfp_telemetry_id;
                captcha_token = _yield$this$dfpProtec21.captcha_token;
                requestBody = Object.assign({
                  pkce_code_verifier: pkPair === null || pkPair === void 0 ? void 0 : pkPair.code_verifier,
                  dfp_telemetry_id: dfp_telemetry_id,
                  captcha_token: captcha_token
                }, data);
                _context66.next = 12;
                return this._networkClient.retriableFetchSDK({
                  url: '/b2b/magic_links/discovery/authenticate',
                  body: requestBody,
                  method: 'POST',
                  retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
                });
              case 12:
                resp = _context66.sent;
                this._pkceManager.clearPKPair();
                this._subscriptionService.updateSession(resp);
                return _context66.abrupt("return", resp);
              case 16:
              case "end":
                return _context66.stop();
            }
          }, _callee66, this);
        }));
      }
    };
  }
  return _createClass(HeadlessB2BMagicLinksClient, [{
    key: "getCodeChallenge",
    value: function getCodeChallenge() {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee67() {
        var _yield$this$_config7, pkceRequiredForEmailMagicLinks, keyPair;
        return _regeneratorRuntime().wrap(function _callee67$(_context67) {
          while (1) switch (_context67.prev = _context67.next) {
            case 0:
              _context67.next = 2;
              return this._config;
            case 2:
              _yield$this$_config7 = _context67.sent;
              pkceRequiredForEmailMagicLinks = _yield$this$_config7.pkceRequiredForEmailMagicLinks;
              if (pkceRequiredForEmailMagicLinks) {
                _context67.next = 6;
                break;
              }
              return _context67.abrupt("return", undefined);
            case 6:
              _context67.next = 8;
              return this._pkceManager.getPKPair();
            case 8:
              keyPair = _context67.sent;
              if (!keyPair) {
                _context67.next = 11;
                break;
              }
              return _context67.abrupt("return", keyPair.code_challenge);
            case 11:
              _context67.next = 13;
              return this._pkceManager.startPKCETransaction();
            case 13:
              keyPair = _context67.sent;
              return _context67.abrupt("return", keyPair.code_challenge);
            case 15:
            case "end":
              return _context67.stop();
          }
        }, _callee67, this);
      }));
    }
  }, {
    key: "handlePKCEForAuthenticate",
    value: function handlePKCEForAuthenticate(pkceManager, data) {
      var _a, _b;
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee68() {
        var pkPair, _yield$this$_config8, pkceRequiredForEmailMagicLinks, _yield$this$dfpProtec22, dfp_telemetry_id, captcha_token, requestBody, resp;
        return _regeneratorRuntime().wrap(function _callee68$(_context68) {
          while (1) switch (_context68.prev = _context68.next) {
            case 0:
              _context68.next = 2;
              return pkceManager.getPKPair();
            case 2:
              pkPair = _context68.sent;
              _context68.next = 5;
              return this._config;
            case 5:
              _yield$this$_config8 = _context68.sent;
              pkceRequiredForEmailMagicLinks = _yield$this$_config8.pkceRequiredForEmailMagicLinks;
              if (!(pkceRequiredForEmailMagicLinks && (!pkPair || !(pkPair === null || pkPair === void 0 ? void 0 : pkPair.code_verifier) || ((_b = (_a = pkPair === null || pkPair === void 0 ? void 0 : pkPair.code_verifier) === null || _a === void 0 ? void 0 : _a.trim()) === null || _b === void 0 ? void 0 : _b.length) === 0))) {
                _context68.next = 9;
                break;
              }
              throw new ui.MissingPKCEError();
            case 9:
              _context68.next = 11;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 11:
              _yield$this$dfpProtec22 = _context68.sent;
              dfp_telemetry_id = _yield$this$dfpProtec22.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec22.captcha_token;
              _context68.t0 = Object;
              _context68.t1 = pkPair === null || pkPair === void 0 ? void 0 : pkPair.code_verifier;
              _context68.t2 = dfp_telemetry_id;
              _context68.t3 = captcha_token;
              _context68.next = 20;
              return this._subscriptionService.getIntermediateSessionToken();
            case 20:
              _context68.t4 = _context68.sent;
              if (_context68.t4) {
                _context68.next = 23;
                break;
              }
              _context68.t4 = undefined;
            case 23:
              _context68.t5 = _context68.t4;
              _context68.t6 = {
                pkce_code_verifier: _context68.t1,
                dfp_telemetry_id: _context68.t2,
                captcha_token: _context68.t3,
                intermediate_session_token: _context68.t5
              };
              _context68.t7 = data;
              requestBody = _context68.t0.assign.call(_context68.t0, _context68.t6, _context68.t7);
              _context68.next = 29;
              return this._networkClient.retriableFetchSDK({
                url: '/b2b/magic_links/authenticate',
                body: requestBody,
                method: 'POST',
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              });
            case 29:
              resp = _context68.sent;
              pkceManager.clearPKPair();
              return _context68.abrupt("return", resp);
            case 32:
            case "end":
              return _context68.stop();
          }
        }, _callee68, this);
      }));
    }
  }]);
}();
var HeadlessB2BSelfClient = /*#__PURE__*/_createClass(function HeadlessB2BSelfClient(_networkClient, _apiNetworkClient, _subscriptionService) {
  var _this11 = this;
  _classCallCheck(this, HeadlessB2BSelfClient);
  this._networkClient = _networkClient;
  this._apiNetworkClient = _apiNetworkClient;
  this._subscriptionService = _subscriptionService;
  this.get = function () {
    return __awaiter(_this11, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee69() {
      var resp;
      return _regeneratorRuntime().wrap(function _callee69$(_context69) {
        while (1) switch (_context69.prev = _context69.next) {
          case 0:
            _context69.next = 2;
            return this._networkClient.fetchSDK({
              url: "/b2b/organizations/members/me",
              method: 'GET'
            });
          case 2:
            resp = _context69.sent;
            this._subscriptionService.updateMember(resp.member);
            return _context69.abrupt("return", resp.member);
          case 5:
          case "end":
            return _context69.stop();
        }
      }, _callee69, this);
    }));
  };
  this.getSync = function () {
    return _this11._subscriptionService.getMember();
  };
  this.getInfo = function () {
    return {
      member: _this11.getSync(),
      fromCache: _this11._subscriptionService.getFromCache()
    };
  };
  this.onChange = function (callback) {
    return _this11._subscriptionService.subscribeToState(function (state) {
      var _a;
      return callback((_a = state === null || state === void 0 ? void 0 : state.member) !== null && _a !== void 0 ? _a : null);
    });
  };
  this.update = function (data) {
    return __awaiter(_this11, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee70() {
      var resp;
      return _regeneratorRuntime().wrap(function _callee70$(_context70) {
        while (1) switch (_context70.prev = _context70.next) {
          case 0:
            validate('stytch.self.update').isOptionalString('name', data.name).isOptionalObject('untrusted_metadata', data.untrusted_metadata).isOptionalBoolean('mfa_enrolled', data.mfa_enrolled).isOptionalString('mfa_phone_number', data.mfa_phone_number).isOptionalString('default_mfa_method', data.default_mfa_method);
            _context70.next = 3;
            return this._networkClient.fetchSDK({
              url: '/b2b/organizations/members/update',
              body: data,
              method: 'PUT'
            });
          case 3:
            resp = _context70.sent;
            this._subscriptionService.updateMember(resp.member);
            return _context70.abrupt("return", resp);
          case 6:
          case "end":
            return _context70.stop();
        }
      }, _callee70, this);
    }));
  };
  this.deleteMFAPhoneNumber = function () {
    return __awaiter(_this11, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee71() {
      var resp;
      return _regeneratorRuntime().wrap(function _callee71$(_context71) {
        while (1) switch (_context71.prev = _context71.next) {
          case 0:
            _context71.next = 2;
            return this._networkClient.fetchSDK({
              url: '/b2b/organizations/members/deletePhoneNumber',
              method: 'DELETE'
            });
          case 2:
            resp = _context71.sent;
            this._subscriptionService.updateMember(resp.member);
            return _context71.abrupt("return", resp);
          case 5:
          case "end":
            return _context71.stop();
        }
      }, _callee71, this);
    }));
  };
  this.deleteMFATOTP = function () {
    return __awaiter(_this11, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee72() {
      var resp;
      return _regeneratorRuntime().wrap(function _callee72$(_context72) {
        while (1) switch (_context72.prev = _context72.next) {
          case 0:
            _context72.next = 2;
            return this._networkClient.fetchSDK({
              url: "/b2b/organizations/members/deleteTOTP",
              method: 'DELETE'
            });
          case 2:
            resp = _context72.sent;
            this._subscriptionService.updateMember(resp.member);
            return _context72.abrupt("return", resp);
          case 5:
          case "end":
            return _context72.stop();
        }
      }, _callee72, this);
    }));
  };
  this.deletePassword = function (passwordId) {
    return __awaiter(_this11, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee73() {
      var resp;
      return _regeneratorRuntime().wrap(function _callee73$(_context73) {
        while (1) switch (_context73.prev = _context73.next) {
          case 0:
            _context73.next = 2;
            return this._networkClient.fetchSDK({
              url: "/b2b/organizations/members/passwords/".concat(passwordId),
              method: 'DELETE'
            });
          case 2:
            resp = _context73.sent;
            this._subscriptionService.updateMember(resp.member);
            return _context73.abrupt("return", resp);
          case 5:
          case "end":
            return _context73.stop();
        }
      }, _callee73, this);
    }));
  };
  this.unlinkRetiredEmail = function (data) {
    return __awaiter(_this11, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee74() {
      var resp;
      return _regeneratorRuntime().wrap(function _callee74$(_context74) {
        while (1) switch (_context74.prev = _context74.next) {
          case 0:
            _context74.next = 2;
            return this._apiNetworkClient.fetchSDK({
              url: '/b2b/organizations/members/unlink_retired_email',
              method: 'POST',
              body: data
            });
          case 2:
            resp = _context74.sent;
            this._subscriptionService.updateMember(resp.member);
            return _context74.abrupt("return", resp);
          case 5:
          case "end":
            return _context74.stop();
        }
      }, _callee74, this);
    }));
  };
});
var HeadlessB2BSSOClient = /*#__PURE__*/function () {
  function HeadlessB2BSSOClient(_networkClient, _subscriptionService, _pkceManager, _dynamicConfig, _config, dfpProtectedAuth) {
    var _this12 = this;
    _classCallCheck(this, HeadlessB2BSSOClient);
    this._networkClient = _networkClient;
    this._subscriptionService = _subscriptionService;
    this._pkceManager = _pkceManager;
    this._dynamicConfig = _dynamicConfig;
    this._config = _config;
    this.dfpProtectedAuth = dfpProtectedAuth;
    this.saml = {
      createConnection: function createConnection(data) {
        return __awaiter(_this12, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee75() {
          return _regeneratorRuntime().wrap(function _callee75$(_context75) {
            while (1) switch (_context75.prev = _context75.next) {
              case 0:
                _context75.next = 2;
                return this._networkClient.fetchSDK({
                  url: '/b2b/sso/saml',
                  method: 'POST',
                  body: data
                });
              case 2:
                return _context75.abrupt("return", _context75.sent);
              case 3:
              case "end":
                return _context75.stop();
            }
          }, _callee75, this);
        }));
      },
      updateConnection: function updateConnection(data) {
        return __awaiter(_this12, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee76() {
          return _regeneratorRuntime().wrap(function _callee76$(_context76) {
            while (1) switch (_context76.prev = _context76.next) {
              case 0:
                _context76.next = 2;
                return this._networkClient.fetchSDK({
                  url: "/b2b/sso/saml/".concat(data.connection_id),
                  method: 'PUT',
                  body: data
                });
              case 2:
                return _context76.abrupt("return", _context76.sent);
              case 3:
              case "end":
                return _context76.stop();
            }
          }, _callee76, this);
        }));
      },
      updateConnectionByURL: function updateConnectionByURL(data) {
        return __awaiter(_this12, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee77() {
          return _regeneratorRuntime().wrap(function _callee77$(_context77) {
            while (1) switch (_context77.prev = _context77.next) {
              case 0:
                _context77.next = 2;
                return this._networkClient.fetchSDK({
                  url: "/b2b/sso/saml/".concat(data.connection_id, "/url"),
                  method: 'PUT',
                  body: data
                });
              case 2:
                return _context77.abrupt("return", _context77.sent);
              case 3:
              case "end":
                return _context77.stop();
            }
          }, _callee77, this);
        }));
      },
      deleteVerificationCertificate: function deleteVerificationCertificate(data) {
        return __awaiter(_this12, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee78() {
          return _regeneratorRuntime().wrap(function _callee78$(_context78) {
            while (1) switch (_context78.prev = _context78.next) {
              case 0:
                _context78.next = 2;
                return this._networkClient.fetchSDK({
                  url: "/b2b/sso/saml/".concat(data.connection_id, "/verification_certificates/").concat(data.certificate_id),
                  method: 'DELETE'
                });
              case 2:
                return _context78.abrupt("return", _context78.sent);
              case 3:
              case "end":
                return _context78.stop();
            }
          }, _callee78, this);
        }));
      }
    };
    this.oidc = {
      createConnection: function createConnection(data) {
        return __awaiter(_this12, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee79() {
          return _regeneratorRuntime().wrap(function _callee79$(_context79) {
            while (1) switch (_context79.prev = _context79.next) {
              case 0:
                _context79.next = 2;
                return this._networkClient.fetchSDK({
                  url: '/b2b/sso/oidc',
                  method: 'POST',
                  body: data
                });
              case 2:
                return _context79.abrupt("return", _context79.sent);
              case 3:
              case "end":
                return _context79.stop();
            }
          }, _callee79, this);
        }));
      },
      updateConnection: function updateConnection(data) {
        return __awaiter(_this12, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee80() {
          return _regeneratorRuntime().wrap(function _callee80$(_context80) {
            while (1) switch (_context80.prev = _context80.next) {
              case 0:
                _context80.next = 2;
                return this._networkClient.fetchSDK({
                  url: "/b2b/sso/oidc/".concat(data.connection_id),
                  method: 'PUT',
                  body: data
                });
              case 2:
                return _context80.abrupt("return", _context80.sent);
              case 3:
              case "end":
                return _context80.stop();
            }
          }, _callee80, this);
        }));
      }
    };
    this.external = {
      createConnection: function createConnection(data) {
        return __awaiter(_this12, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee81() {
          return _regeneratorRuntime().wrap(function _callee81$(_context81) {
            while (1) switch (_context81.prev = _context81.next) {
              case 0:
                _context81.next = 2;
                return this._networkClient.fetchSDK({
                  url: '/b2b/sso/external',
                  method: 'POST',
                  body: data
                });
              case 2:
                return _context81.abrupt("return", _context81.sent);
              case 3:
              case "end":
                return _context81.stop();
            }
          }, _callee81, this);
        }));
      },
      updateConnection: function updateConnection(data) {
        return __awaiter(_this12, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee82() {
          return _regeneratorRuntime().wrap(function _callee82$(_context82) {
            while (1) switch (_context82.prev = _context82.next) {
              case 0:
                _context82.next = 2;
                return this._networkClient.fetchSDK({
                  url: "/b2b/sso/external/".concat(data.connection_id),
                  method: 'PUT',
                  body: data
                });
              case 2:
                return _context82.abrupt("return", _context82.sent);
              case 3:
              case "end":
                return _context82.stop();
            }
          }, _callee82, this);
        }));
      }
    };
  }
  return _createClass(HeadlessB2BSSOClient, [{
    key: "authenticate",
    value: function authenticate(options) {
      var _a, _b;
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee83() {
        var keyPair, _yield$this$_dynamicC4, pkceRequiredForSso, _yield$this$dfpProtec23, dfp_telemetry_id, captcha_token, resp;
        return _regeneratorRuntime().wrap(function _callee83$(_context83) {
          while (1) switch (_context83.prev = _context83.next) {
            case 0:
              validate('stytch.sso.authenticate').isString('sso_token', options.sso_token).isNumber('session_duration_minutes', options.session_duration_minutes).isOptionalString('locale', options.locale);
              _context83.next = 3;
              return this._pkceManager.getPKPair();
            case 3:
              keyPair = _context83.sent;
              _context83.next = 6;
              return this._dynamicConfig;
            case 6:
              _yield$this$_dynamicC4 = _context83.sent;
              pkceRequiredForSso = _yield$this$_dynamicC4.pkceRequiredForSso;
              if (!(pkceRequiredForSso && (!keyPair || !(keyPair === null || keyPair === void 0 ? void 0 : keyPair.code_verifier) || ((_b = (_a = keyPair === null || keyPair === void 0 ? void 0 : keyPair.code_verifier) === null || _a === void 0 ? void 0 : _a.trim()) === null || _b === void 0 ? void 0 : _b.length) === 0))) {
                _context83.next = 10;
                break;
              }
              throw new ui.MissingPKCEError();
            case 10:
              if (!keyPair) {
                logger.warn('No code verifier found in local storage for SSO flow.\n' + 'Consider using stytch.sso.start() to add PKCE to your SSO flows for added security.\n' + 'See https://stytch.com/docs/oauth#guides_pkce for more information.');
              }
              _context83.next = 13;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 13:
              _yield$this$dfpProtec23 = _context83.sent;
              dfp_telemetry_id = _yield$this$dfpProtec23.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec23.captcha_token;
              _context83.t0 = this._networkClient;
              _context83.t1 = Object;
              _context83.t2 = Object.assign({
                pkce_code_verifier: keyPair === null || keyPair === void 0 ? void 0 : keyPair.code_verifier
              }, options);
              _context83.t3 = dfp_telemetry_id;
              _context83.t4 = captcha_token;
              _context83.next = 23;
              return this._subscriptionService.getIntermediateSessionToken();
            case 23:
              _context83.t5 = _context83.sent;
              if (_context83.t5) {
                _context83.next = 26;
                break;
              }
              _context83.t5 = undefined;
            case 26:
              _context83.t6 = _context83.t5;
              _context83.t7 = {
                dfp_telemetry_id: _context83.t3,
                captcha_token: _context83.t4,
                intermediate_session_token: _context83.t6
              };
              _context83.t8 = _context83.t1.assign.call(_context83.t1, _context83.t2, _context83.t7);
              _context83.t9 = this.dfpProtectedAuth.retryWithCaptchaAndDFP;
              _context83.t10 = {
                url: '/b2b/sso/authenticate',
                method: 'POST',
                body: _context83.t8,
                retryCallback: _context83.t9
              };
              _context83.next = 33;
              return _context83.t0.retriableFetchSDK.call(_context83.t0, _context83.t10);
            case 33:
              resp = _context83.sent;
              this._pkceManager.clearPKPair();
              this._subscriptionService.updateSession(resp);
              return _context83.abrupt("return", resp);
            case 37:
            case "end":
              return _context83.stop();
          }
        }, _callee83, this);
      }));
    }
  }, {
    key: "getBaseApiUrl",
    value: function getBaseApiUrl() {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee84() {
        return _regeneratorRuntime().wrap(function _callee84$(_context84) {
          while (1) switch (_context84.prev = _context84.next) {
            case 0:
              if (!isTestPublicToken(this._config.publicToken)) {
                _context84.next = 2;
                break;
              }
              return _context84.abrupt("return", this._config.testAPIURL);
            case 2:
              return _context84.abrupt("return", this._config.liveAPIURL);
            case 3:
            case "end":
              return _context84.stop();
          }
        }, _callee84, this);
      }));
    }
  }, {
    key: "start",
    value: function start(_ref7) {
      var connection_id = _ref7.connection_id,
        login_redirect_url = _ref7.login_redirect_url,
        signup_redirect_url = _ref7.signup_redirect_url;
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee85() {
        var _yield$this$_dynamicC5, pkceRequiredForSso, baseURL, startUrl, keyPair;
        return _regeneratorRuntime().wrap(function _callee85$(_context85) {
          while (1) switch (_context85.prev = _context85.next) {
            case 0:
              _context85.next = 2;
              return this._dynamicConfig;
            case 2:
              _yield$this$_dynamicC5 = _context85.sent;
              pkceRequiredForSso = _yield$this$_dynamicC5.pkceRequiredForSso;
              _context85.next = 6;
              return this.getBaseApiUrl();
            case 6:
              baseURL = _context85.sent;
              startUrl = new URL("".concat(baseURL, "/v1/public/sso/start"));
              startUrl.searchParams.set('public_token', this._config.publicToken);
              startUrl.searchParams.set('connection_id', connection_id);
              if (!pkceRequiredForSso) {
                _context85.next = 17;
                break;
              }
              _context85.next = 13;
              return this._pkceManager.startPKCETransaction();
            case 13:
              keyPair = _context85.sent;
              startUrl.searchParams.set('pkce_code_challenge', keyPair.code_challenge);
              _context85.next = 18;
              break;
            case 17:
              this._pkceManager.clearPKPair();
            case 18:
              login_redirect_url && startUrl.searchParams.set('login_redirect_url', login_redirect_url);
              signup_redirect_url && startUrl.searchParams.set('signup_redirect_url', signup_redirect_url);
              window.location.href = startUrl.toString();
            case 21:
            case "end":
              return _context85.stop();
          }
        }, _callee85, this);
      }));
    }
  }, {
    key: "getConnections",
    value: function getConnections() {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee86() {
        return _regeneratorRuntime().wrap(function _callee86$(_context86) {
          while (1) switch (_context86.prev = _context86.next) {
            case 0:
              _context86.next = 2;
              return this._networkClient.fetchSDK({
                url: '/b2b/sso',
                method: 'GET'
              });
            case 2:
              return _context86.abrupt("return", _context86.sent);
            case 3:
            case "end":
              return _context86.stop();
          }
        }, _callee86, this);
      }));
    }
  }, {
    key: "discoverConnections",
    value: function discoverConnections(emailAddress) {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee87() {
        return _regeneratorRuntime().wrap(function _callee87$(_context87) {
          while (1) switch (_context87.prev = _context87.next) {
            case 0:
              _context87.next = 2;
              return this._networkClient.fetchSDK({
                url: "/b2b/sso/discovery/connections?email_address=".concat(encodeURIComponent(emailAddress)),
                method: 'GET'
              });
            case 2:
              return _context87.abrupt("return", _context87.sent);
            case 3:
            case "end":
              return _context87.stop();
          }
        }, _callee87, this);
      }));
    }
  }, {
    key: "deleteConnection",
    value: function deleteConnection(connectionId) {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee88() {
        return _regeneratorRuntime().wrap(function _callee88$(_context88) {
          while (1) switch (_context88.prev = _context88.next) {
            case 0:
              return _context88.abrupt("return", this._networkClient.fetchSDK({
                url: "/b2b/sso/".concat(connectionId),
                method: 'DELETE'
              }));
            case 1:
            case "end":
              return _context88.stop();
          }
        }, _callee88, this);
      }));
    }
  }]);
}();
var HeadlessB2BSCIMClient = /*#__PURE__*/function () {
  function HeadlessB2BSCIMClient(_networkClient, _subscriptionService) {
    _classCallCheck(this, HeadlessB2BSCIMClient);
    this._networkClient = _networkClient;
    this._subscriptionService = _subscriptionService;
  }
  return _createClass(HeadlessB2BSCIMClient, [{
    key: "createConnection",
    value: function createConnection(data) {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee89() {
        return _regeneratorRuntime().wrap(function _callee89$(_context89) {
          while (1) switch (_context89.prev = _context89.next) {
            case 0:
              validate('stytch.scim.createConnection').isOptionalString('display_name', data.display_name).isOptionalString('identity_provider', data.identity_provider);
              _context89.next = 3;
              return this._networkClient.fetchSDK({
                url: '/b2b/scim',
                method: 'POST',
                body: data
              });
            case 3:
              return _context89.abrupt("return", _context89.sent);
            case 4:
            case "end":
              return _context89.stop();
          }
        }, _callee89, this);
      }));
    }
  }, {
    key: "updateConnection",
    value: function updateConnection(data) {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee90() {
        return _regeneratorRuntime().wrap(function _callee90$(_context90) {
          while (1) switch (_context90.prev = _context90.next) {
            case 0:
              validate('stytch.scim.updateConnection').isString('connection_id', data.connection_id).isOptionalString('display_name', data.display_name).isOptionalString('identity_provider', data.identity_provider);
              _context90.next = 3;
              return this._networkClient.fetchSDK({
                url: "/b2b/scim/".concat(data.connection_id),
                method: 'PUT',
                body: data
              });
            case 3:
              return _context90.abrupt("return", _context90.sent);
            case 4:
            case "end":
              return _context90.stop();
          }
        }, _callee90, this);
      }));
    }
  }, {
    key: "deleteConnection",
    value: function deleteConnection(connectionId) {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee91() {
        return _regeneratorRuntime().wrap(function _callee91$(_context91) {
          while (1) switch (_context91.prev = _context91.next) {
            case 0:
              validate('stytch.scim.deleteConnection').isString('connection_id', connectionId);
              _context91.next = 3;
              return this._networkClient.fetchSDK({
                url: "/b2b/scim/".concat(connectionId),
                method: 'DELETE'
              });
            case 3:
              return _context91.abrupt("return", _context91.sent);
            case 4:
            case "end":
              return _context91.stop();
          }
        }, _callee91, this);
      }));
    }
  }, {
    key: "getConnection",
    value: function getConnection() {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee92() {
        return _regeneratorRuntime().wrap(function _callee92$(_context92) {
          while (1) switch (_context92.prev = _context92.next) {
            case 0:
              _context92.next = 2;
              return this._networkClient.fetchSDK({
                url: '/b2b/scim',
                method: 'GET'
              });
            case 2:
              return _context92.abrupt("return", _context92.sent);
            case 3:
            case "end":
              return _context92.stop();
          }
        }, _callee92, this);
      }));
    }
  }, {
    key: "getConnectionGroups",
    value: function getConnectionGroups(data) {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee93() {
        return _regeneratorRuntime().wrap(function _callee93$(_context93) {
          while (1) switch (_context93.prev = _context93.next) {
            case 0:
              validate('stytch.scim.getConnectionGroups').isOptionalNumber('limit', data.limit).isOptionalString('cursor', data.cursor);
              _context93.next = 3;
              return this._networkClient.fetchSDK({
                url: '/b2b/scim/groups',
                method: 'POST',
                body: data
              });
            case 3:
              return _context93.abrupt("return", _context93.sent);
            case 4:
            case "end":
              return _context93.stop();
          }
        }, _callee93, this);
      }));
    }
  }, {
    key: "rotateStart",
    value: function rotateStart(connectionId) {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee94() {
        return _regeneratorRuntime().wrap(function _callee94$(_context94) {
          while (1) switch (_context94.prev = _context94.next) {
            case 0:
              validate('stytch.scim.rotateStart').isString('connectionId', connectionId);
              _context94.next = 3;
              return this._networkClient.fetchSDK({
                url: "/b2b/scim/rotate/start",
                method: 'POST',
                body: {
                  connection_id: connectionId
                }
              });
            case 3:
              return _context94.abrupt("return", _context94.sent);
            case 4:
            case "end":
              return _context94.stop();
          }
        }, _callee94, this);
      }));
    }
  }, {
    key: "rotateComplete",
    value: function rotateComplete(connectionId) {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee95() {
        return _regeneratorRuntime().wrap(function _callee95$(_context95) {
          while (1) switch (_context95.prev = _context95.next) {
            case 0:
              validate('stytch.scim.rotateComplete').isString('connectionId', connectionId);
              _context95.next = 3;
              return this._networkClient.fetchSDK({
                url: "/b2b/scim/rotate/complete",
                method: 'POST',
                body: {
                  connection_id: connectionId
                }
              });
            case 3:
              return _context95.abrupt("return", _context95.sent);
            case 4:
            case "end":
              return _context95.stop();
          }
        }, _callee95, this);
      }));
    }
  }, {
    key: "rotateCancel",
    value: function rotateCancel(connectionId) {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee96() {
        return _regeneratorRuntime().wrap(function _callee96$(_context96) {
          while (1) switch (_context96.prev = _context96.next) {
            case 0:
              validate('stytch.scim.rotateCancel').isString('connectionId', connectionId);
              _context96.next = 3;
              return this._networkClient.fetchSDK({
                url: "/b2b/scim/rotate/cancel",
                method: 'POST',
                body: {
                  connection_id: connectionId
                }
              });
            case 3:
              return _context96.abrupt("return", _context96.sent);
            case 4:
            case "end":
              return _context96.stop();
          }
        }, _callee96, this);
      }));
    }
  }]);
}();
var HeadlessB2BOrganizationClient = /*#__PURE__*/_createClass(function HeadlessB2BOrganizationClient(_networkClient, _apiNetworkClient, _subscriptionService) {
  var _this13 = this;
  _classCallCheck(this, HeadlessB2BOrganizationClient);
  this._networkClient = _networkClient;
  this._apiNetworkClient = _apiNetworkClient;
  this._subscriptionService = _subscriptionService;
  this.get = function () {
    return __awaiter(_this13, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee97() {
      var resp;
      return _regeneratorRuntime().wrap(function _callee97$(_context97) {
        while (1) switch (_context97.prev = _context97.next) {
          case 0:
            _context97.next = 2;
            return this._networkClient.fetchSDK({
              url: "/b2b/organizations/me",
              method: 'GET'
            });
          case 2:
            resp = _context97.sent;
            this._subscriptionService.updateOrganization(resp.organization);
            return _context97.abrupt("return", resp.organization);
          case 5:
          case "end":
            return _context97.stop();
        }
      }, _callee97, this);
    }));
  };
  this.getSync = function () {
    return _this13._subscriptionService.getOrganization();
  };
  this.getInfo = function () {
    return {
      organization: _this13.getSync(),
      fromCache: _this13._subscriptionService.getFromCache()
    };
  };
  this.onChange = function (callback) {
    return _this13._subscriptionService.subscribeToState(function (state) {
      var _a;
      return callback((_a = state === null || state === void 0 ? void 0 : state.organization) !== null && _a !== void 0 ? _a : null);
    });
  };
  this.update = function (data) {
    return __awaiter(_this13, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee98() {
      var resp;
      return _regeneratorRuntime().wrap(function _callee98$(_context98) {
        while (1) switch (_context98.prev = _context98.next) {
          case 0:
            _context98.next = 2;
            return this._networkClient.fetchSDK({
              url: "/b2b/organizations/me",
              method: 'PUT',
              body: data
            });
          case 2:
            resp = _context98.sent;
            this._subscriptionService.updateOrganization(resp.organization);
            return _context98.abrupt("return", resp);
          case 5:
          case "end":
            return _context98.stop();
        }
      }, _callee98, this);
    }));
  };
  this["delete"] = function () {
    return __awaiter(_this13, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee99() {
      var resp;
      return _regeneratorRuntime().wrap(function _callee99$(_context99) {
        while (1) switch (_context99.prev = _context99.next) {
          case 0:
            _context99.next = 2;
            return this._networkClient.fetchSDK({
              url: "/b2b/organizations/me",
              method: 'DELETE'
            });
          case 2:
            resp = _context99.sent;
            this._subscriptionService.destroyState();
            return _context99.abrupt("return", resp);
          case 5:
          case "end":
            return _context99.stop();
        }
      }, _callee99, this);
    }));
  };
  this.getBySlug = function (data) {
    return __awaiter(_this13, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee100() {
      return _regeneratorRuntime().wrap(function _callee100$(_context100) {
        while (1) switch (_context100.prev = _context100.next) {
          case 0:
            validate('stytch.organization.getBySlug').isString('organization_slug', data.organization_slug);
            return _context100.abrupt("return", this._networkClient.fetchSDK({
              url: "/b2b/organizations/search",
              method: 'POST',
              body: data
            }));
          case 2:
          case "end":
            return _context100.stop();
        }
      }, _callee100, this);
    }));
  };
  this.members = {
    create: function create(data) {
      return __awaiter(_this13, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee101() {
        return _regeneratorRuntime().wrap(function _callee101$(_context101) {
          while (1) switch (_context101.prev = _context101.next) {
            case 0:
              return _context101.abrupt("return", this._networkClient.fetchSDK({
                url: "/b2b/organizations/members",
                method: 'POST',
                body: data
              }));
            case 1:
            case "end":
              return _context101.stop();
          }
        }, _callee101, this);
      }));
    },
    search: function search(data) {
      return __awaiter(_this13, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee102() {
        return _regeneratorRuntime().wrap(function _callee102$(_context102) {
          while (1) switch (_context102.prev = _context102.next) {
            case 0:
              return _context102.abrupt("return", this._networkClient.fetchSDK({
                url: "/b2b/organizations/me/members/search",
                method: 'POST',
                body: data
              }));
            case 1:
            case "end":
              return _context102.stop();
          }
        }, _callee102, this);
      }));
    },
    update: function update(data) {
      return __awaiter(_this13, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee103() {
        var response;
        return _regeneratorRuntime().wrap(function _callee103$(_context103) {
          while (1) switch (_context103.prev = _context103.next) {
            case 0:
              _context103.next = 2;
              return this._networkClient.fetchSDK({
                url: "/b2b/organizations/members/".concat(data.member_id),
                method: 'PUT',
                body: data
              });
            case 2:
              response = _context103.sent;
              this.updateMemberIfSelf(response);
              return _context103.abrupt("return", response);
            case 5:
            case "end":
              return _context103.stop();
          }
        }, _callee103, this);
      }));
    },
    deletePassword: function deletePassword(passwordId) {
      return __awaiter(_this13, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee104() {
        var response;
        return _regeneratorRuntime().wrap(function _callee104$(_context104) {
          while (1) switch (_context104.prev = _context104.next) {
            case 0:
              _context104.next = 2;
              return this._networkClient.fetchSDK({
                url: "/b2b/organizations/members/passwords/".concat(passwordId),
                method: 'DELETE'
              });
            case 2:
              response = _context104.sent;
              this.updateMemberIfSelf(response);
              return _context104.abrupt("return", response);
            case 5:
            case "end":
              return _context104.stop();
          }
        }, _callee104, this);
      }));
    },
    deleteMFAPhoneNumber: function deleteMFAPhoneNumber(memberId) {
      return __awaiter(_this13, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee105() {
        var response;
        return _regeneratorRuntime().wrap(function _callee105$(_context105) {
          while (1) switch (_context105.prev = _context105.next) {
            case 0:
              _context105.next = 2;
              return this._networkClient.fetchSDK({
                url: "/b2b/organizations/members/mfa_phone_numbers/".concat(memberId),
                method: 'DELETE'
              });
            case 2:
              response = _context105.sent;
              this.updateMemberIfSelf(response);
              return _context105.abrupt("return", response);
            case 5:
            case "end":
              return _context105.stop();
          }
        }, _callee105, this);
      }));
    },
    deleteMFATOTP: function deleteMFATOTP(memberId) {
      return __awaiter(_this13, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee106() {
        var response;
        return _regeneratorRuntime().wrap(function _callee106$(_context106) {
          while (1) switch (_context106.prev = _context106.next) {
            case 0:
              _context106.next = 2;
              return this._networkClient.fetchSDK({
                url: "/b2b/organizations/members/totp/".concat(memberId),
                method: 'DELETE'
              });
            case 2:
              response = _context106.sent;
              this.updateMemberIfSelf(response);
              return _context106.abrupt("return", response);
            case 5:
            case "end":
              return _context106.stop();
          }
        }, _callee106, this);
      }));
    },
    "delete": function _delete(memberId) {
      return __awaiter(_this13, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee107() {
        var _a, response;
        return _regeneratorRuntime().wrap(function _callee107$(_context107) {
          while (1) switch (_context107.prev = _context107.next) {
            case 0:
              _context107.next = 2;
              return this._networkClient.fetchSDK({
                url: "/b2b/organizations/members/".concat(memberId),
                method: 'DELETE'
              });
            case 2:
              response = _context107.sent;
              if (memberId === ((_a = this._subscriptionService.getMember()) === null || _a === void 0 ? void 0 : _a.member_id)) {
                this._subscriptionService.destroyState();
              }
              return _context107.abrupt("return", response);
            case 5:
            case "end":
              return _context107.stop();
          }
        }, _callee107, this);
      }));
    },
    reactivate: function reactivate(memberId) {
      return __awaiter(_this13, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee108() {
        return _regeneratorRuntime().wrap(function _callee108$(_context108) {
          while (1) switch (_context108.prev = _context108.next) {
            case 0:
              return _context108.abrupt("return", this._networkClient.fetchSDK({
                url: "/b2b/organizations/members/".concat(memberId, "/reactivate"),
                method: 'PUT'
              }));
            case 1:
            case "end":
              return _context108.stop();
          }
        }, _callee108, this);
      }));
    },
    unlinkRetiredEmail: function unlinkRetiredEmail(data) {
      return __awaiter(_this13, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee109() {
        var member_id, body, response;
        return _regeneratorRuntime().wrap(function _callee109$(_context109) {
          while (1) switch (_context109.prev = _context109.next) {
            case 0:
              member_id = data.member_id, body = __rest(data, ["member_id"]);
              _context109.next = 3;
              return this._apiNetworkClient.fetchSDK({
                url: "/b2b/organizations/members/".concat(member_id, "/unlink_retired_email"),
                method: 'POST',
                body: body
              });
            case 3:
              response = _context109.sent;
              this.updateMemberIfSelf(response);
              return _context109.abrupt("return", response);
            case 6:
            case "end":
              return _context109.stop();
          }
        }, _callee109, this);
      }));
    }
  };
  this.updateMemberIfSelf = function (response) {
    var _a;
    if (response.member_id === ((_a = _this13._subscriptionService.getMember()) === null || _a === void 0 ? void 0 : _a.member_id)) {
      _this13._subscriptionService.updateMember(response.member);
    }
  };
});
var HeadlessB2BOAuthClient = /*#__PURE__*/function () {
  function HeadlessB2BOAuthClient(_networkClient, _subscriptionService, _pkceManager, _dynamicConfig, _config, dfpProtectedAuth) {
    var _this14 = this;
    _classCallCheck(this, HeadlessB2BOAuthClient);
    this._networkClient = _networkClient;
    this._subscriptionService = _subscriptionService;
    this._pkceManager = _pkceManager;
    this._dynamicConfig = _dynamicConfig;
    this._config = _config;
    this.dfpProtectedAuth = dfpProtectedAuth;
    this.discovery = {
      authenticate: function authenticate(data) {
        return __awaiter(_this14, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee110() {
          var pkPair, _yield$this$dfpProtec24, dfp_telemetry_id, captcha_token, requestBody, resp;
          return _regeneratorRuntime().wrap(function _callee110$(_context110) {
            while (1) switch (_context110.prev = _context110.next) {
              case 0:
                validate('stytch.oauth.discovery.authenticate').isString('discovery_oauth_token', data.discovery_oauth_token);
                _context110.next = 3;
                return this._pkceManager.getPKPair();
              case 3:
                pkPair = _context110.sent;
                _context110.next = 6;
                return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
              case 6:
                _yield$this$dfpProtec24 = _context110.sent;
                dfp_telemetry_id = _yield$this$dfpProtec24.dfp_telemetry_id;
                captcha_token = _yield$this$dfpProtec24.captcha_token;
                requestBody = Object.assign({
                  pkce_code_verifier: pkPair === null || pkPair === void 0 ? void 0 : pkPair.code_verifier,
                  dfp_telemetry_id: dfp_telemetry_id,
                  captcha_token: captcha_token
                }, data);
                _context110.next = 12;
                return this._networkClient.retriableFetchSDK({
                  url: '/b2b/oauth/discovery/authenticate',
                  body: requestBody,
                  method: 'POST',
                  retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
                });
              case 12:
                resp = _context110.sent;
                this._pkceManager.clearPKPair();
                this._subscriptionService.updateSession(resp);
                return _context110.abrupt("return", resp);
              case 16:
              case "end":
                return _context110.stop();
            }
          }, _callee110, this);
        }));
      }
    };
    this.google = {
      start: this.startOAuthFlow(ui.B2BOAuthProviders.Google),
      discovery: {
        start: this.startDiscoveryOAuthFlow(ui.B2BOAuthProviders.Google)
      }
    };
    this.microsoft = {
      start: this.startOAuthFlow(ui.B2BOAuthProviders.Microsoft),
      discovery: {
        start: this.startDiscoveryOAuthFlow(ui.B2BOAuthProviders.Microsoft)
      }
    };
    this.hubspot = {
      start: this.startOAuthFlow(ui.B2BOAuthProviders.HubSpot),
      discovery: {
        start: this.startDiscoveryOAuthFlow(ui.B2BOAuthProviders.HubSpot)
      }
    };
    this.slack = {
      start: this.startOAuthFlow(ui.B2BOAuthProviders.Slack),
      discovery: {
        start: this.startDiscoveryOAuthFlow(ui.B2BOAuthProviders.Slack)
      }
    };
    this.github = {
      start: this.startOAuthFlow(ui.B2BOAuthProviders.GitHub),
      discovery: {
        start: this.startDiscoveryOAuthFlow(ui.B2BOAuthProviders.GitHub)
      }
    };
  }
  return _createClass(HeadlessB2BOAuthClient, [{
    key: "authenticate",
    value: function authenticate(options) {
      var _a, _b;
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee111() {
        var keyPair, _yield$this$_dynamicC6, pkceRequiredForOAuth, _yield$this$dfpProtec25, dfp_telemetry_id, captcha_token, resp;
        return _regeneratorRuntime().wrap(function _callee111$(_context111) {
          while (1) switch (_context111.prev = _context111.next) {
            case 0:
              validate('stytch.oauth.authenticate').isString('oauth_token', options.oauth_token).isNumber('session_duration_minutes', options.session_duration_minutes).isOptionalString('locale', options.locale);
              _context111.next = 3;
              return this._pkceManager.getPKPair();
            case 3:
              keyPair = _context111.sent;
              _context111.next = 6;
              return this._dynamicConfig;
            case 6:
              _yield$this$_dynamicC6 = _context111.sent;
              pkceRequiredForOAuth = _yield$this$_dynamicC6.pkceRequiredForOAuth;
              if (!(pkceRequiredForOAuth && (!keyPair || !(keyPair === null || keyPair === void 0 ? void 0 : keyPair.code_verifier) || ((_b = (_a = keyPair === null || keyPair === void 0 ? void 0 : keyPair.code_verifier) === null || _a === void 0 ? void 0 : _a.trim()) === null || _b === void 0 ? void 0 : _b.length) === 0))) {
                _context111.next = 10;
                break;
              }
              throw new ui.MissingPKCEError();
            case 10:
              if (!keyPair) {
                logger.warn('No code verifier found in local storage for OAuth flow.\n' + 'Consider using stytch.oauth.$provider.start() to add PKCE to your OAuth flows for added security.\n' + 'See https://stytch.com/docs/oauth#guides_pkce for more information.');
              }
              _context111.next = 13;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 13:
              _yield$this$dfpProtec25 = _context111.sent;
              dfp_telemetry_id = _yield$this$dfpProtec25.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec25.captcha_token;
              _context111.t0 = this._networkClient;
              _context111.t1 = Object;
              _context111.t2 = keyPair === null || keyPair === void 0 ? void 0 : keyPair.code_verifier;
              _context111.t3 = dfp_telemetry_id;
              _context111.t4 = captcha_token;
              _context111.next = 23;
              return this._subscriptionService.getIntermediateSessionToken();
            case 23:
              _context111.t5 = _context111.sent;
              if (_context111.t5) {
                _context111.next = 26;
                break;
              }
              _context111.t5 = undefined;
            case 26:
              _context111.t6 = _context111.t5;
              _context111.t7 = {
                pkce_code_verifier: _context111.t2,
                dfp_telemetry_id: _context111.t3,
                captcha_token: _context111.t4,
                intermediate_session_token: _context111.t6
              };
              _context111.t8 = options;
              _context111.t9 = _context111.t1.assign.call(_context111.t1, _context111.t7, _context111.t8);
              _context111.t10 = this.dfpProtectedAuth.retryWithCaptchaAndDFP;
              _context111.t11 = {
                url: '/b2b/oauth/authenticate',
                method: 'POST',
                body: _context111.t9,
                retryCallback: _context111.t10
              };
              _context111.next = 34;
              return _context111.t0.retriableFetchSDK.call(_context111.t0, _context111.t11);
            case 34:
              resp = _context111.sent;
              this._pkceManager.clearPKPair();
              this._subscriptionService.updateSession(resp);
              return _context111.abrupt("return", resp);
            case 38:
            case "end":
              return _context111.stop();
          }
        }, _callee111, this);
      }));
    }
  }, {
    key: "getBaseApiUrl",
    value: function getBaseApiUrl() {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee112() {
        var _yield$this$_dynamicC7, cnameDomain;
        return _regeneratorRuntime().wrap(function _callee112$(_context112) {
          while (1) switch (_context112.prev = _context112.next) {
            case 0:
              _context112.next = 2;
              return this._dynamicConfig;
            case 2:
              _yield$this$_dynamicC7 = _context112.sent;
              cnameDomain = _yield$this$_dynamicC7.cnameDomain;
              if (!cnameDomain) {
                _context112.next = 6;
                break;
              }
              return _context112.abrupt("return", "https://".concat(cnameDomain));
            case 6:
              if (!isTestPublicToken(this._config.publicToken)) {
                _context112.next = 8;
                break;
              }
              return _context112.abrupt("return", this._config.testAPIURL);
            case 8:
              return _context112.abrupt("return", this._config.liveAPIURL);
            case 9:
            case "end":
              return _context112.stop();
          }
        }, _callee112, this);
      }));
    }
  }, {
    key: "startOAuthFlow",
    value: function startOAuthFlow(providerType) {
      var _this15 = this;
      return function (_ref8) {
        var organization_id = _ref8.organization_id,
          organization_slug = _ref8.organization_slug,
          login_redirect_url = _ref8.login_redirect_url,
          signup_redirect_url = _ref8.signup_redirect_url,
          custom_scopes = _ref8.custom_scopes,
          provider_params = _ref8.provider_params;
        return __awaiter(_this15, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee113() {
          var _yield$this$_dynamicC8, pkceRequiredForOAuth, baseURL, startUrl, key, keyPair;
          return _regeneratorRuntime().wrap(function _callee113$(_context113) {
            while (1) switch (_context113.prev = _context113.next) {
              case 0:
                _context113.next = 2;
                return this._dynamicConfig;
              case 2:
                _yield$this$_dynamicC8 = _context113.sent;
                pkceRequiredForOAuth = _yield$this$_dynamicC8.pkceRequiredForOAuth;
                _context113.next = 6;
                return this.getBaseApiUrl();
              case 6:
                baseURL = _context113.sent;
                startUrl = new URL("".concat(baseURL, "/v1/b2b/public/oauth/").concat(providerType, "/start"));
                startUrl.searchParams.set('public_token', this._config.publicToken);
                if (organization_id && organization_id != '') {
                  startUrl.searchParams.set('organization_id', organization_id);
                }
                if (organization_slug && organization_slug != '') {
                  startUrl.searchParams.set('slug', organization_slug);
                }
                if (custom_scopes) {
                  validate('startOAuthFlow').isStringArray('custom_scopes', custom_scopes);
                  startUrl.searchParams.set('custom_scopes', custom_scopes.join(' '));
                }
                if (provider_params) {
                  validate('startOAuthFlow').isOptionalObject('provider_params', provider_params);
                  for (key in provider_params) {
                    startUrl.searchParams.set('provider_' + key, provider_params[key]);
                  }
                }
                if (!pkceRequiredForOAuth) {
                  _context113.next = 20;
                  break;
                }
                _context113.next = 16;
                return this._pkceManager.startPKCETransaction();
              case 16:
                keyPair = _context113.sent;
                startUrl.searchParams.set('pkce_code_challenge', keyPair.code_challenge);
                _context113.next = 21;
                break;
              case 20:
                this._pkceManager.clearPKPair();
              case 21:
                login_redirect_url && startUrl.searchParams.set('login_redirect_url', login_redirect_url);
                signup_redirect_url && startUrl.searchParams.set('signup_redirect_url', signup_redirect_url);
                window.location.href = startUrl.toString();
              case 24:
              case "end":
                return _context113.stop();
            }
          }, _callee113, this);
        }));
      };
    }
  }, {
    key: "startDiscoveryOAuthFlow",
    value: function startDiscoveryOAuthFlow(providerType) {
      var _this16 = this;
      return function (_ref9) {
        var discovery_redirect_url = _ref9.discovery_redirect_url,
          custom_scopes = _ref9.custom_scopes,
          provider_params = _ref9.provider_params;
        return __awaiter(_this16, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee114() {
          var _yield$this$_dynamicC9, pkceRequiredForOAuth, baseURL, startUrl, key, keyPair;
          return _regeneratorRuntime().wrap(function _callee114$(_context114) {
            while (1) switch (_context114.prev = _context114.next) {
              case 0:
                _context114.next = 2;
                return this._dynamicConfig;
              case 2:
                _yield$this$_dynamicC9 = _context114.sent;
                pkceRequiredForOAuth = _yield$this$_dynamicC9.pkceRequiredForOAuth;
                _context114.next = 6;
                return this.getBaseApiUrl();
              case 6:
                baseURL = _context114.sent;
                startUrl = new URL("".concat(baseURL, "/v1/b2b/public/oauth/").concat(providerType, "/discovery/start"));
                startUrl.searchParams.set('public_token', this._config.publicToken);
                if (custom_scopes) {
                  validate('startOAuthFlow').isStringArray('custom_scopes', custom_scopes);
                  startUrl.searchParams.set('custom_scopes', custom_scopes.join(' '));
                }
                if (provider_params) {
                  validate('startOAuthFlow').isOptionalObject('provider_params', provider_params);
                  for (key in provider_params) {
                    startUrl.searchParams.set('provider_' + key, provider_params[key]);
                  }
                }
                if (!pkceRequiredForOAuth) {
                  _context114.next = 18;
                  break;
                }
                _context114.next = 14;
                return this._pkceManager.startPKCETransaction();
              case 14:
                keyPair = _context114.sent;
                startUrl.searchParams.set('pkce_code_challenge', keyPair.code_challenge);
                _context114.next = 19;
                break;
              case 18:
                this._pkceManager.clearPKPair();
              case 19:
                discovery_redirect_url && startUrl.searchParams.set('discovery_redirect_url', discovery_redirect_url);
                window.location.href = startUrl.toString();
              case 21:
              case "end":
                return _context114.stop();
            }
          }, _callee114, this);
        }));
      };
    }
  }]);
}();
var HeadlessB2BSessionClient = /*#__PURE__*/function () {
  function HeadlessB2BSessionClient(_networkClient, _subscriptionService) {
    var _this17 = this;
    _classCallCheck(this, HeadlessB2BSessionClient);
    this._networkClient = _networkClient;
    this._subscriptionService = _subscriptionService;
    this.getSync = function () {
      return _this17._subscriptionService.getSession();
    };
    this.getInfo = function () {
      return {
        session: _this17.getSync(),
        fromCache: _this17._subscriptionService.getFromCache()
      };
    };
    this.onChange = function (callback) {
      return _this17._subscriptionService.subscribeToState(function (state) {
        var _a;
        return callback((_a = state === null || state === void 0 ? void 0 : state.session) !== null && _a !== void 0 ? _a : null);
      });
    };
    this.revoke = function (options) {
      return __awaiter(_this17, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee115() {
        var resp;
        return _regeneratorRuntime().wrap(function _callee115$(_context115) {
          while (1) switch (_context115.prev = _context115.next) {
            case 0:
              _context115.prev = 0;
              _context115.next = 3;
              return this._networkClient.fetchSDK({
                url: "/b2b/sessions/revoke",
                method: 'POST'
              });
            case 3:
              resp = _context115.sent;
              this._subscriptionService.destroyState();
              return _context115.abrupt("return", resp);
            case 8:
              _context115.prev = 8;
              _context115.t0 = _context115["catch"](0);
              if (!!(options === null || options === void 0 ? void 0 : options.forceClear)) {
                this._subscriptionService.destroyState();
              } else if (ui.UNRECOVERABLE_ERROR_TYPES.includes(_context115.t0.error_type)) {
                this._subscriptionService.destroyState();
              }
              throw _context115.t0;
            case 12:
            case "end":
              return _context115.stop();
          }
        }, _callee115, this, [[0, 8]]);
      }));
    };
    this.revokeForMember = function (options) {
      return __awaiter(_this17, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee116() {
        return _regeneratorRuntime().wrap(function _callee116$(_context116) {
          while (1) switch (_context116.prev = _context116.next) {
            case 0:
              validate('stytch.session.revokeForMember').isString('member_id', options.member_id);
              _context116.next = 3;
              return this._networkClient.fetchSDK({
                url: "/b2b/sessions/revoke/".concat(options.member_id),
                method: 'POST'
              });
            case 3:
              return _context116.abrupt("return", _context116.sent);
            case 4:
            case "end":
              return _context116.stop();
          }
        }, _callee116, this);
      }));
    };
    this.authenticate = function (options) {
      return __awaiter(_this17, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee117() {
        var _this18 = this;
        var initialSession, isSessionStale, requestBody, resp;
        return _regeneratorRuntime().wrap(function _callee117$(_context117) {
          while (1) switch (_context117.prev = _context117.next) {
            case 0:
              initialSession = this._subscriptionService.getSession();
              isSessionStale = function isSessionStale() {
                var _a;
                return (initialSession === null || initialSession === void 0 ? void 0 : initialSession.member_session_id) !== ((_a = _this18._subscriptionService.getSession()) === null || _a === void 0 ? void 0 : _a.member_session_id);
              };
              _context117.prev = 2;
              requestBody = {
                session_duration_minutes: options === null || options === void 0 ? void 0 : options.session_duration_minutes
              };
              _context117.next = 6;
              return this._networkClient.fetchSDK({
                url: '/b2b/sessions/authenticate',
                body: requestBody,
                method: 'POST'
              });
            case 6:
              resp = _context117.sent;
              if (!isSessionStale()) {
                _context117.next = 9;
                break;
              }
              return _context117.abrupt("return", this.authenticate(options));
            case 9:
              this._subscriptionService.updateSession(resp);
              return _context117.abrupt("return", resp);
            case 13:
              _context117.prev = 13;
              _context117.t0 = _context117["catch"](2);
              if (!isSessionStale()) {
                _context117.next = 17;
                break;
              }
              return _context117.abrupt("return", this.authenticate(options));
            case 17:
              if (ui.UNRECOVERABLE_ERROR_TYPES.includes(_context117.t0.error_type)) {
                this._subscriptionService.destroySession();
              }
              throw _context117.t0;
            case 19:
            case "end":
              return _context117.stop();
          }
        }, _callee117, this, [[2, 13]]);
      }));
    };
    this.exchange = function (data) {
      return __awaiter(_this17, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee118() {
        var resp;
        return _regeneratorRuntime().wrap(function _callee118$(_context118) {
          while (1) switch (_context118.prev = _context118.next) {
            case 0:
              validate('stytch.session.exchange').isString('organization_id', data.organization_id).isNumber('session_duration_minutes', data.session_duration_minutes).isOptionalString('locale', data.locale);
              _context118.prev = 1;
              _context118.next = 4;
              return this._networkClient.fetchSDK({
                url: '/b2b/sessions/exchange',
                body: data,
                method: 'POST'
              });
            case 4:
              resp = _context118.sent;
              this._subscriptionService.updateSession(resp);
              return _context118.abrupt("return", resp);
            case 9:
              _context118.prev = 9;
              _context118.t0 = _context118["catch"](1);
              throw _context118.t0;
            case 12:
            case "end":
              return _context118.stop();
          }
        }, _callee118, this, [[1, 9]]);
      }));
    };
    this.exchangeAccessToken = function (data) {
      return __awaiter(_this17, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee119() {
        var resp;
        return _regeneratorRuntime().wrap(function _callee119$(_context119) {
          while (1) switch (_context119.prev = _context119.next) {
            case 0:
              validate('stytch.session.exchange').isString('organization_id', data.access_token).isNumber('session_duration_minutes', data.session_duration_minutes);
              _context119.next = 3;
              return this._networkClient.fetchSDK({
                url: '/b2b/sessions/exchange_access_token',
                body: data,
                method: 'POST'
              });
            case 3:
              resp = _context119.sent;
              this._subscriptionService.updateSession(resp);
              return _context119.abrupt("return", resp);
            case 6:
            case "end":
              return _context119.stop();
          }
        }, _callee119, this);
      }));
    };
  }
  return _createClass(HeadlessB2BSessionClient, [{
    key: "getTokens",
    value: function getTokens() {
      return this._subscriptionService.getTokens();
    }
  }, {
    key: "updateSession",
    value: function updateSession(tokens) {
      var _a;
      validate('stytch.session.updateSession').isString('session_token', tokens.session_token).isOptionalString('session_jwt', (_a = tokens.session_jwt) !== null && _a !== void 0 ? _a : undefined);
      this._subscriptionService.updateTokens(tokens);
    }
  }]);
}();
var HeadlessB2BDiscoveryClient = /*#__PURE__*/_createClass(function HeadlessB2BDiscoveryClient(_networkClient, _subscriptionService) {
  var _this19 = this;
  _classCallCheck(this, HeadlessB2BDiscoveryClient);
  this._networkClient = _networkClient;
  this._subscriptionService = _subscriptionService;
  this.organizations = {
    list: function list() {
      return __awaiter(_this19, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee120() {
        return _regeneratorRuntime().wrap(function _callee120$(_context120) {
          while (1) switch (_context120.prev = _context120.next) {
            case 0:
              _context120.t0 = this._networkClient;
              _context120.next = 3;
              return this._subscriptionService.getIntermediateSessionToken();
            case 3:
              _context120.t1 = _context120.sent;
              if (_context120.t1) {
                _context120.next = 6;
                break;
              }
              _context120.t1 = undefined;
            case 6:
              _context120.t2 = _context120.t1;
              _context120.t3 = {
                intermediate_session_token: _context120.t2
              };
              _context120.t4 = {
                url: '/b2b/discovery/organizations',
                body: _context120.t3,
                method: 'POST'
              };
              return _context120.abrupt("return", _context120.t0.fetchSDK.call(_context120.t0, _context120.t4));
            case 10:
            case "end":
              return _context120.stop();
          }
        }, _callee120, this);
      }));
    },
    create: function create(data) {
      return __awaiter(_this19, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee121() {
        var requestBody, resp;
        return _regeneratorRuntime().wrap(function _callee121$(_context121) {
          while (1) switch (_context121.prev = _context121.next) {
            case 0:
              validate('stytch.discovery.organizations.create').isNumber('session_duration_minutes', data.session_duration_minutes).isOptionalString('organization_name', data.organization_name).isOptionalString('organization_slug', data.organization_slug).isOptionalString('organization_logo_url', data.organization_logo_url).isOptionalString('sso_jit_provisioning', data.sso_jit_provisioning).isOptionalStringArray('email_allowed_domains', data.email_allowed_domains).isOptionalString('email_invites', data.email_invites).isOptionalString('auth_methods', data.auth_methods).isOptionalStringArray('allowed_auth_methods', data.allowed_auth_methods).isOptionalString('mfa_policy', data.mfa_policy);
              _context121.t0 = Object;
              _context121.t1 = Object.assign({}, data);
              _context121.next = 5;
              return this._subscriptionService.getIntermediateSessionToken();
            case 5:
              _context121.t2 = _context121.sent;
              if (_context121.t2) {
                _context121.next = 8;
                break;
              }
              _context121.t2 = undefined;
            case 8:
              _context121.t3 = _context121.t2;
              _context121.t4 = {
                intermediate_session_token: _context121.t3
              };
              requestBody = _context121.t0.assign.call(_context121.t0, _context121.t1, _context121.t4);
              _context121.next = 13;
              return this._networkClient.fetchSDK({
                url: '/b2b/discovery/organizations/create',
                body: requestBody,
                method: 'POST'
              });
            case 13:
              resp = _context121.sent;
              this._subscriptionService.updateSession(resp);
              return _context121.abrupt("return", resp);
            case 16:
            case "end":
              return _context121.stop();
          }
        }, _callee121, this);
      }));
    }
  };
  this.intermediateSessions = {
    exchange: function exchange(data) {
      return __awaiter(_this19, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee122() {
        var requestBody, resp;
        return _regeneratorRuntime().wrap(function _callee122$(_context122) {
          while (1) switch (_context122.prev = _context122.next) {
            case 0:
              validate('stytch.discovery.intermediateSessions.exchange').isString('organization_id', data.organization_id).isNumber('session_duration_minutes', data.session_duration_minutes).isOptionalString('locale', data.locale);
              _context122.t0 = Object;
              _context122.t1 = Object.assign({}, data);
              _context122.next = 5;
              return this._subscriptionService.getIntermediateSessionToken();
            case 5:
              _context122.t2 = _context122.sent;
              if (_context122.t2) {
                _context122.next = 8;
                break;
              }
              _context122.t2 = undefined;
            case 8:
              _context122.t3 = _context122.t2;
              _context122.t4 = {
                intermediate_session_token: _context122.t3
              };
              requestBody = _context122.t0.assign.call(_context122.t0, _context122.t1, _context122.t4);
              _context122.next = 13;
              return this._networkClient.fetchSDK({
                url: '/b2b/discovery/intermediate_sessions/exchange',
                body: requestBody,
                method: 'POST'
              });
            case 13:
              resp = _context122.sent;
              this._subscriptionService.updateSession(resp);
              return _context122.abrupt("return", resp);
            case 16:
            case "end":
              return _context122.stop();
          }
        }, _callee122, this);
      }));
    }
  };
});
var DefaultDynamicConfig = Promise.resolve({
  pkceRequiredForPasswordResets: false
});
var HeadlessB2BPasswordsClient = /*#__PURE__*/function () {
  function HeadlessB2BPasswordsClient(_networkClient, _subscriptionService, _pkceManager) {
    var _this20 = this;
    var _config = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : DefaultDynamicConfig;
    var dfpProtectedAuth = arguments.length > 4 ? arguments[4] : undefined;
    _classCallCheck(this, HeadlessB2BPasswordsClient);
    this._networkClient = _networkClient;
    this._subscriptionService = _subscriptionService;
    this._pkceManager = _pkceManager;
    this._config = _config;
    this.dfpProtectedAuth = dfpProtectedAuth;
    this.discovery = {
      resetByEmailStart: function resetByEmailStart(options) {
        return __awaiter(_this20, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee123() {
          var pkce_code_challenge, _yield$this$dfpProtec26, dfp_telemetry_id, captcha_token;
          return _regeneratorRuntime().wrap(function _callee123$(_context123) {
            while (1) switch (_context123.prev = _context123.next) {
              case 0:
                validate('stytch.passwords.discovery.resetByEmailStart').isString('email', options.email_address).isOptionalString('login_redirect_url', options.discovery_redirect_url).isOptionalString('reset_password_redirect_url', options.reset_password_redirect_url).isOptionalString('reset_password_template_id', options.reset_password_template_id).isOptionalNumber('reset_password_expiration_minutes', options.reset_password_expiration_minutes).isOptionalString('verify_email_template_id', options.verify_email_template_id);
                _context123.next = 3;
                return this.getCodeChallenge();
              case 3:
                pkce_code_challenge = _context123.sent;
                _context123.next = 6;
                return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
              case 6:
                _yield$this$dfpProtec26 = _context123.sent;
                dfp_telemetry_id = _yield$this$dfpProtec26.dfp_telemetry_id;
                captcha_token = _yield$this$dfpProtec26.captcha_token;
                return _context123.abrupt("return", this._networkClient.retriableFetchSDK({
                  url: '/b2b/passwords/discovery/reset/start',
                  method: 'POST',
                  body: {
                    email_address: options.email_address,
                    discovery_redirect_url: options.discovery_redirect_url,
                    reset_password_redirect_url: options.reset_password_redirect_url,
                    reset_password_expiration_minutes: options.reset_password_expiration_minutes,
                    reset_password_template_id: options.reset_password_template_id,
                    verify_email_template_id: options.verify_email_template_id,
                    pkce_code_challenge: pkce_code_challenge,
                    captcha_token: captcha_token,
                    dfp_telemetry_id: dfp_telemetry_id
                  },
                  retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
                }));
              case 10:
              case "end":
                return _context123.stop();
            }
          }, _callee123, this);
        }));
      },
      resetByEmail: function resetByEmail(options) {
        return __awaiter(_this20, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee124() {
          var _yield$this$dfpProtec27, dfp_telemetry_id, captcha_token, pkPair, pkce_code_verifier, resp;
          return _regeneratorRuntime().wrap(function _callee124$(_context124) {
            while (1) switch (_context124.prev = _context124.next) {
              case 0:
                validate('stytch.passwords.discovery.resetByEmail').isString('password_reset_token', options.password_reset_token).isString('password', options.password);
                _context124.next = 3;
                return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
              case 3:
                _yield$this$dfpProtec27 = _context124.sent;
                dfp_telemetry_id = _yield$this$dfpProtec27.dfp_telemetry_id;
                captcha_token = _yield$this$dfpProtec27.captcha_token;
                _context124.next = 8;
                return this._pkceManager.getPKPair();
              case 8:
                pkPair = _context124.sent;
                pkce_code_verifier = pkPair === null || pkPair === void 0 ? void 0 : pkPair.code_verifier;
                _context124.t0 = this._networkClient;
                _context124.t1 = options.password_reset_token;
                _context124.t2 = options.password;
                _context124.t3 = captcha_token;
                _context124.t4 = dfp_telemetry_id;
                _context124.t5 = pkce_code_verifier;
                _context124.next = 18;
                return this._subscriptionService.getIntermediateSessionToken();
              case 18:
                _context124.t6 = _context124.sent;
                if (_context124.t6) {
                  _context124.next = 21;
                  break;
                }
                _context124.t6 = undefined;
              case 21:
                _context124.t7 = _context124.t6;
                _context124.t8 = {
                  password_reset_token: _context124.t1,
                  password: _context124.t2,
                  captcha_token: _context124.t3,
                  dfp_telemetry_id: _context124.t4,
                  pkce_code_verifier: _context124.t5,
                  intermediate_session_token: _context124.t7
                };
                _context124.t9 = this.dfpProtectedAuth.retryWithCaptchaAndDFP;
                _context124.t10 = {
                  url: '/b2b/passwords/discovery/reset',
                  method: 'POST',
                  body: _context124.t8,
                  retryCallback: _context124.t9
                };
                _context124.next = 27;
                return _context124.t0.retriableFetchSDK.call(_context124.t0, _context124.t10);
              case 27:
                resp = _context124.sent;
                this._pkceManager.clearPKPair();
                this._subscriptionService.updateSession(resp);
                return _context124.abrupt("return", resp);
              case 31:
              case "end":
                return _context124.stop();
            }
          }, _callee124, this);
        }));
      },
      authenticate: function authenticate(options) {
        return __awaiter(_this20, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee125() {
          var pkPair, code_verifier, _yield$this$dfpProtec28, dfp_telemetry_id, captcha_token, resp;
          return _regeneratorRuntime().wrap(function _callee125$(_context125) {
            while (1) switch (_context125.prev = _context125.next) {
              case 0:
                validate('stytch.passwords.discovery.authenticate').isString('password', options.password).isString('email_address', options.email_address);
                _context125.next = 3;
                return this._pkceManager.getPKPair();
              case 3:
                pkPair = _context125.sent;
                code_verifier = pkPair === null || pkPair === void 0 ? void 0 : pkPair.code_verifier;
                _context125.next = 7;
                return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
              case 7:
                _yield$this$dfpProtec28 = _context125.sent;
                dfp_telemetry_id = _yield$this$dfpProtec28.dfp_telemetry_id;
                captcha_token = _yield$this$dfpProtec28.captcha_token;
                _context125.next = 12;
                return this._networkClient.retriableFetchSDK({
                  url: '/b2b/passwords/discovery/authenticate',
                  method: 'POST',
                  body: {
                    email_address: options.email_address,
                    password: options.password,
                    captcha_token: captcha_token,
                    dfp_telemetry_id: dfp_telemetry_id,
                    code_verifier: code_verifier
                  },
                  retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
                });
              case 12:
                resp = _context125.sent;
                this._subscriptionService.updateSession(resp);
                return _context125.abrupt("return", resp);
              case 15:
              case "end":
                return _context125.stop();
            }
          }, _callee125, this);
        }));
      }
    };
  }
  return _createClass(HeadlessB2BPasswordsClient, [{
    key: "getCodeChallenge",
    value: function getCodeChallenge() {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee126() {
        var _yield$this$_config9, pkceRequiredForPasswordResets, keyPair;
        return _regeneratorRuntime().wrap(function _callee126$(_context126) {
          while (1) switch (_context126.prev = _context126.next) {
            case 0:
              _context126.next = 2;
              return this._config;
            case 2:
              _yield$this$_config9 = _context126.sent;
              pkceRequiredForPasswordResets = _yield$this$_config9.pkceRequiredForPasswordResets;
              if (pkceRequiredForPasswordResets) {
                _context126.next = 6;
                break;
              }
              return _context126.abrupt("return", undefined);
            case 6:
              _context126.next = 8;
              return this._pkceManager.getPKPair();
            case 8:
              keyPair = _context126.sent;
              if (!keyPair) {
                _context126.next = 11;
                break;
              }
              return _context126.abrupt("return", keyPair.code_challenge);
            case 11:
              _context126.next = 13;
              return this._pkceManager.startPKCETransaction();
            case 13:
              keyPair = _context126.sent;
              return _context126.abrupt("return", keyPair.code_challenge);
            case 15:
            case "end":
              return _context126.stop();
          }
        }, _callee126, this);
      }));
    }
  }, {
    key: "authenticate",
    value: function authenticate(options) {
      var _a, _b;
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee127() {
        var pkPair, _yield$this$_config10, pkceRequiredForPasswordResets, code_verifier, _yield$this$dfpProtec29, dfp_telemetry_id, captcha_token, resp;
        return _regeneratorRuntime().wrap(function _callee127$(_context127) {
          while (1) switch (_context127.prev = _context127.next) {
            case 0:
              validate('stytch.passwords.authenticate').isString('org_id', options.organization_id).isString('password', options.password).isString('email_address', options.email_address).isNumber('session_duration_minutes', options.session_duration_minutes).isOptionalString('locale', options.locale);
              _context127.next = 3;
              return this._pkceManager.getPKPair();
            case 3:
              pkPair = _context127.sent;
              _context127.next = 6;
              return this._config;
            case 6:
              _yield$this$_config10 = _context127.sent;
              pkceRequiredForPasswordResets = _yield$this$_config10.pkceRequiredForPasswordResets;
              if (!(pkceRequiredForPasswordResets && (!pkPair || !(pkPair === null || pkPair === void 0 ? void 0 : pkPair.code_verifier) || ((_b = (_a = pkPair === null || pkPair === void 0 ? void 0 : pkPair.code_verifier) === null || _a === void 0 ? void 0 : _a.trim()) === null || _b === void 0 ? void 0 : _b.length) === 0))) {
                _context127.next = 10;
                break;
              }
              throw new ui.MissingPKCEError();
            case 10:
              code_verifier = pkPair === null || pkPair === void 0 ? void 0 : pkPair.code_verifier;
              _context127.next = 13;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 13:
              _yield$this$dfpProtec29 = _context127.sent;
              dfp_telemetry_id = _yield$this$dfpProtec29.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec29.captcha_token;
              _context127.t0 = this._networkClient;
              _context127.t1 = options.organization_id;
              _context127.t2 = options.email_address;
              _context127.t3 = options.password;
              _context127.t4 = options.session_duration_minutes;
              _context127.t5 = options.locale;
              _context127.t6 = captcha_token;
              _context127.t7 = dfp_telemetry_id;
              _context127.t8 = code_verifier;
              _context127.next = 27;
              return this._subscriptionService.getIntermediateSessionToken();
            case 27:
              _context127.t9 = _context127.sent;
              if (_context127.t9) {
                _context127.next = 30;
                break;
              }
              _context127.t9 = undefined;
            case 30:
              _context127.t10 = _context127.t9;
              _context127.t11 = {
                organization_id: _context127.t1,
                email_address: _context127.t2,
                password: _context127.t3,
                session_duration_minutes: _context127.t4,
                locale: _context127.t5,
                captcha_token: _context127.t6,
                dfp_telemetry_id: _context127.t7,
                code_verifier: _context127.t8,
                intermediate_session_token: _context127.t10
              };
              _context127.t12 = this.dfpProtectedAuth.retryWithCaptchaAndDFP;
              _context127.t13 = {
                url: '/b2b/passwords/authenticate',
                method: 'POST',
                body: _context127.t11,
                retryCallback: _context127.t12
              };
              _context127.next = 36;
              return _context127.t0.retriableFetchSDK.call(_context127.t0, _context127.t13);
            case 36:
              resp = _context127.sent;
              this._subscriptionService.updateSession(resp);
              return _context127.abrupt("return", resp);
            case 39:
            case "end":
              return _context127.stop();
          }
        }, _callee127, this);
      }));
    }
  }, {
    key: "resetByEmailStart",
    value: function resetByEmailStart(options) {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee128() {
        var code_challenge, _yield$this$dfpProtec30, dfp_telemetry_id, captcha_token;
        return _regeneratorRuntime().wrap(function _callee128$(_context128) {
          while (1) switch (_context128.prev = _context128.next) {
            case 0:
              validate('stytch.passwords.resetByEmailStart').isString('email', options.email_address).isOptionalString('login_redirect_url', options.login_redirect_url).isOptionalString('reset_password_redirect_url', options.reset_password_redirect_url).isOptionalString('reset_password_template_id', options.reset_password_template_id).isOptionalNumber('reset_password_expiration_minutes', options.reset_password_expiration_minutes).isOptionalString('verify_email_template_id', options.verify_email_template_id);
              _context128.next = 3;
              return this.getCodeChallenge();
            case 3:
              code_challenge = _context128.sent;
              _context128.next = 6;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 6:
              _yield$this$dfpProtec30 = _context128.sent;
              dfp_telemetry_id = _yield$this$dfpProtec30.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec30.captcha_token;
              return _context128.abrupt("return", this._networkClient.retriableFetchSDK({
                url: '/b2b/passwords/email/reset/start',
                method: 'POST',
                body: {
                  organization_id: options.organization_id,
                  email_address: options.email_address,
                  login_redirect_url: options.login_redirect_url,
                  reset_password_redirect_url: options.reset_password_redirect_url,
                  reset_password_expiration_minutes: options.reset_password_expiration_minutes,
                  reset_password_template_id: options.reset_password_template_id,
                  verify_email_template_id: options.verify_email_template_id,
                  code_challenge: code_challenge,
                  captcha_token: captcha_token,
                  dfp_telemetry_id: dfp_telemetry_id
                },
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              }));
            case 10:
            case "end":
              return _context128.stop();
          }
        }, _callee128, this);
      }));
    }
  }, {
    key: "resetByEmail",
    value: function resetByEmail(options) {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee129() {
        var _yield$this$dfpProtec31, dfp_telemetry_id, captcha_token, pkPair, code_verifier, resp;
        return _regeneratorRuntime().wrap(function _callee129$(_context129) {
          while (1) switch (_context129.prev = _context129.next) {
            case 0:
              validate('stytch.passwords.resetByEmail').isString('password_reset_token', options.password_reset_token).isString('password', options.password).isNumber('session_duration_minutes', options.session_duration_minutes).isOptionalString('locale', options.locale);
              _context129.next = 3;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 3:
              _yield$this$dfpProtec31 = _context129.sent;
              dfp_telemetry_id = _yield$this$dfpProtec31.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec31.captcha_token;
              _context129.next = 8;
              return this._pkceManager.getPKPair();
            case 8:
              pkPair = _context129.sent;
              code_verifier = pkPair === null || pkPair === void 0 ? void 0 : pkPair.code_verifier;
              _context129.t0 = this._networkClient;
              _context129.t1 = options.password_reset_token;
              _context129.t2 = options.password;
              _context129.t3 = options.session_duration_minutes;
              _context129.t4 = options.locale;
              _context129.t5 = captcha_token;
              _context129.t6 = dfp_telemetry_id;
              _context129.t7 = code_verifier;
              _context129.next = 20;
              return this._subscriptionService.getIntermediateSessionToken();
            case 20:
              _context129.t8 = _context129.sent;
              if (_context129.t8) {
                _context129.next = 23;
                break;
              }
              _context129.t8 = undefined;
            case 23:
              _context129.t9 = _context129.t8;
              _context129.t10 = {
                password_reset_token: _context129.t1,
                password: _context129.t2,
                session_duration_minutes: _context129.t3,
                locale: _context129.t4,
                captcha_token: _context129.t5,
                dfp_telemetry_id: _context129.t6,
                code_verifier: _context129.t7,
                intermediate_session_token: _context129.t9
              };
              _context129.t11 = this.dfpProtectedAuth.retryWithCaptchaAndDFP;
              _context129.t12 = {
                url: '/b2b/passwords/email/reset',
                method: 'POST',
                body: _context129.t10,
                retryCallback: _context129.t11
              };
              _context129.next = 29;
              return _context129.t0.retriableFetchSDK.call(_context129.t0, _context129.t12);
            case 29:
              resp = _context129.sent;
              this._pkceManager.clearPKPair();
              this._subscriptionService.updateSession(resp);
              return _context129.abrupt("return", resp);
            case 33:
            case "end":
              return _context129.stop();
          }
        }, _callee129, this);
      }));
    }
  }, {
    key: "resetByExistingPassword",
    value: function resetByExistingPassword(options) {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee130() {
        var _yield$this$dfpProtec32, dfp_telemetry_id, captcha_token, resp;
        return _regeneratorRuntime().wrap(function _callee130$(_context130) {
          while (1) switch (_context130.prev = _context130.next) {
            case 0:
              validate('stytch.passwords.resetByExistingPassword').isString('email', options.email_address).isString('existing_password', options.existing_password).isString('new_password', options.new_password).isOptionalString('locale', options.locale);
              _context130.next = 3;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 3:
              _yield$this$dfpProtec32 = _context130.sent;
              dfp_telemetry_id = _yield$this$dfpProtec32.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec32.captcha_token;
              _context130.next = 8;
              return this._networkClient.retriableFetchSDK({
                url: '/b2b/passwords/existing_password/reset',
                method: 'POST',
                body: {
                  organization_id: options.organization_id,
                  email_address: options.email_address,
                  existing_password: options.existing_password,
                  new_password: options.new_password,
                  locale: options.locale,
                  session_duration_minutes: options.session_duration_minutes,
                  captcha_token: captcha_token,
                  dfp_telemetry_id: dfp_telemetry_id
                },
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              });
            case 8:
              resp = _context130.sent;
              this._subscriptionService.updateSession(resp);
              return _context130.abrupt("return", resp);
            case 11:
            case "end":
              return _context130.stop();
          }
        }, _callee130, this);
      }));
    }
  }, {
    key: "resetBySession",
    value: function resetBySession(options) {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee131() {
        var _yield$this$dfpProtec33, dfp_telemetry_id, captcha_token, resp;
        return _regeneratorRuntime().wrap(function _callee131$(_context131) {
          while (1) switch (_context131.prev = _context131.next) {
            case 0:
              validate('stytch.passwords.resetBySession').isString('password', options.password);
              _context131.next = 3;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 3:
              _yield$this$dfpProtec33 = _context131.sent;
              dfp_telemetry_id = _yield$this$dfpProtec33.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec33.captcha_token;
              _context131.next = 8;
              return this._networkClient.retriableFetchSDK({
                url: '/b2b/passwords/session/reset',
                method: 'POST',
                body: {
                  password: options.password,
                  captcha_token: captcha_token,
                  dfp_telemetry_id: dfp_telemetry_id
                },
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              });
            case 8:
              resp = _context131.sent;
              this._subscriptionService.updateSession(resp);
              return _context131.abrupt("return", resp);
            case 11:
            case "end":
              return _context131.stop();
          }
        }, _callee131, this);
      }));
    }
  }, {
    key: "strengthCheck",
    value: function strengthCheck(options) {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee132() {
        return _regeneratorRuntime().wrap(function _callee132$(_context132) {
          while (1) switch (_context132.prev = _context132.next) {
            case 0:
              validate('stytch.passwords.strengthCheck').isOptionalString('email', options.email_address).isString('password', options.password);
              return _context132.abrupt("return", this._networkClient.fetchSDK({
                url: '/b2b/passwords/strength_check',
                method: 'POST',
                body: {
                  email_address: options.email_address,
                  password: options.password
                }
              }));
            case 2:
            case "end":
              return _context132.stop();
          }
        }, _callee132, this);
      }));
    }
  }]);
}();
var HeadlessB2BOTPsClient = /*#__PURE__*/_createClass(function HeadlessB2BOTPsClient(_networkClient, _subscriptionService, dfpProtectedAuth) {
  var _this21 = this;
  _classCallCheck(this, HeadlessB2BOTPsClient);
  this._networkClient = _networkClient;
  this._subscriptionService = _subscriptionService;
  this.dfpProtectedAuth = dfpProtectedAuth;
  this.sms = {
    send: function send(data) {
      return __awaiter(_this21, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee133() {
        var _yield$this$dfpProtec34, dfp_telemetry_id, captcha_token;
        return _regeneratorRuntime().wrap(function _callee133$(_context133) {
          while (1) switch (_context133.prev = _context133.next) {
            case 0:
              validate('stytch.otps.sms.send').isString('organization_id', data.organization_id).isString('member_id', data.member_id).isOptionalString('mfa_phone_number', data.mfa_phone_number).isOptionalString('locale', data.locale);
              _context133.next = 3;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 3:
              _yield$this$dfpProtec34 = _context133.sent;
              dfp_telemetry_id = _yield$this$dfpProtec34.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec34.captcha_token;
              _context133.t0 = this._networkClient;
              _context133.t1 = Object;
              _context133.t2 = Object.assign({}, data);
              _context133.t3 = dfp_telemetry_id;
              _context133.t4 = captcha_token;
              _context133.next = 13;
              return this._subscriptionService.getIntermediateSessionToken();
            case 13:
              _context133.t5 = _context133.sent;
              if (_context133.t5) {
                _context133.next = 16;
                break;
              }
              _context133.t5 = undefined;
            case 16:
              _context133.t6 = _context133.t5;
              _context133.t7 = {
                dfp_telemetry_id: _context133.t3,
                captcha_token: _context133.t4,
                intermediate_session_token: _context133.t6
              };
              _context133.t8 = _context133.t1.assign.call(_context133.t1, _context133.t2, _context133.t7);
              _context133.t9 = this.dfpProtectedAuth.retryWithCaptchaAndDFP;
              _context133.t10 = {
                url: '/b2b/otps/sms/send',
                body: _context133.t8,
                method: 'POST',
                retryCallback: _context133.t9
              };
              return _context133.abrupt("return", _context133.t0.retriableFetchSDK.call(_context133.t0, _context133.t10));
            case 22:
            case "end":
              return _context133.stop();
          }
        }, _callee133, this);
      }));
    },
    authenticate: function authenticate(data) {
      return __awaiter(_this21, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee134() {
        var _yield$this$dfpProtec35, dfp_telemetry_id, captcha_token, requestBody, resp;
        return _regeneratorRuntime().wrap(function _callee134$(_context134) {
          while (1) switch (_context134.prev = _context134.next) {
            case 0:
              validate('stytch.otps.sms.authenticate').isString('organization_id', data.organization_id).isString('member_id', data.member_id).isString('code', data.code).isOptionalString('set_mfa_enrollment', data.set_mfa_enrollment);
              _context134.next = 3;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 3:
              _yield$this$dfpProtec35 = _context134.sent;
              dfp_telemetry_id = _yield$this$dfpProtec35.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec35.captcha_token;
              _context134.t0 = Object;
              _context134.t1 = Object.assign({}, data);
              _context134.t2 = dfp_telemetry_id;
              _context134.t3 = captcha_token;
              _context134.next = 12;
              return this._subscriptionService.getIntermediateSessionToken();
            case 12:
              _context134.t4 = _context134.sent;
              if (_context134.t4) {
                _context134.next = 15;
                break;
              }
              _context134.t4 = undefined;
            case 15:
              _context134.t5 = _context134.t4;
              _context134.t6 = {
                dfp_telemetry_id: _context134.t2,
                captcha_token: _context134.t3,
                intermediate_session_token: _context134.t5
              };
              requestBody = _context134.t0.assign.call(_context134.t0, _context134.t1, _context134.t6);
              _context134.next = 20;
              return this._networkClient.retriableFetchSDK({
                url: '/b2b/otps/sms/authenticate',
                body: requestBody,
                method: 'POST',
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              });
            case 20:
              resp = _context134.sent;
              this._subscriptionService.updateSession(resp);
              return _context134.abrupt("return", resp);
            case 23:
            case "end":
              return _context134.stop();
          }
        }, _callee134, this);
      }));
    }
  };
  this.email = {
    loginOrSignup: function loginOrSignup(data) {
      return __awaiter(_this21, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee135() {
        var _yield$this$dfpProtec36, dfp_telemetry_id, captcha_token;
        return _regeneratorRuntime().wrap(function _callee135$(_context135) {
          while (1) switch (_context135.prev = _context135.next) {
            case 0:
              validate('stytch.otps.email.loginOrSignup').isString('organization_id', data.organization_id).isString('email_address', data.email_address).isOptionalString('login_template_id', data.login_template_id).isOptionalString('signup_template_id', data.signup_template_id).isOptionalString('locale', data.locale).isOptionalNumber('login_expiration_minutes', data.login_expiration_minutes).isOptionalNumber('signup_expiration_minutes', data.signup_expiration_minutes);
              _context135.next = 3;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 3:
              _yield$this$dfpProtec36 = _context135.sent;
              dfp_telemetry_id = _yield$this$dfpProtec36.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec36.captcha_token;
              return _context135.abrupt("return", this._networkClient.retriableFetchSDK({
                url: '/b2b/otps/email/login_or_signup',
                body: Object.assign(Object.assign({}, data), {
                  dfp_telemetry_id: dfp_telemetry_id,
                  captcha_token: captcha_token
                }),
                method: 'POST',
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              }));
            case 7:
            case "end":
              return _context135.stop();
          }
        }, _callee135, this);
      }));
    },
    authenticate: function authenticate(data) {
      return __awaiter(_this21, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee136() {
        var _yield$this$dfpProtec37, dfp_telemetry_id, captcha_token, resp;
        return _regeneratorRuntime().wrap(function _callee136$(_context136) {
          while (1) switch (_context136.prev = _context136.next) {
            case 0:
              validate('stytch.otps.email.authenticate').isString('code', data.code).isString('email_address', data.email_address).isString('organization_id', data.organization_id).isNumber('session_duration_minutes', data.session_duration_minutes).isOptionalString('locale', data.locale);
              _context136.next = 3;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 3:
              _yield$this$dfpProtec37 = _context136.sent;
              dfp_telemetry_id = _yield$this$dfpProtec37.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec37.captcha_token;
              _context136.t0 = this._networkClient;
              _context136.t1 = Object;
              _context136.t2 = Object.assign({}, data);
              _context136.next = 11;
              return this._subscriptionService.getIntermediateSessionToken();
            case 11:
              _context136.t3 = _context136.sent;
              if (_context136.t3) {
                _context136.next = 14;
                break;
              }
              _context136.t3 = undefined;
            case 14:
              _context136.t4 = _context136.t3;
              _context136.t5 = dfp_telemetry_id;
              _context136.t6 = captcha_token;
              _context136.t7 = {
                intermediate_session_token: _context136.t4,
                dfp_telemetry_id: _context136.t5,
                captcha_token: _context136.t6
              };
              _context136.t8 = _context136.t1.assign.call(_context136.t1, _context136.t2, _context136.t7);
              _context136.t9 = this.dfpProtectedAuth.retryWithCaptchaAndDFP;
              _context136.t10 = {
                url: '/b2b/otps/email/authenticate',
                body: _context136.t8,
                method: 'POST',
                retryCallback: _context136.t9
              };
              _context136.next = 23;
              return _context136.t0.retriableFetchSDK.call(_context136.t0, _context136.t10);
            case 23:
              resp = _context136.sent;
              this._subscriptionService.updateSession(resp);
              return _context136.abrupt("return", resp);
            case 26:
            case "end":
              return _context136.stop();
          }
        }, _callee136, this);
      }));
    },
    discovery: {
      send: function send(data) {
        return __awaiter(_this21, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee137() {
          var _yield$this$dfpProtec38, dfp_telemetry_id, captcha_token, requestBody;
          return _regeneratorRuntime().wrap(function _callee137$(_context137) {
            while (1) switch (_context137.prev = _context137.next) {
              case 0:
                validate('stytch.otps.email.discovery.send').isString('email_address', data.email_address).isOptionalString('login_template_id', data.login_template_id).isOptionalString('locale', data.locale).isOptionalNumber('discovery_expiration_minutes', data.discovery_expiration_minutes);
                _context137.next = 3;
                return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
              case 3:
                _yield$this$dfpProtec38 = _context137.sent;
                dfp_telemetry_id = _yield$this$dfpProtec38.dfp_telemetry_id;
                captcha_token = _yield$this$dfpProtec38.captcha_token;
                requestBody = Object.assign(Object.assign({}, data), {
                  dfp_telemetry_id: dfp_telemetry_id,
                  captcha_token: captcha_token
                });
                return _context137.abrupt("return", this._networkClient.retriableFetchSDK({
                  url: '/b2b/otps/email/discovery/send',
                  body: requestBody,
                  method: 'POST',
                  retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
                }));
              case 8:
              case "end":
                return _context137.stop();
            }
          }, _callee137, this);
        }));
      },
      authenticate: function authenticate(data) {
        return __awaiter(_this21, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee138() {
          var _yield$this$dfpProtec39, dfp_telemetry_id, captcha_token, requestBody, resp;
          return _regeneratorRuntime().wrap(function _callee138$(_context138) {
            while (1) switch (_context138.prev = _context138.next) {
              case 0:
                validate('stytch.otps.email.discovery.authenticate').isString('code', data.code).isString('email_address', data.email_address);
                _context138.next = 3;
                return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
              case 3:
                _yield$this$dfpProtec39 = _context138.sent;
                dfp_telemetry_id = _yield$this$dfpProtec39.dfp_telemetry_id;
                captcha_token = _yield$this$dfpProtec39.captcha_token;
                requestBody = Object.assign({
                  dfp_telemetry_id: dfp_telemetry_id,
                  captcha_token: captcha_token
                }, data);
                _context138.next = 9;
                return this._networkClient.retriableFetchSDK({
                  url: '/b2b/otps/email/discovery/authenticate',
                  body: requestBody,
                  method: 'POST',
                  retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
                });
              case 9:
                resp = _context138.sent;
                this._subscriptionService.updateSession(resp);
                return _context138.abrupt("return", resp);
              case 12:
              case "end":
                return _context138.stop();
            }
          }, _callee138, this);
        }));
      }
    }
  };
});
var HeadlessB2BTOTPsClient = /*#__PURE__*/function () {
  function HeadlessB2BTOTPsClient(_networkClient, _subscriptionService, dfpProtectedAuth) {
    _classCallCheck(this, HeadlessB2BTOTPsClient);
    this._networkClient = _networkClient;
    this._subscriptionService = _subscriptionService;
    this.dfpProtectedAuth = dfpProtectedAuth;
  }
  return _createClass(HeadlessB2BTOTPsClient, [{
    key: "create",
    value: function create(data) {
      var _a;
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee139() {
        var _yield$this$dfpProtec40, dfp_telemetry_id, captcha_token, response;
        return _regeneratorRuntime().wrap(function _callee139$(_context139) {
          while (1) switch (_context139.prev = _context139.next) {
            case 0:
              validate('stytch.totp.create').isString('organization_id', data.organization_id).isString('member_id', data.member_id).isOptionalNumber('expiration_minutes', data.expiration_minutes);
              _context139.next = 3;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 3:
              _yield$this$dfpProtec40 = _context139.sent;
              dfp_telemetry_id = _yield$this$dfpProtec40.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec40.captcha_token;
              _context139.t0 = this._networkClient;
              _context139.t1 = Object;
              _context139.t2 = Object.assign({}, data);
              _context139.t3 = dfp_telemetry_id;
              _context139.t4 = captcha_token;
              _context139.next = 13;
              return this._subscriptionService.getIntermediateSessionToken();
            case 13:
              _context139.t5 = _context139.sent;
              if (_context139.t5) {
                _context139.next = 16;
                break;
              }
              _context139.t5 = undefined;
            case 16:
              _context139.t6 = _context139.t5;
              _context139.t7 = {
                dfp_telemetry_id: _context139.t3,
                captcha_token: _context139.t4,
                intermediate_session_token: _context139.t6
              };
              _context139.t8 = _context139.t1.assign.call(_context139.t1, _context139.t2, _context139.t7);
              _context139.t9 = this.dfpProtectedAuth.retryWithCaptchaAndDFP;
              _context139.t10 = {
                url: '/b2b/totp',
                body: _context139.t8,
                method: 'POST',
                retryCallback: _context139.t9
              };
              _context139.next = 23;
              return _context139.t0.retriableFetchSDK.call(_context139.t0, _context139.t10);
            case 23:
              response = _context139.sent;
              if (response.member_id === ((_a = this._subscriptionService.getMember()) === null || _a === void 0 ? void 0 : _a.member_id)) {
                this._subscriptionService.updateMember(response.member);
              }
              return _context139.abrupt("return", response);
            case 26:
            case "end":
              return _context139.stop();
          }
        }, _callee139, this);
      }));
    }
  }, {
    key: "authenticate",
    value: function authenticate(data) {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee140() {
        var _yield$this$dfpProtec41, dfp_telemetry_id, captcha_token, requestBody, resp;
        return _regeneratorRuntime().wrap(function _callee140$(_context140) {
          while (1) switch (_context140.prev = _context140.next) {
            case 0:
              validate('stytch.totp.authenticate').isString('organization_id', data.organization_id).isString('member_id', data.member_id).isString('code', data.code).isOptionalString('set_mfa_enrollment', data.set_mfa_enrollment).isOptionalBoolean('set_default_mfa', data.set_default_mfa);
              _context140.next = 3;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 3:
              _yield$this$dfpProtec41 = _context140.sent;
              dfp_telemetry_id = _yield$this$dfpProtec41.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec41.captcha_token;
              _context140.t0 = Object;
              _context140.t1 = Object.assign({}, data);
              _context140.t2 = dfp_telemetry_id;
              _context140.t3 = captcha_token;
              _context140.next = 12;
              return this._subscriptionService.getIntermediateSessionToken();
            case 12:
              _context140.t4 = _context140.sent;
              if (_context140.t4) {
                _context140.next = 15;
                break;
              }
              _context140.t4 = undefined;
            case 15:
              _context140.t5 = _context140.t4;
              _context140.t6 = {
                dfp_telemetry_id: _context140.t2,
                captcha_token: _context140.t3,
                intermediate_session_token: _context140.t5
              };
              requestBody = _context140.t0.assign.call(_context140.t0, _context140.t1, _context140.t6);
              _context140.next = 20;
              return this._networkClient.retriableFetchSDK({
                url: '/b2b/totp/authenticate',
                body: requestBody,
                method: 'POST',
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              });
            case 20:
              resp = _context140.sent;
              this._subscriptionService.updateSession(resp);
              return _context140.abrupt("return", resp);
            case 23:
            case "end":
              return _context140.stop();
          }
        }, _callee140, this);
      }));
    }
  }]);
}();
var HeadlessB2BRecoveryCodesClient = /*#__PURE__*/function () {
  function HeadlessB2BRecoveryCodesClient(_networkClient, _subscriptionService, dfpProtectedAuth) {
    _classCallCheck(this, HeadlessB2BRecoveryCodesClient);
    this._networkClient = _networkClient;
    this._subscriptionService = _subscriptionService;
    this.dfpProtectedAuth = dfpProtectedAuth;
  }
  return _createClass(HeadlessB2BRecoveryCodesClient, [{
    key: "recover",
    value: function recover(data) {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee141() {
        var _yield$this$dfpProtec42, dfp_telemetry_id, captcha_token, requestBody, resp;
        return _regeneratorRuntime().wrap(function _callee141$(_context141) {
          while (1) switch (_context141.prev = _context141.next) {
            case 0:
              validate('stytch.recoveryCodes.recover').isString('organization_id', data.organization_id).isString('member_id', data.member_id).isString('recovery_code', data.recovery_code);
              _context141.next = 3;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 3:
              _yield$this$dfpProtec42 = _context141.sent;
              dfp_telemetry_id = _yield$this$dfpProtec42.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec42.captcha_token;
              _context141.t0 = Object;
              _context141.t1 = Object.assign({}, data);
              _context141.t2 = dfp_telemetry_id;
              _context141.t3 = captcha_token;
              _context141.next = 12;
              return this._subscriptionService.getIntermediateSessionToken();
            case 12:
              _context141.t4 = _context141.sent;
              if (_context141.t4) {
                _context141.next = 15;
                break;
              }
              _context141.t4 = undefined;
            case 15:
              _context141.t5 = _context141.t4;
              _context141.t6 = {
                dfp_telemetry_id: _context141.t2,
                captcha_token: _context141.t3,
                intermediate_session_token: _context141.t5
              };
              requestBody = _context141.t0.assign.call(_context141.t0, _context141.t1, _context141.t6);
              _context141.next = 20;
              return this._networkClient.retriableFetchSDK({
                url: '/b2b/recovery_codes/recover',
                body: requestBody,
                method: 'POST',
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              });
            case 20:
              resp = _context141.sent;
              this._subscriptionService.updateSession(resp);
              return _context141.abrupt("return", resp);
            case 23:
            case "end":
              return _context141.stop();
          }
        }, _callee141, this);
      }));
    }
  }, {
    key: "rotate",
    value: function rotate() {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee142() {
        var _yield$this$dfpProtec43, dfp_telemetry_id, captcha_token;
        return _regeneratorRuntime().wrap(function _callee142$(_context142) {
          while (1) switch (_context142.prev = _context142.next) {
            case 0:
              _context142.next = 2;
              return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
            case 2:
              _yield$this$dfpProtec43 = _context142.sent;
              dfp_telemetry_id = _yield$this$dfpProtec43.dfp_telemetry_id;
              captcha_token = _yield$this$dfpProtec43.captcha_token;
              return _context142.abrupt("return", this._networkClient.retriableFetchSDK({
                url: '/b2b/recovery_codes/rotate',
                body: {
                  dfp_telemetry_id: dfp_telemetry_id,
                  captcha_token: captcha_token
                },
                method: 'POST',
                retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
              }));
            case 6:
            case "end":
              return _context142.stop();
          }
        }, _callee142, this);
      }));
    }
  }, {
    key: "get",
    value: function get() {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee143() {
        return _regeneratorRuntime().wrap(function _callee143$(_context143) {
          while (1) switch (_context143.prev = _context143.next) {
            case 0:
              return _context143.abrupt("return", this._networkClient.fetchSDK({
                url: '/b2b/recovery_codes',
                method: 'GET'
              }));
            case 1:
            case "end":
              return _context143.stop();
          }
        }, _callee143, this);
      }));
    }
  }]);
}();
var WILDCARD_ACTION = '*';
/**
 * RBACPolicy represents an instance of a parsed Stytch RBAC policy object
 * It contains methods for computing outcomes for various permissions questions
 */
var RBACPolicy = /*#__PURE__*/function () {
  function RBACPolicy(roles, resources) {
    var _this22 = this;
    _classCallCheck(this, RBACPolicy);
    this.roles = roles;
    this.resources = resources;
    this.rolesByID = {};
    roles.forEach(function (role) {
      return _this22.rolesByID[role.role_id] = role;
    });
  }
  return _createClass(RBACPolicy, [{
    key: "callerIsAuthorized",
    value:
    /**
     * isAuthorized returns whether or not a user with a specific set of roles can perform a desired action
     * @example
     *  const canDoIt = policy.callerIsAuthorized(roles, 'files', 'create')
     *  console.log(canDoIt) // true
     */
    function callerIsAuthorized(memberRoles, resourceId, action) {
      var _this23 = this;
      return !!memberRoles.map(function (roleId) {
        return _this23.rolesByID[roleId];
      })
      // Defense in depth: filter out null/undefined in case memberRoles contains a role that doesn't match the policy
      // This may happen if the member is loaded _before_ a fresh RBAC policy is loaded
      .filter(function (v) {
        return v;
      }).flatMap(function (role) {
        return role.permissions;
      }).filter(function (permission) {
        return permission.resource_id === resourceId;
      }).find(function (permission) {
        return permission.actions.includes(action) || permission.actions.includes(WILDCARD_ACTION);
      });
    }
    /**
     * allPermissions generates a map that allows quick lookup of all the permissions available to the user
     * @example
     *   const perms = policy.allPermissions(roles)
     *   console.log(perms.files.create) // true
     *   console.log(perms.files.delete) // false
     */
  }, {
    key: "allPermissionsForCaller",
    value: function allPermissionsForCaller(memberRoles) {
      var _this24 = this;
      var allPermsMap = Object.create(null);
      this.resources.forEach(function (resource) {
        allPermsMap[resource.resource_id] = {};
        resource.actions.forEach(function (action) {
          allPermsMap[resource.resource_id][action] = _this24.callerIsAuthorized(memberRoles, resource.resource_id, action);
        });
      });
      return allPermsMap;
    }
  }], [{
    key: "fromJSON",
    value: function fromJSON(input) {
      return new RBACPolicy(input.roles, input.resources);
    }
  }]);
}();
var HeadlessB2BRBACClient = /*#__PURE__*/function () {
  function HeadlessB2BRBACClient(cachedConfig, dynamicConfig, _subscriptionService) {
    var _this25 = this;
    _classCallCheck(this, HeadlessB2BRBACClient);
    this._subscriptionService = _subscriptionService;
    this.isAuthorizedSync = function (resourceId, action) {
      var _a;
      return !!((_a = _this25.cachedPolicy) === null || _a === void 0 ? void 0 : _a.callerIsAuthorized(_this25.roleIds(), resourceId, action));
    };
    this.isAuthorized = function (resourceId, action) {
      return _this25.policyPromise.then(function (policy) {
        return policy.callerIsAuthorized(_this25.roleIds(), resourceId, action);
      });
    };
    this.cachedPolicy = cachedConfig.rbacPolicy ? RBACPolicy.fromJSON(cachedConfig.rbacPolicy) : null;
    this.policyPromise = dynamicConfig.then(function (data) {
      if (!data.rbacPolicy) {
        logger.error('Unable to retrieve RBAC policy from servers. Assuming caller has no permissions.');
        return new RBACPolicy([], []);
      }
      // Update the existing policy too, so isAuthorizedSync will be up-to-date
      _this25.cachedPolicy = RBACPolicy.fromJSON(data.rbacPolicy);
      return _this25.cachedPolicy;
    });
  }
  return _createClass(HeadlessB2BRBACClient, [{
    key: "allPermissions",
    value: function allPermissions() {
      var _this26 = this;
      return this.policyPromise.then(function (policy) {
        return policy.allPermissionsForCaller(_this26.roleIds());
      });
    }
  }, {
    key: "roleIds",
    value: function roleIds() {
      var _a;
      var session = this._subscriptionService.getSession();
      if (!session) {
        return [];
      }
      // Although session.roles is guaranteed to exist for fresh data, there is a minuscule chance
      // that the member session stored in localstorage clientside comes from before roles were added to
      // the API response - in which case session.roles will be undefined and this will crash
      // TODO: [AUTH-2294] We can safely remove this ~3mos after RBAC is released
      return (_a = session.roles) !== null && _a !== void 0 ? _a : [];
    }
  }]);
}();
var HeadlessB2BImpersonationClient = /*#__PURE__*/_createClass(function HeadlessB2BImpersonationClient(_networkClient, _subscriptionService, dfpProtectedAuth) {
  var _this27 = this;
  _classCallCheck(this, HeadlessB2BImpersonationClient);
  this._networkClient = _networkClient;
  this._subscriptionService = _subscriptionService;
  this.dfpProtectedAuth = dfpProtectedAuth;
  this.authenticate = function (data) {
    return __awaiter(_this27, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee144() {
      var _yield$this$dfpProtec44, dfp_telemetry_id, captcha_token, resp;
      return _regeneratorRuntime().wrap(function _callee144$(_context144) {
        while (1) switch (_context144.prev = _context144.next) {
          case 0:
            validate('stytch.impersonation.authenticate').isString('impersonation_token', data.impersonation_token);
            _context144.next = 3;
            return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();
          case 3:
            _yield$this$dfpProtec44 = _context144.sent;
            dfp_telemetry_id = _yield$this$dfpProtec44.dfp_telemetry_id;
            captcha_token = _yield$this$dfpProtec44.captcha_token;
            _context144.next = 8;
            return this._networkClient.retriableFetchSDK({
              url: '/b2b/impersonation/authenticate',
              body: Object.assign(Object.assign({}, data), {
                dfp_telemetry_id: dfp_telemetry_id,
                captcha_token: captcha_token
              }),
              method: 'POST',
              retryCallback: this.dfpProtectedAuth.retryWithCaptchaAndDFP
            });
          case 8:
            resp = _context144.sent;
            this._subscriptionService.updateSession(resp);
            return _context144.abrupt("return", resp);
          case 11:
          case "end":
            return _context144.stop();
        }
      }, _callee144, this);
    }));
  };
});
var IframeHostClient = /*#__PURE__*/function () {
  function IframeHostClient(iframeURL) {
    _classCallCheck(this, IframeHostClient);
    this.iframeURL = iframeURL;
    this.createIframe();
  }
  return _createClass(IframeHostClient, [{
    key: "createIframe",
    value: function createIframe() {
      var existingIframe = document.querySelector("[src~=\"".concat(this.iframeURL, "\"]"));
      /* If an iframe does not exist yet, create one */
      if (!existingIframe) {
        existingIframe = document.createElement('iframe');
        existingIframe.src = this.iframeURL;
        existingIframe.style.position = 'absolute';
        existingIframe.style.width = '0';
        existingIframe.style.height = '0';
        existingIframe.style.border = '0';
        document.body.appendChild(existingIframe);
      } else {
        logger.warn(MULTIPLE_STYTCH_CLIENTS_DETECTED_WARNING);
      }
      /**
       * [NASTY BUG]
       * If we postMessage to an iframe that is _not yet loaded_, chrome will give a cryptic error message
       * Failed to execute 'postMessage' on 'DOMWindow':
       *   The target origin provided ('https://js.stytch.com') does not match the recipient window's origin ('http://localhost:3000').
       * There is no builtin way to determine if an iframe is already loaded,
       * so we set a dataset attr in our onload handler and use that to determine loading state
       */
      if (existingIframe.dataset.loaded === 'true') {
        this.frame = Promise.resolve(existingIframe);
        return;
      }
      this.frame = new Promise(function (resolve) {
        existingIframe.addEventListener('load', function () {
          existingIframe.dataset.loaded = 'true';
          resolve(existingIframe);
        }, {
          once: true
        });
      });
    }
  }, {
    key: "call",
    value: function call(method, args) {
      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee145() {
        var _this28 = this;
        var frame, channel;
        return _regeneratorRuntime().wrap(function _callee145$(_context145) {
          while (1) switch (_context145.prev = _context145.next) {
            case 0:
              _context145.next = 2;
              return this.frame;
            case 2:
              frame = _context145.sent;
              channel = new MessageChannel();
              return _context145.abrupt("return", new Promise(function (resolve, reject) {
                var _a;
                channel.port1.onmessage = function (event) {
                  var resp = event.data;
                  channel.port1.close();
                  if (resp.success) {
                    resolve(resp.payload);
                  } else {
                    reject(ErrorMarshaller.unmarshall(resp.error));
                  }
                };
                var message = {
                  method: method,
                  args: args
                };
                (_a = frame.contentWindow) === null || _a === void 0 ? void 0 : _a.postMessage(message, _this28.iframeURL, [channel.port2]);
              }));
            case 5:
            case "end":
              return _context145.stop();
          }
        }, _callee145, this);
      }));
    }
  }]);
}();
var SearchDataManager = /*#__PURE__*/function () {
  function SearchDataManager(_networkClient, dfpProtectedAuth) {
    _classCallCheck(this, SearchDataManager);
    this._networkClient = _networkClient;
    this.dfpProtectedAuth = dfpProtectedAuth;
  }
  return _createClass(SearchDataManager, [{
    key: "searchUser",
    value: function searchUser(email) {
      var _this29 = this;
      return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha().then(function (_ref10) {
        var dfp_telemetry_id = _ref10.dfp_telemetry_id,
          captcha_token = _ref10.captcha_token;
        return _this29._networkClient.fetchSDK({
          url: "/users/search",
          method: 'POST',
          body: {
            email: email,
            dfp_telemetry_id: dfp_telemetry_id,
            captcha_token: captcha_token
          }
        });
      });
    }
  }, {
    key: "searchMember",
    value: function searchMember(email, organization_id) {
      return this._networkClient.fetchSDK({
        url: "/b2b/organizations/members/search",
        method: 'POST',
        body: {
          email_address: email,
          organization_id: organization_id
        }
      });
    }
  }]);
}(); // We should try refreshing the session if there exists a cached session in
// state that might be stale. Otherwise, we know there is no session, so there's
// no need.
var shouldTryRefresh = function shouldTryRefresh(state) {
  return !!(state === null || state === void 0 ? void 0 : state.session);
};
var SessionManagerRegistry = /*#__PURE__*/function () {
  function SessionManagerRegistry() {
    _classCallCheck(this, SessionManagerRegistry);
    this.hasWarned = false;
    this.registry = new Map();
  }
  return _createClass(SessionManagerRegistry, [{
    key: "register",
    value: function register(key, sessionManager) {
      var otherManager = this.registry.get(key);
      // If there appears to be another registered session manager, issue a
      // warning and cancel its background refresh in favor the newer registration
      if (otherManager && otherManager !== sessionManager) {
        if (!this.hasWarned) {
          logger.warn(MULTIPLE_STYTCH_CLIENTS_DETECTED_WARNING);
          this.hasWarned = true;
        }
        otherManager.cancelBackgroundRefresh();
      }
      this.registry.set(key, sessionManager);
    }
  }, {
    key: "unregister",
    value: function unregister(publicToken, sessionManager) {
      var otherManager = this.registry.get(publicToken);
      if (otherManager && otherManager === sessionManager) {
        this.registry["delete"](publicToken);
      }
    }
  }]);
}();
var SessionManager = /*#__PURE__*/function () {
  function SessionManager(_subscriptionService, _headlessSessionClient, _publicToken) {
    var _this30 = this;
    _classCallCheck(this, SessionManager);
    this._subscriptionService = _subscriptionService;
    this._headlessSessionClient = _headlessSessionClient;
    this._publicToken = _publicToken;
    /**
     * We need to listen to a few types of events:
     * - If the user logs in via invoking a .authenticate() call, we should start the background worker
     * - If the user steps up their authentication via another .authenticate call(), we should restart the background worker
     * - If the user logs out, we should terminate the worker
     * - We should ignore session changes that we ourselves caused - so if we already have a timeout, leave it be!
     */
    this._onDataChange = function (state) {
      if (shouldTryRefresh(state)) {
        _this30.scheduleBackgroundRefresh();
      } else {
        _this30.cancelBackgroundRefresh();
      }
    };
    // In cases where we cannot get a satisfactory request:
    // - Stytch is hard-down
    // - The user's network is disconnected for an extended period of time
    // we will continue to retry every 4 minutes ad infinum
    this._reauthenticateWithBackoff = function () {
      return __awaiter(_this30, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee146() {
        var count;
        return _regeneratorRuntime().wrap(function _callee146$(_context146) {
          while (1) switch (_context146.prev = _context146.next) {
            case 0:
              count = 0;
            case 1:
              if (!true) {
                _context146.next = 17;
                break;
              }
              _context146.prev = 2;
              _context146.next = 5;
              return this._headlessSessionClient.authenticate();
            case 5:
              return _context146.abrupt("return", _context146.sent);
            case 8:
              _context146.prev = 8;
              _context146.t0 = _context146["catch"](2);
              if (!SessionManager.isUnrecoverableError(_context146.t0)) {
                _context146.next = 12;
                break;
              }
              return _context146.abrupt("return", Promise.reject(_context146.t0));
            case 12:
              count++;
              _context146.next = 15;
              return new Promise(function (done) {
                return setTimeout(done, SessionManager.timeoutForAttempt(count));
              });
            case 15:
              _context146.next = 1;
              break;
            case 17:
            case "end":
              return _context146.stop();
          }
        }, _callee146, this, [[2, 8]]);
      }));
    };
    this.timeout = null;
    this._subscriptionService.subscribeToState(this._onDataChange);
  }
  /**
   * The core logic of the session refresh recursive trampoline
   * - Refreshes the currently issued session
   * - Schedules a future refresh if successful
   */
  return _createClass(SessionManager, [{
    key: "register",
    value: function register() {
      SessionManager.registry.register(this._publicToken, this);
    }
  }, {
    key: "unregister",
    value: function unregister() {
      SessionManager.registry.unregister(this._publicToken, this);
    }
  }, {
    key: "performBackgroundRefresh",
    value: function performBackgroundRefresh() {
      var _this31 = this;
      logger.debug('performing background refresh at ', Date.now());
      this._reauthenticateWithBackoff().then(function () {
        _this31.scheduleBackgroundRefresh();
      })["catch"](function (error) {
        logger.warn('Session background refresh failed. Signalling to app that user is logged out.', {
          error: error
        });
        _this31._subscriptionService.destroySession();
      });
    }
  }, {
    key: "scheduleBackgroundRefresh",
    value: function scheduleBackgroundRefresh() {
      var _this32 = this;
      /* Highlander rules - there can only ever be one */
      this.cancelBackgroundRefresh();
      this.register();
      logger.debug('Scheduling bg refresh', Date.now());
      this.timeout = setTimeout(function () {
        _this32.performBackgroundRefresh();
      }, SessionManager.REFRESH_INTERVAL_MS);
    }
  }, {
    key: "cancelBackgroundRefresh",
    value: function cancelBackgroundRefresh() {
      if (this.timeout !== null) {
        this.unregister();
        logger.debug('Cancelling bg refresh', Date.now());
        clearTimeout(this.timeout);
        this.timeout = null;
      }
    }
    // We start with a backoff of 2000ms and increase exponentially to ~4 minutes (+/- 175 ms for jitter)
    // A short backoff initially helps increase the chance that we refresh the session before the JWT expires
  }], [{
    key: "timeoutForAttempt",
    value: function timeoutForAttempt(count) {
      count = Math.min(count, 7);
      var jitter = Math.floor(Math.random() * 350) - 175;
      var delayMS = 2000 * Math.pow(2, count);
      return jitter + delayMS;
    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
  }, {
    key: "isUnrecoverableError",
    value: function isUnrecoverableError(error) {
      return ui.UNRECOVERABLE_ERROR_TYPES.includes(error.error_type);
    }
  }]);
}(); // Three minutes
SessionManager.REFRESH_INTERVAL_MS = 1000 * 60 * 3;
SessionManager.registry = new SessionManagerRegistry();
var StateChangeClient = /*#__PURE__*/_createClass(function StateChangeClient(_subscriptionService, emptyState) {
  var _this33 = this;
  _classCallCheck(this, StateChangeClient);
  this._subscriptionService = _subscriptionService;
  this.emptyState = emptyState;
  this.onStateChange = function (callback) {
    return _this33._subscriptionService.subscribeToState(function (state) {
      callback(state !== null && state !== void 0 ? state : _this33.emptyState);
    });
  };
});
var LOCAL_STORAGE_KEY_PREFIX = 'stytch_sdk_state_';
var getLocalStorageKey = function getLocalStorageKey(publicToken) {
  return "".concat(LOCAL_STORAGE_KEY_PREFIX).concat(publicToken);
};
var SubscriptionDataLayer = /*#__PURE__*/function () {
  function SubscriptionDataLayer(_publicToken, _storageClient) {
    var _this34 = this;
    _classCallCheck(this, SubscriptionDataLayer);
    this._publicToken = _publicToken;
    this._storageClient = _storageClient;
    this.syncFromLocalStorage = function () {
      return __awaiter(_this34, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee147() {
        var _this35 = this;
        return _regeneratorRuntime().wrap(function _callee147$(_context147) {
          while (1) switch (_context147.prev = _context147.next) {
            case 0:
              return _context147.abrupt("return", this._storageClient.getData(getLocalStorageKey(this._publicToken)).then(function (localData) {
                if (!localData) {
                  return null;
                }
                var parsedState;
                try {
                  parsedState = JSON.parse(localData);
                } catch (e) {
                  // Overwrite the bad data
                  _this35._storageClient.clearData(getLocalStorageKey(_this35._publicToken));
                  // this.removeSessionCookie();
                  return null;
                }
                var _parsedState = parsedState,
                  state = _parsedState.state,
                  session_token = _parsedState.session_token,
                  session_jwt = _parsedState.session_jwt,
                  intermediate_session_token = _parsedState.intermediate_session_token;
                _this35.state = state;
                _this35.session_token = session_token;
                _this35.session_jwt = session_jwt;
                _this35.intermediate_session_token = intermediate_session_token;
                return {
                  state: state,
                  session_token: session_token,
                  session_jwt: session_jwt,
                  intermediate_session_token: intermediate_session_token
                };
              })["catch"](function () {
                return null;
              }));
            case 1:
            case "end":
              return _context147.stop();
          }
        }, _callee147, this);
      }));
    };
    this.state = null;
    this.session_token = null;
    this.session_jwt = null;
    this.intermediate_session_token = null;
    this.intermediate_session_token_expiration = null;
    this.subscriptions = {};
  }
  return _createClass(SubscriptionDataLayer, [{
    key: "syncToLocalStorage",
    value: function syncToLocalStorage() {
      this._storageClient.setData(getLocalStorageKey(this._publicToken), JSON.stringify({
        state: this.state,
        session_token: this.session_token,
        session_jwt: this.session_jwt,
        intermediate_session_token: this.intermediate_session_token
      }));
    }
  }]);
}();
var addSubscriber = function addSubscriber(collection, subscriber) {
  var uniqueId = Math.random().toString(36).slice(-10);
  collection[uniqueId] = subscriber;
  return function () {
    return delete collection[uniqueId];
  };
};
var notifySubscribers = function notifySubscribers(collection, value) {
  Object.values(collection).forEach(function (cb) {
    return cb(value);
  });
};
var SubscriptionService = /*#__PURE__*/function () {
  function SubscriptionService(publicToken, storageClient) {
    _classCallCheck(this, SubscriptionService);
    var _a;
    /**
     * Whether the state was retrieved from the cache and is awaiting a refresh
     */
    this.fromCache = true;
    // TODO: Generalize this for Mobile and Web based SDKs
    this._datalayer = new SubscriptionDataLayer(publicToken, storageClient);
    var session = (_a = this._datalayer.state) === null || _a === void 0 ? void 0 : _a.session;
    if (session && Date.parse(session.expires_at) < Date.now()) {
      this.destroyState();
      return;
    }
  }
  return _createClass(SubscriptionService, [{
    key: "syncFromDeviceStorage",
    value: function syncFromDeviceStorage(onCompleteCallback) {
      var _this36 = this;
      this._datalayer.syncFromLocalStorage().then(function (res) {
        var _a;
        if (!res) {
          _this36.setCacheRefreshed();
        } else if (((_a = res.state) === null || _a === void 0 ? void 0 : _a.session) && Date.parse(res.state.session.expires_at) < Date.now()) {
          _this36.destroyState();
        } else {
          // If we retrieved a possibly valid session, indicate whether we
          // intend to refresh it (via a background refresh)
          _this36.updateStateAndTokens(res, shouldTryRefresh(res.state));
        }
      })["finally"](function () {
        onCompleteCallback();
      });
    }
  }, {
    key: "getState",
    value: function getState() {
      return this._datalayer.state;
    }
  }, {
    key: "getTokens",
    value: function getTokens() {
      if (!(typeof this._datalayer.session_token === 'string') || !(typeof this._datalayer.session_jwt === 'string')) {
        return null;
      }
      return {
        session_token: this._datalayer.session_token,
        session_jwt: this._datalayer.session_jwt
      };
    }
  }, {
    key: "removeIST",
    value: function removeIST() {
      this._datalayer.intermediate_session_token = null;
      this._datalayer.intermediate_session_token_expiration = null;
    }
  }, {
    key: "removeSessionTokens",
    value: function removeSessionTokens() {
      this._datalayer.session_jwt = null;
      this._datalayer.session_token = null;
    }
  }, {
    key: "getIntermediateSessionToken",
    value: function getIntermediateSessionToken() {
      if (this._datalayer.intermediate_session_token_expiration && Date.now() > this._datalayer.intermediate_session_token_expiration) {
        this.removeIST();
      }
      return this._datalayer.intermediate_session_token;
    }
  }, {
    key: "destroyState",
    value: function destroyState() {
      this.updateStateAndTokens({
        state: null,
        session_token: null,
        session_jwt: null,
        intermediate_session_token: null
      });
    }
  }, {
    key: "destroySession",
    value: function destroySession() {
      this.updateStateAndTokens({
        state: null,
        session_token: null,
        session_jwt: null,
        intermediate_session_token: this.getIntermediateSessionToken()
      });
    }
  }, {
    key: "_updateStateAndTokensInternal",
    value: function _updateStateAndTokensInternal(stateDiff, fromCache) {
      var state = stateDiff.state,
        session_token = stateDiff.session_token,
        session_jwt = stateDiff.session_jwt,
        intermediate_session_token = stateDiff.intermediate_session_token;
      var newData = state == null ? null : Object.assign(Object.assign({}, this._datalayer.state), state);
      this._datalayer.state = newData;
      if (newData) {
        this._datalayer.session_token = session_token;
        this._datalayer.session_jwt = session_jwt;
        this.removeIST();
      } else if (intermediate_session_token) {
        this.removeSessionTokens();
        this._datalayer.intermediate_session_token = intermediate_session_token;
        // ISTs are only valid for 10 minutes
        this._datalayer.intermediate_session_token_expiration = Date.now() + 10 * 60 * 1000;
      } else {
        this.removeSessionTokens();
        this.removeIST();
      }
      if (!fromCache) {
        this.setCacheRefreshed();
      }
      notifySubscribers(this._datalayer.subscriptions, newData);
    }
  }, {
    key: "updateStateAndTokens",
    value: function updateStateAndTokens(stateDiff) {
      var fromCache = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
      this._updateStateAndTokensInternal(stateDiff, fromCache);
      this._datalayer.syncToLocalStorage();
    }
  }, {
    key: "updateState",
    value: function updateState(state) {
      var newState = state ? Object.assign(Object.assign({}, this._datalayer.state), state) : null;
      this._datalayer.state = newState;
      this.setCacheRefreshed();
      notifySubscribers(this._datalayer.subscriptions, newState);
      // Delay notifying other tabs until after we have refreshed ourselves
      this._datalayer.syncToLocalStorage();
    }
  }, {
    key: "updateTokens",
    value: function updateTokens(tokens) {
      var _a;
      this._datalayer.session_token = tokens.session_token;
      this._datalayer.session_jwt = (_a = tokens.session_jwt) !== null && _a !== void 0 ? _a : null;
      this._datalayer.syncToLocalStorage();
    }
  }, {
    key: "subscribeToState",
    value: function subscribeToState(callback) {
      return addSubscriber(this._datalayer.subscriptions, callback);
    }
  }, {
    key: "getFromCache",
    value: function getFromCache() {
      return this.fromCache;
    }
  }, {
    key: "setCacheRefreshed",
    value: function setCacheRefreshed() {
      this.fromCache = false;
    }
  }]);
}();
var ConsumerSubscriptionService = /*#__PURE__*/function (_SubscriptionService) {
  function ConsumerSubscriptionService() {
    var _this37;
    _classCallCheck(this, ConsumerSubscriptionService);
    _this37 = _callSuper(this, ConsumerSubscriptionService, arguments);
    _this37.updateSession = function (resp) {
      // This is a bit of a hack to get the type inference to work. In practice,
      // opaque tokens are only a concern on web.
      var session = resp.session,
        user = resp.user,
        session_jwt = resp.session_jwt,
        session_token = resp.session_token;
      _this37.updateStateAndTokens({
        state: {
          session: session,
          user: user
        },
        session_jwt: session_jwt,
        session_token: session_token,
        intermediate_session_token: null
      });
    };
    _this37.updateUser = function (user) {
      return _this37.updateState({
        user: user
      });
    };
    _this37.getUser = function () {
      var _a, _b;
      return (_b = (_a = _this37.getState()) === null || _a === void 0 ? void 0 : _a.user) !== null && _b !== void 0 ? _b : null;
    };
    _this37.getSession = function () {
      var _a, _b;
      return (_b = (_a = _this37.getState()) === null || _a === void 0 ? void 0 : _a.session) !== null && _b !== void 0 ? _b : null;
    };
    return _this37;
  }
  _inherits(ConsumerSubscriptionService, _SubscriptionService);
  return _createClass(ConsumerSubscriptionService);
}(SubscriptionService);
var B2BSubscriptionService = /*#__PURE__*/function (_SubscriptionService2) {
  function B2BSubscriptionService() {
    var _this38;
    _classCallCheck(this, B2BSubscriptionService);
    _this38 = _callSuper(this, B2BSubscriptionService, arguments);
    _this38.updateSession = function (originalResp) {
      // This is a bit of a hack to get the type inference to work. In practice,
      // opaque tokens are only a concern on web.
      var resp = originalResp;
      if ('member_session' in resp && resp.member_session) {
        _this38.updateStateAndTokens({
          state: {
            session: resp.member_session,
            member: resp.member,
            organization: resp.organization
          },
          session_token: resp.session_token,
          session_jwt: resp.session_jwt,
          intermediate_session_token: null
        });
      } else {
        _this38.updateStateAndTokens({
          state: null,
          session_token: null,
          session_jwt: null,
          intermediate_session_token: resp.intermediate_session_token
        });
      }
    };
    _this38.updateMember = function (member) {
      return _this38.updateState({
        member: member
      });
    };
    _this38.getMember = function () {
      var _a, _b;
      return (_b = (_a = _this38.getState()) === null || _a === void 0 ? void 0 : _a.member) !== null && _b !== void 0 ? _b : null;
    };
    _this38.updateOrganization = function (organization) {
      return _this38.updateState({
        organization: organization
      });
    };
    _this38.getOrganization = function () {
      var _a, _b;
      return (_b = (_a = _this38.getState()) === null || _a === void 0 ? void 0 : _a.organization) !== null && _b !== void 0 ? _b : null;
    };
    _this38.getSession = function () {
      var _a, _b;
      return (_b = (_a = _this38.getState()) === null || _a === void 0 ? void 0 : _a.session) !== null && _b !== void 0 ? _b : null;
    };
    return _this38;
  }
  _inherits(B2BSubscriptionService, _SubscriptionService2);
  return _createClass(B2BSubscriptionService);
}(SubscriptionService);
var VERTICAL_B2B = 'B2B';
var VERTICAL_CONSUMER = 'CONSUMER';
var createDeepEqual = function createDeepEqual() {
  var _ref11 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
    _ref11$KEYS_TO_EXCLUD = _ref11.KEYS_TO_EXCLUDE,
    KEYS_TO_EXCLUDE = _ref11$KEYS_TO_EXCLUD === void 0 ? [] : _ref11$KEYS_TO_EXCLUD;
  // If comparing functions, this may need some work. Not sure the
  // best path for this: compare instance (what it currently does),
  // stringify and compare, etc.
  // eslint-disable-next-line @typescript-eslint/no-explicit-any
  var _deepEqual = function deepEqual(a, b) {
    // Ensures type is the same
    if (_typeof(a) !== _typeof(b)) return false;
    // arrays, null, and objects all have type 'object'
    if (a === null || b === null) return a === b;
    if (_typeof(a) === 'object') {
      if (Object.keys(a).length !== Object.keys(b).length || Object.keys(a).some(function (k) {
        return !(k in b);
      })) return false;
      return Object.entries(a).filter(function (_ref12) {
        var _ref13 = _slicedToArray(_ref12, 1),
          k = _ref13[0];
        return !KEYS_TO_EXCLUDE.includes(k);
      }).every(function (_ref14) {
        var _ref15 = _slicedToArray(_ref14, 2),
          k = _ref15[0],
          v = _ref15[1];
        return _deepEqual(v, b[k]);
      });
    }
    // boolean, string, number, undefined
    return a === b;
  };
  return _deepEqual;
};
exports.B2BSubscriptionService = B2BSubscriptionService;
exports.CLIENTSIDE_SERVICES_IFRAME_URL = CLIENTSIDE_SERVICES_IFRAME_URL;
exports.COUNTRIES_LIST = COUNTRIES_LIST;
exports.ConsumerSubscriptionService = ConsumerSubscriptionService;
exports.DEFAULT_INTERVAL_DURATION_MS = DEFAULT_INTERVAL_DURATION_MS;
exports.DEFAULT_MAX_BATCH_SIZE = DEFAULT_MAX_BATCH_SIZE;
exports.DEFAULT_OTP_EXPIRATION_MINUTES = DEFAULT_OTP_EXPIRATION_MINUTES;
exports.DEFAULT_SESSION_DURATION_MINUTES = DEFAULT_SESSION_DURATION_MINUTES;
exports.DFPProtectedAuthProvider = DFPProtectedAuthProvider;
exports.DisabledDFPProtectedAuthProvider = DisabledDFPProtectedAuthProvider;
exports.ErrorMarshaller = ErrorMarshaller;
exports.EventLogger = EventLogger;
exports.GOOGLE_ONE_TAP_HOST = GOOGLE_ONE_TAP_HOST;
exports.GOOGLE_ONE_TAP_SCRIPT_URL = GOOGLE_ONE_TAP_SCRIPT_URL;
exports.HeadlessB2BDiscoveryClient = HeadlessB2BDiscoveryClient;
exports.HeadlessB2BImpersonationClient = HeadlessB2BImpersonationClient;
exports.HeadlessB2BMagicLinksClient = HeadlessB2BMagicLinksClient;
exports.HeadlessB2BOAuthClient = HeadlessB2BOAuthClient;
exports.HeadlessB2BOTPsClient = HeadlessB2BOTPsClient;
exports.HeadlessB2BOrganizationClient = HeadlessB2BOrganizationClient;
exports.HeadlessB2BPasswordsClient = HeadlessB2BPasswordsClient;
exports.HeadlessB2BRBACClient = HeadlessB2BRBACClient;
exports.HeadlessB2BRecoveryCodesClient = HeadlessB2BRecoveryCodesClient;
exports.HeadlessB2BSCIMClient = HeadlessB2BSCIMClient;
exports.HeadlessB2BSSOClient = HeadlessB2BSSOClient;
exports.HeadlessB2BSelfClient = HeadlessB2BSelfClient;
exports.HeadlessB2BSessionClient = HeadlessB2BSessionClient;
exports.HeadlessB2BTOTPsClient = HeadlessB2BTOTPsClient;
exports.HeadlessCryptoWalletClient = HeadlessCryptoWalletClient;
exports.HeadlessImpersonationClient = HeadlessImpersonationClient;
exports.HeadlessMagicLinksClient = HeadlessMagicLinksClient;
exports.HeadlessOAuthClient = HeadlessOAuthClient;
exports.HeadlessOTPClient = HeadlessOTPClient;
exports.HeadlessPasswordClient = HeadlessPasswordClient;
exports.HeadlessSessionClient = HeadlessSessionClient;
exports.HeadlessTOTPClient = HeadlessTOTPClient;
exports.HeadlessUserClient = HeadlessUserClient;
exports.HeadlessWebAuthnClient = HeadlessWebAuthnClient;
exports.IframeHostClient = IframeHostClient;
exports.LIVE_API_URL = LIVE_API_URL;
exports.MULTIPLE_STYTCH_CLIENTS_DETECTED_WARNING = MULTIPLE_STYTCH_CLIENTS_DETECTED_WARNING;
exports.POWERED_BY_STYTCH_IMG_URL = POWERED_BY_STYTCH_IMG_URL;
exports.RBACPolicy = RBACPolicy;
exports.RetriableError = RetriableError;
exports.STYTCH_DFP_BACKEND_URL = STYTCH_DFP_BACKEND_URL;
exports.STYTCH_DFP_CDN_URL = STYTCH_DFP_CDN_URL;
exports.STYTCH_SESSION_COOKIE = STYTCH_SESSION_COOKIE;
exports.STYTCH_SESSION_JWT_COOKIE = STYTCH_SESSION_JWT_COOKIE;
exports.SearchDataManager = SearchDataManager;
exports.SessionManager = SessionManager;
exports.StateChangeClient = StateChangeClient;
exports.SubscriptionDataLayer = SubscriptionDataLayer;
exports.SubscriptionService = SubscriptionService;
exports.TEST_API_URL = TEST_API_URL;
exports.VERTICAL_B2B = VERTICAL_B2B;
exports.VERTICAL_CONSUMER = VERTICAL_CONSUMER;
exports.WILDCARD_ACTION = WILDCARD_ACTION;
exports.baseFetchSDK = baseFetchSDK;
exports.baseSubmitFormSDK = baseSubmitFormSDK;
exports.checkB2BNotSSR = checkB2BNotSSR;
exports.checkNotSSR = checkNotSSR;
exports.checkPublicToken = checkPublicToken;
exports.createAppSessionId = createAppSessionId;
exports.createDeepEqual = createDeepEqual;
exports.createEventId = createEventId;
exports.createPersistentId = createPersistentId;
exports.getDFPBackendURL = getDFPBackendURL;
exports.getDFPCdnURL = getDFPCdnURL;
exports.getLiveApiURL = getLiveApiURL;
exports.getTestApiURL = getTestApiURL;
exports.isEmailMethod = isEmailMethod;
exports.isPhoneMethod = isPhoneMethod;
exports.isTestPublicToken = isTestPublicToken;
exports.loadESModule = loadESModule;
exports.logger = logger;
exports.normalizePromiseLike = normalizePromiseLike;
exports.omitUser = omitUser;
exports.removeResponseCommon = removeResponseCommon;
exports.retriableFetchSDK = retriableFetchSDK;
exports.validate = validate;
